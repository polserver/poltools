C:\ZH099\pkg\systems\brainAI\commands\gm\removenpc.src, Line 11
program textcmd_NPCWipe(who, template)
CONST REPORT_ALL	:= 0x7;
0: get arg 'who'
1: get arg 'template'
if( !AuthorizationCode( who ))
2: local #0
3: makelocal
4: jmp userfunc @143
5: if true goto 14
SendSysMessage( who, "Cancelled." );
6: local #0
7: "Cancelled."
8: 3L
9: 1000L
10: Func(2,1): SendSysMessage
11: #
return 0;
12: 0L
13: progend
if ( !template )
14: local #1
15: if true goto 34
template := RequestGump(who, "Enter the npc template name to remove.");
16: local #0
17: "Enter the npc template name to remove."
18: ""
19: ""
20: 0L
21: makelocal
22: jmp userfunc @366
23: local1 := 
if ( !template )
24: local #1
25: if true goto 34
SendSysMessage(who, "Cancelled.");
26: local #0
27: "Cancelled."
28: 3L
29: 1000L
30: Func(2,1): SendSysMessage
31: #
return 0;
32: 0L
33: progend
template := Lower(template);
34: local #1
35: Func(0,3): Lower
36: local1 := 
var realm_name := RequestGump(who, "Enter the realm name to perform the wipe on
37: decl local #2
38: local #0
39: "Enter the realm name to perform the wipe on."
40: ""
41: local #0
42: get member id 'realm' (112)
43: 0L
44: makelocal
45: jmp userfunc @366
46: :=
47: #
var realm_info := Realms()[realm_name];
48: decl local #3
49: ""
50: Func(4,1): Realms
51: local #2
52: [] 1
53: :=
54: #
if ( !realm_info )
55: local #3
56: if true goto 65
SendSysMessage(who, "Invalid realm name.");
57: local #0
58: "Invalid realm name."
59: 3L
60: 1000L
61: Func(2,1): SendSysMessage
62: #
return 0;
63: 0L
64: progend
var x1 := 1, y1 := 1, x2 := realm_info.width, y2 := realm_info.height;
65: decl local #4
66: 1L
67: :=
68: #
69: decl local #5
70: 1L
71: :=
72: #
73: decl local #6
74: local #3
75: get member 'width'
76: :=
77: #
78: decl local #7
79: local #3
80: get member id 'height' (8)
81: :=
82: #
var z1 := -120, z2 := 120;
83: decl local #8
84: -120L
85: :=
86: #
87: decl local #9
88: 120L
89: :=
90: #
var count := 0;
91: decl local #10
92: 0L
93: :=
94: #
foreach thing in ListObjectsInBox(x1, y1, z1, x2, y2, z2, realm_name)
95: local #4
96: local #5
97: local #8
98: local #6
99: local #7
100: local #9
101: local #2
102: Func(2,9): ListObjectsInBox
103: initforeach @127
if ( Lower(thing.npctemplate) == template )
104: local #11
105: get member id 'npctemplate' (62)
106: Func(0,3): Lower
107: local #1
108: ==
109: if false goto 124
SetObjProperty(thing, "GuardKill", 1);
110: local #11
111: "GuardKill"
112: 1L
113: Func(2,7): SetObjProperty
114: #
ApplyRawDamage(thing, 8000);
115: local #11
116: 8000L
117: 1L
118: Func(5,0): ApplyRawDamage
119: #
count += 1;
120: local #10
121: 1L
122: +=
123: #
SleepMS(2);
124: 2L
125: Func(3,0): Sleepms
126: #
127: stepforeach @104
128: leave block(3)
SendSysMessage(who, "Killed "+count+" NPCs");
129: local #0
130: "Killed "
131: local #10
132: +
133: " NPCs"
134: +
135: 3L
136: 1000L
137: Func(2,1): SendSysMessage
138: #
return 1;
139: 1L
140: progend
141: leave block(11)
142: progend
c:/ZH099/scripts/include/security.inc, Line 14
function AuthorizationCode( mobile )
143: pop param 'mobile'
if( GetObjProperty( mobile, "#AuthCodeGiven" ));
144: local #0
145: "#AuthCodeGiven"
146: Func(2,4): GetObjProperty
147: if false goto 150
return 1;
148: 1L
149: return
var autocode := GetGlobalProperty( "CA" );
150: decl local #1
151: "CA"
152: Func(2,5): GetGlobalProperty
153: :=
154: #
if( !autocode )
155: local #1
156: if true goto 172
SendSysMessage( mobile, "Authorization code is not given yet.", 3, 53 );
157: local #0
158: "Authorization code is not given yet."
159: 3L
160: 53L
161: Func(2,1): SendSysMessage
162: #
SendSysMessage( mobile, "Uses .setauthcode to create a new code.", 3, 53 );
163: local #0
164: "Uses .setauthcode to create a new code."
165: 3L
166: 53L
167: Func(2,1): SendSysMessage
168: #
return 0;
169: 0L
170: return
171: goto214
var code := SendTextEntryGump( mobile, "Enter the Authorization Code.", TE_CANC
172: decl local #0
173: local #0
174: "Enter the Authorization Code."
175: 1L
176: 1L
177: 10L
178: ""
179: Func(2,6): SendTextEntryGump
180: :=
181: #
if( code == autocode )
182: local #2
183: local #1
184: ==
185: if false goto 200
SendSysMessage( mobile, "Code Accepted!", 3, 70 );
186: local #0
187: "Code Accepted!"
188: 3L
189: 70L
190: Func(2,1): SendSysMessage
191: #
SetObjProperty( mobile, "#AuthCodeGiven", 1 );
192: local #0
193: "#AuthCodeGiven"
194: 1L
195: Func(2,7): SetObjProperty
196: #
return 1;
197: 1L
198: return
199: goto213
SendSysMessage( mobile, "It is not the Authorization code.", 3, 33 );
200: local #0
201: "It is not the Authorization code."
202: 3L
203: 33L
204: Func(2,1): SendSysMessage
205: #
NotifyStaffOnline( mobile, "has provided a wrong authorization code." );
206: local #0
207: "has provided a wrong authorization code."
208: makelocal
209: jmp userfunc @216
210: #
return 0;
211: 0L
212: return
213: leave block(1)
214: 0L
215: return
c:/ZH099/scripts/include/security.inc, Line 40
function NotifyStaffOnline( object, text )
216: pop param 'text'
217: pop param 'object'
var name := object.name;
218: decl local #2
219: local #1
220: get member id 'name' (3)
221: :=
222: #
if( !name )
223: local #2
224: if true goto 232
name := object.desc;
225: local #1
226: get member id 'desc' (19)
227: local2 := 
if( !name )
228: local #2
229: if true goto 232
name := object;
230: local #1
231: local2 := 
foreach character in EnumerateOnlineCharacters()
232: Func(2,8): EnumerateOnlineCharacters
233: initforeach @268
if( GetObjProperty( character, "Notify" ))
234: local #3
235: "Notify"
236: Func(2,4): GetObjProperty
237: if false goto 265
if( object.cmdlevel <= character.cmdlevel || character.cmdlevel >= 4 )
238: local #1
239: get member id 'cmdlevel' (46)
240: local #3
241: get member id 'cmdlevel' (46)
242: <=
243: local #3
244: get member id 'cmdlevel' (46)
245: 4L
246: >=
247: ||
248: if false goto 265
SendSysMessage( character, "You receive a notification:", 3, 55 );
249: local #3
250: "You receive a notification:"
251: 3L
252: 55L
253: Func(2,1): SendSysMessage
254: #
SendSysMessage( character, name+" >>> "+text, 3, 55 );
255: local #3
256: local #2
257: " >>> "
258: +
259: local #0
260: +
261: 3L
262: 55L
263: Func(2,1): SendSysMessage
264: #
SleepMS(5);
265: 5L
266: Func(3,0): Sleepms
267: #
268: stepforeach @234
269: leave block(3)
if( object.serial )
270: local #1
271: get member id 'serial' (6)
272: if false goto 289
ReportText( name+"["+object.serial+"] >>> "+text, REPORT_SYSLOG );
273: local #2
274: "["
275: +
276: local #1
277: get member id 'serial' (6)
278: +
279: "] >>> "
280: +
281: local #0
282: +
283: 2L
284: 0L
285: makelocal
286: jmp userfunc @301
287: #
288: goto299
ReportText( name+" >>> "+text, REPORT_SYSLOG );
289: local #2
290: " >>> "
291: +
292: local #0
293: +
294: 2L
295: 0L
296: makelocal
297: jmp userfunc @301
298: #
return 1;
299: 1L
300: return
c:/ZH099/pkg/utils/security/include/report.inc, Line 22
function ReportText( report_text:="?", flags:=REPORT_DISABLE, text_color:=0 )
301: pop param 'text_color'
302: pop param 'flags'
303: pop param 'report_text'
if( !flags )
304: local #1
305: if true goto 309
return 0;
306: 0L
307: return
308: goto364
elseif( flags & REPORT_CONSOLE )
309: local #1
310: 1L
311: &
312: if false goto 319
Print( ""+report_text );
313: ""
314: local #2
315: +
316: Func(1,0): Print
317: #
318: goto364
elseif( flags & REPORT_SYSLOG )
319: local #1
320: 2L
321: &
322: if false goto 353
var script_name := CStr( GetProcess( GetPid() ).name ),
323: decl local #0
324: Func(3,4): GetPid
325: Func(3,3): GetProcess
326: get member id 'name' (3)
327: Func(0,1): CStr
328: :=
329: #
330: decl local #1
331: local #3
332: makelocal
333: jmp userfunc @569
334: :=
335: #
LogToFile( "::log/"+pkg_name+".log", "["+script_name+"]: "+report_text, LOG_DAT
336: "::log/"
337: local #4
338: +
339: ".log"
340: +
341: "["
342: local #3
343: +
344: "]: "
345: +
346: local #2
347: +
348: 1L
349: Func(7,0): LogToFile
350: #
351: leave block(2)
352: goto364
elseif( flags & REPORT_BROADCAST )
353: local #1
354: 4L
355: &
356: if false goto 364
Broadcast( ""+report_text, 3, text_color );
357: ""
358: local #2
359: +
360: 3L
361: local #0
362: Func(2,3): Broadcast
363: #
return 1;
364: 1L
365: return
c:/ZH099/pkg/utils/gumps/include/requestgump.inc, Line 39
function RequestGump(mobile, question, option := "", pre_val := "", cancel_btn:
366: pop param 'cancel_btn'
367: pop param 'pre_val'
368: pop param 'option'
369: pop param 'question'
370: pop param 'mobile'
if ( !pre_val || pre_val == error )
371: local #1
372: !
373: local #1
374: error
375: ==
376: ||
377: if false goto 380
pre_val := "";
378: ""
379: local1 := 
var r_gump := GFCreateGump(140, 100);
380: decl local #5
381: 140L
382: 100L
383: 0L
384: 0L
385: makelocal
386: jmp userfunc @791
387: :=
388: #
GFClosable(r_gump, 0);
389: local #5
390: 0L
391: makelocal
392: jmp userfunc @732
393: #
GFResizePic(r_gump, 0, 0, GFGetCfgConst("Defaults", "BackGround"), 400, 205);
394: local #5
395: 0L
396: 0L
397: "Defaults"
398: "BackGround"
399: makelocal
400: jmp userfunc @900
401: 400L
402: 205L
403: makelocal
404: jmp userfunc @962
405: #
GFResizePic(r_gump, 15, 15, GFGetCfgConst("Defaults", "ForeGround"), 370, 175);
406: local #5
407: 15L
408: 15L
409: "Defaults"
410: "ForeGround"
411: makelocal
412: jmp userfunc @900
413: 370L
414: 175L
415: makelocal
416: jmp userfunc @962
417: #
GFAddAlphaRegion( r_gump, 0, 0, 400, 205 );
418: local #5
419: 0L
420: 0L
421: 400L
422: 205L
423: makelocal
424: jmp userfunc @616
425: #
var y_pos := 20;
426: decl local #6
427: 20L
428: :=
429: #
foreach line in (GFWordWrap(question, 370))
430: local #3
431: 370L
432: makelocal
433: jmp userfunc @1190
434: initforeach @450
GFTextLine(r_gump, 20, y_pos, 1153, line);
435: local #5
436: 20L
437: local #6
438: 1153L
439: local #7
440: makelocal
441: jmp userfunc @1141
442: #
y_pos += 20;
443: local #6
444: 20L
445: +=
446: #
SleepMS(2);
447: 2L
448: Func(3,0): Sleepms
449: #
450: stepforeach @435
451: leave block(3)
y_pos := 75;
452: 75L
453: local6 := 
foreach line in (GFWordWrap(option, 370))
454: local #2
455: 370L
456: makelocal
457: jmp userfunc @1190
458: initforeach @474
GFTextLine(r_gump, 20, y_pos, 1153, line);
459: local #5
460: 20L
461: local #6
462: 1153L
463: local #7
464: makelocal
465: jmp userfunc @1141
466: #
y_pos += 20;
467: local #6
468: 20L
469: +=
470: #
SleepMS(2);
471: 2L
472: Func(3,0): Sleepms
473: #
474: stepforeach @459
475: leave block(3)
GFResizePic(r_gump, 20, 100, GFGetCfgConst("BackGrounds", "GOLDTRIM"), 360, 30)
476: local #5
477: 20L
478: 100L
479: "BackGrounds"
480: "GOLDTRIM"
481: makelocal
482: jmp userfunc @900
483: 360L
484: 30L
485: makelocal
486: jmp userfunc @962
487: #
var r_txt := GFTextEntry(r_gump, 30, 105, 335, 25, 1153, pre_val);
488: decl local #7
489: local #5
490: 30L
491: 105L
492: 335L
493: 25L
494: 1153L
495: local #1
496: 0L
497: makelocal
498: jmp userfunc @1057
499: :=
500: #
if ( cancel_btn )
501: local #0
502: if false goto 524
GFAddButton(r_gump, 90, 160, 2128, 2129, GF_CLOSE_BTN, 100);
503: local #5
504: 90L
505: 160L
506: 2128L
507: 2129L
508: 1L
509: 100L
510: makelocal
511: jmp userfunc @650
512: #
GFAddButton(r_gump, 240, 160, 2119, 2120, GF_CLOSE_BTN, 200);
513: local #5
514: 240L
515: 160L
516: 2119L
517: 2120L
518: 1L
519: 200L
520: makelocal
521: jmp userfunc @650
522: #
523: goto534
GFAddButton(r_gump, 180, 160, 2128, 2129, GF_CLOSE_BTN, 100);
524: local #5
525: 180L
526: 160L
527: 2128L
528: 2129L
529: 1L
530: 100L
531: makelocal
532: jmp userfunc @650
533: #
var input := GFSendGump(mobile, r_gump);
534: decl local #8
535: local #4
536: local #5
537: makelocal
538: jmp userfunc @1019
539: :=
540: #
var text_area := GFExtractData(input, r_txt);
541: decl local #9
542: local #8
543: local #7
544: makelocal
545: jmp userfunc @872
546: :=
547: #
if ( input[200] )
548: local #8
549: 200L
550: [] 1
551: if false goto 555
return error;
552: error
553: return
554: goto567
elseif ( !text_area || text_area == error )
555: local #9
556: !
557: local #9
558: error
559: ==
560: ||
561: if false goto 565
return 0;
562: 0L
563: return
564: goto567
return text_area;
565: local #9
566: return
567: 0L
568: return
c:/ZH099/pkg/utils/security/include/report.inc, Line 40
function GetPkgName( script_name )
569: pop param 'script_name'
var i;
570: decl local #1
571: #
for( i:=1; i<=len(script_name); i+=1 )
572: local #1
573: 1L
574: :=
575: #
576: local #1
577: local #0
578: Func(0,2): Len
579: <=
580: if false goto 600
if( !Check_ValidChar( script_name[i] ))
581: local #0
582: local #1
583: [] 1
584: 0L
585: makelocal
586: jmp userfunc @1329
587: if true goto 592
script_name[i] := " ";
588: local #0
589: local #1
590: " "
591: [] := (1) #
SleepMS(5);
592: 5L
593: Func(3,0): Sleepms
594: #
595: local #1
596: 1L
597: +=
598: #
599: goto576
foreach poss_pkg in ( SplitWords( script_name ))
600: local #0
601: " "
602: Func(0,5): SplitWords
603: initforeach @612
if( GetPackageByName( poss_pkg ))
604: local #2
605: Func(4,0): GetPackageByName
606: if false goto 609
return poss_pkg;
607: local #2
608: return
SleepMS(5);
609: 5L
610: Func(3,0): Sleepms
611: #
612: stepforeach @604
613: leave block(3)
return 0;
614: 0L
615: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 166
function GFAddAlphaRegion(byref gump, x, y, width, height)
616: pop param 'height'
617: pop param 'width'
618: pop param 'y'
619: pop param 'x'
620: pop param byref 'gump'
(gump.layout).Append("CheckerTrans "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
621: local #4
622: get member 'layout'
623: "CheckerTrans "
624: local #3
625: Func(0,0): CInt
626: Func(0,1): CStr
627: +
628: " "
629: +
630: local #2
631: Func(0,0): CInt
632: Func(0,1): CStr
633: +
634: " "
635: +
636: local #1
637: Func(0,0): CInt
638: Func(0,1): CStr
639: +
640: " "
641: +
642: local #0
643: Func(0,0): CInt
644: Func(0,1): CStr
645: +
646: Call Method id append (#52, 1 params)
647: #
return 1;
648: 1L
649: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 172
function GFAddButton(byref gump, x, y, off_id, on_id, btn_type:=GF_PAGE_BTN, bt
650: pop param 'btn_value'
651: pop param 'btn_type'
652: pop param 'on_id'
653: pop param 'off_id'
654: pop param 'y'
655: pop param 'x'
656: pop param byref 'gump'
var line := "Button "+CStr(x)+" "+CStr(y)+" "+CStr(off_id)+" "+CStr(on_id);
657: decl local #7
658: "Button "
659: local #5
660: Func(0,1): CStr
661: +
662: " "
663: +
664: local #4
665: Func(0,1): CStr
666: +
667: " "
668: +
669: local #3
670: Func(0,1): CStr
671: +
672: " "
673: +
674: local #2
675: Func(0,1): CStr
676: +
677: :=
678: #
btn_value := CInt(btn_value);
679: local #0
680: Func(0,0): CInt
681: local0 := 
if ( btn_value < 1 ) // Catch errors (0) and invalid (negative) values
682: local #0
683: 1L
684: <
685: if false goto 694
gump.data_id += 1;
686: local #6
687: get member 'data_id'
688: 1L
689: +=
690: #
btn_value := gump.data_id;
691: local #6
692: get member 'data_id'
693: local0 := 
if ( btn_type == GF_CLOSE_BTN )
694: local #1
695: 1L
696: ==
697: if false goto 706
line += " 1 0 "+CStr(btn_value);
698: local #7
699: " 1 0 "
700: local #0
701: Func(0,1): CStr
702: +
703: +=
704: #
705: goto725
elseif ( btn_type == GF_DUMMY_BTN )
706: local #1
707: 2L
708: ==
709: if false goto 718
line += " 0 0 "+CStr(btn_value);
710: local #7
711: " 0 0 "
712: local #0
713: Func(0,1): CStr
714: +
715: +=
716: #
717: goto725
line += " 0 "+CStr(btn_value);
718: local #7
719: " 0 "
720: local #0
721: Func(0,1): CStr
722: +
723: +=
724: #
(gump.layout).Append(line);
725: local #6
726: get member 'layout'
727: local #7
728: Call Method id append (#52, 1 params)
729: #
return (btn_value);
730: local #0
731: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 71
function GFClosable(byref gump, bool)
732: pop param 'bool'
733: pop param byref 'gump'
case ( bool )
734: local #0
735: casejmp
	0: @736
	1: @758
	default: @780
if ( gump.base.CloseLoc )
736: local #1
737: get member 'base'
738: get member 'CloseLoc'
739: if false goto 745
return XGFError("Gump already contains the 'NoClose' flag.");
740: "Gump already contains the 'NoClose' flag."
741: 0L
742: makelocal
743: jmp userfunc @1316
744: return
(gump.layout).Append("NoClose");
745: local #1
746: get member 'layout'
747: "NoClose"
748: Call Method id append (#52, 1 params)
749: #
gump.base.CloseLoc := (gump.layout).Size();
750: local #1
751: get member 'base'
752: local #1
753: get member 'layout'
754: Call Method id size (#48, 0 params)
755: set member 'CloseLoc' #
break;
756: goto757
757: goto789
if ( !gump.base.CloseLoc )
758: local #1
759: get member 'base'
760: get member 'CloseLoc'
761: if true goto 767
return XGFError("Gump is already closable.");
762: "Gump is already closable."
763: 0L
764: makelocal
765: jmp userfunc @1316
766: return
(gump.layout).Erase(gump.base.CloseLoc);
767: local #1
768: get member 'layout'
769: local #1
770: get member 'base'
771: get member 'CloseLoc'
772: Call Method id erase (#49, 1 params)
773: #
gump.base.CloseLoc := 0;
774: local #1
775: get member 'base'
776: 0L
777: set member 'CloseLoc' #
break;
778: goto779
779: goto789
return XGFError("gumps::Closable: Invalid bool value '"+bool+"'");
780: "gumps::Closable: Invalid bool value '"
781: local #0
782: +
783: "'"
784: +
785: 0L
786: makelocal
787: jmp userfunc @1316
788: return
return 1;
789: 1L
790: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 40
function GFCreateGump(x:=0, y:=0, width:=0, height:=0)
791: pop param 'height'
792: pop param 'width'
793: pop param 'y'
794: pop param 'x'
var gump := struct;
795: decl local #4
796: struct
797: :=
798: #
gump.+base := struct;
799: local #4
800: "base"
801: .+
802: struct
803: := #
gump.base.+x := CInt(x);
804: local #4
805: get member 'base'
806: "x"
807: .+
808: local #3
809: Func(0,0): CInt
810: := #
gump.base.+y := CInt(y);
811: local #4
812: get member 'base'
813: "y"
814: .+
815: local #2
816: Func(0,0): CInt
817: := #
gump.base.+width := CInt(width);
818: local #4
819: get member 'base'
820: "width"
821: .+
822: local #1
823: Func(0,0): CInt
824: := #
gump.base.+height := CInt(height);
825: local #4
826: get member 'base'
827: "height"
828: .+
829: local #0
830: Func(0,0): CInt
831: := #
gump.base.+MoveLoc := 0;	// Movable flag location
832: local #4
833: get member 'base'
834: "MoveLoc"
835: .+
836: 0L
837: := #
gump.base.+CloseLoc := 0;	// NoClose flag location
838: local #4
839: get member 'base'
840: "CloseLoc"
841: .+
842: 0L
843: := #
gump.base.+DisposeLoc := 0;	// NoDispose flag location
844: local #4
845: get member 'base'
846: "DisposeLoc"
847: .+
848: 0L
849: := #
gump.+layout	:= array;	// Main layout array for entire gump
850: local #4
851: "layout"
852: .+
853: array
854: := #
gump.+data	:= array;	// Storage array for static-text and
855: local #4
856: "data"
857: .+
858: array
859: := #
gump.+data_id	:= 1;
860: local #4
861: "data_id"
862: .+
863: 1L
864: := #
gump.+cur_page := 0;
865: local #4
866: "cur_page"
867: .+
868: 0L
869: := #
return(gump);
870: local #4
871: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 56
function GFExtractData(input, data_id)
872: pop param 'data_id'
873: pop param 'input'
var key_string := CStr(data_id)+": ";
874: decl local #2
875: local #0
876: Func(0,1): CStr
877: ": "
878: +
879: :=
880: #
var data_string := input[data_id];
881: decl local #3
882: local #1
883: local #0
884: [] 1
885: :=
886: #
var ret_val := data_string[Len(key_string)+1,Len(data_string)];
887: decl local #4
888: local #3
889: local #2
890: Func(0,2): Len
891: 1L
892: +
893: local #3
894: Func(0,2): Len
895: [,]
896: :=
897: #
return ret_val;
898: local #4
899: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 37
function GFGetCfgConst(elem_name, prop_name)
900: pop param 'prop_name'
901: pop param 'elem_name'
var cfg := ReadConfigFile(":gumps:GumpInfo");
902: decl local #2
903: ":gumps:GumpInfo"
904: Func(6,0): ReadConfigFile
905: :=
906: #
if ( cfg.errortext )
907: local #2
908: get member 'errortext'
909: if false goto 918
return XGFError("GFGetCfgConst():: Unable to open GumpInfo.cfg -> "+cfg.errorte
910: "GFGetCfgConst():: Unable to open GumpInfo.cfg -> "
911: local #2
912: get member 'errortext'
913: +
914: 0L
915: makelocal
916: jmp userfunc @1316
917: return
var elem := cfg[elem_name];
918: decl local #3
919: local #2
920: local #1
921: [] 1
922: :=
923: #
if ( elem.errortext )
924: local #3
925: get member 'errortext'
926: if false goto 939
return XGFError("GFGetCfgConst():: Unable to find GumpInfo.cfg["+elem_name+"] -
927: "GFGetCfgConst():: Unable to find GumpInfo.cfg["
928: local #1
929: +
930: "] ->"
931: +
932: local #3
933: get member 'errortext'
934: +
935: 0L
936: makelocal
937: jmp userfunc @1316
938: return
var value := GetConfigInt(elem, prop_name);
939: decl local #4
940: local #3
941: local #0
942: Func(6,1): GetConfigInt
943: :=
944: #
if ( !value )
945: local #4
946: if true goto 960
return XGFError("GFGetCfgConst():: Unable to find property ["+prop_name+"] in e
947: "GFGetCfgConst():: Unable to find property ["
948: local #0
949: +
950: "] in elem ["
951: +
952: local #1
953: +
954: "]"
955: +
956: 0L
957: makelocal
958: jmp userfunc @1316
959: return
return value;
960: local #4
961: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 151
function GFResizePic(byref gump, x, y, gump_id, width, height)
962: pop param 'height'
963: pop param 'width'
964: pop param 'gump_id'
965: pop param 'y'
966: pop param 'x'
967: pop param byref 'gump'
width := CInt(width);
968: local #1
969: Func(0,0): CInt
970: local1 := 
height := CInt(height);
971: local #0
972: Func(0,0): CInt
973: local0 := 
if ( !width )
974: local #1
975: if true goto 980
width := gump.base.width;
976: local #5
977: get member 'base'
978: get member 'width'
979: local1 := 
if ( !height )
980: local #0
981: if true goto 986
height := gump.base.width;
982: local #5
983: get member 'base'
984: get member 'width'
985: local0 := 
(gump.layout).Append("ResizePic "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
986: local #5
987: get member 'layout'
988: "ResizePic "
989: local #4
990: Func(0,0): CInt
991: Func(0,1): CStr
992: +
993: " "
994: +
995: local #3
996: Func(0,0): CInt
997: Func(0,1): CStr
998: +
999: " "
1000: +
1001: local #2
1002: Func(0,0): CInt
1003: Func(0,1): CStr
1004: +
1005: " "
1006: +
1007: local #1
1008: Func(0,1): CStr
1009: +
1010: " "
1011: +
1012: local #0
1013: Func(0,1): CStr
1014: +
1015: Call Method id append (#52, 1 params)
1016: #
return 1;
1017: 1L
1018: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 314
function GFSendGump(mobile, byref gump)
1019: pop param byref 'gump'
1020: pop param 'mobile'
var ret_val := SendDialogGump(mobile, gump.layout, gump.data, gump.base.x, gump
1021: decl local #2
1022: local #1
1023: local #0
1024: get member 'layout'
1025: local #0
1026: get member 'data'
1027: local #0
1028: get member 'base'
1029: get member id 'x' (0)
1030: local #0
1031: get member 'base'
1032: get member id 'y' (1)
1033: 0L
1034: Func(2,0): SendDialogGump
1035: :=
1036: #
if ( ret_val.errortext )
1037: local #2
1038: get member 'errortext'
1039: if false goto 1055
SendSysMessage(mobile, "Error - Unable to display gump.");
1040: local #1
1041: "Error - Unable to display gump."
1042: 3L
1043: 1000L
1044: Func(2,1): SendSysMessage
1045: #
SendSysMessage(mobile, "Error text is ->"+ret_val.errortext);
1046: local #1
1047: "Error text is ->"
1048: local #2
1049: get member 'errortext'
1050: +
1051: 3L
1052: 1000L
1053: Func(2,1): SendSysMessage
1054: #
return ret_val;
1055: local #2
1056: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 296
function GFTextEntry(byref gump, x, y, width, height, txt_color, ini_text:="", 
1057: pop param 'txt_id'
1058: pop param 'ini_text'
1059: pop param 'txt_color'
1060: pop param 'height'
1061: pop param 'width'
1062: pop param 'y'
1063: pop param 'x'
1064: pop param byref 'gump'
gump.data.Append(""+CStr(ini_text));
1065: local #7
1066: get member 'data'
1067: ""
1068: local #1
1069: Func(0,1): CStr
1070: +
1071: Call Method id append (#52, 1 params)
1072: #
var index := gump.data.Size()-1;
1073: decl local #8
1074: local #7
1075: get member 'data'
1076: Call Method id size (#48, 0 params)
1077: 1L
1078: -
1079: :=
1080: #
txt_id := CInt(txt_id);
1081: local #0
1082: Func(0,0): CInt
1083: local0 := 
if ( txt_id < 1 ) // Catch errors (0) and invalid (negative) values
1084: local #0
1085: 1L
1086: <
1087: if false goto 1096
gump.data_id += 1;
1088: local #7
1089: get member 'data_id'
1090: 1L
1091: +=
1092: #
txt_id := gump.data_id;
1093: local #7
1094: get member 'data_id'
1095: local0 := 
(gump.layout).Append("TextEntry "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1096: local #7
1097: get member 'layout'
1098: "TextEntry "
1099: local #6
1100: Func(0,0): CInt
1101: Func(0,1): CStr
1102: +
1103: " "
1104: +
1105: local #5
1106: Func(0,0): CInt
1107: Func(0,1): CStr
1108: +
1109: " "
1110: +
1111: local #4
1112: Func(0,0): CInt
1113: Func(0,1): CStr
1114: +
1115: " "
1116: +
1117: local #3
1118: Func(0,0): CInt
1119: Func(0,1): CStr
1120: +
1121: " "
1122: +
1123: local #2
1124: Func(0,0): CInt
1125: Func(0,1): CStr
1126: +
1127: " "
1128: +
1129: local #0
1130: Func(0,1): CStr
1131: +
1132: " "
1133: +
1134: local #8
1135: Func(0,1): CStr
1136: +
1137: Call Method id append (#52, 1 params)
1138: #
return (txt_id);
1139: local #0
1140: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 263
function GFTextLine(byref gump, x, y, hue:=0, text:="")
1141: pop param 'text'
1142: pop param 'hue'
1143: pop param 'y'
1144: pop param 'x'
1145: pop param byref 'gump'
gump.data.Append(""+CStr(text));
1146: local #4
1147: get member 'data'
1148: ""
1149: local #0
1150: Func(0,1): CStr
1151: +
1152: Call Method id append (#52, 1 params)
1153: #
var index := gump.data.Size()-1;
1154: decl local #5
1155: local #4
1156: get member 'data'
1157: Call Method id size (#48, 0 params)
1158: 1L
1159: -
1160: :=
1161: #
(gump.layout).Append("Text "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1162: local #4
1163: get member 'layout'
1164: "Text "
1165: local #3
1166: Func(0,0): CInt
1167: Func(0,1): CStr
1168: +
1169: " "
1170: +
1171: local #2
1172: Func(0,0): CInt
1173: Func(0,1): CStr
1174: +
1175: " "
1176: +
1177: local #1
1178: Func(0,0): CInt
1179: Func(0,1): CStr
1180: +
1181: " "
1182: +
1183: local #5
1184: Func(0,1): CStr
1185: +
1186: Call Method id append (#52, 1 params)
1187: #
return (index);
1188: local #5
1189: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 165
function GFWordWrap(text, pixels)
1190: pop param 'pixels'
1191: pop param 'text'
var wrap_lines := array{};
1192: decl local #2
1193: array
1194: :=
1195: #
var word_list := SplitWords(text);
1196: decl local #3
1197: local #1
1198: " "
1199: Func(0,5): SplitWords
1200: :=
1201: #
var space_size := GFTextWidth(" ");
1202: decl local #4
1203: " "
1204: makelocal
1205: jmp userfunc @1518
1206: :=
1207: #
var cur_line := "";
1208: decl local #5
1209: ""
1210: :=
1211: #
var cur_length := 0;
1212: decl local #6
1213: 0L
1214: :=
1215: #
var start_new := 0;
1216: decl local #7
1217: 0L
1218: :=
1219: #
foreach word in ( word_list )
1220: local #3
1221: initforeach @1289
var word_width := GFTextWidth(word);
1222: decl local #0
1223: local #8
1224: makelocal
1225: jmp userfunc @1518
1226: :=
1227: #
if ( word == "[P]" )
1228: local #8
1229: "[P]"
1230: ==
1231: if false goto 1239
word := "";
1232: ""
1233: local8 := 
word_width := 0;
1234: 0L
1235: local11 := 
start_new := 1;
1236: 1L
1237: local7 := 
1238: goto1259
elseif ( (word_width+cur_length) > pixels )
1239: local #11
1240: local #6
1241: +
1242: local #0
1243: >
1244: if false goto 1259
start_new := 1;
1245: 1L
1246: local7 := 
if ( cur_line[Len(cur_line)] == " " )
1247: local #5
1248: local #5
1249: Func(0,2): Len
1250: [] 1
1251: " "
1252: ==
1253: if false goto 1259
cur_line[Len(cur_line)] := "";
1254: local #5
1255: local #5
1256: Func(0,2): Len
1257: ""
1258: [] := (1) #
if ( start_new )
1259: local #7
1260: if false goto 1271
start_new := 0;
1261: 0L
1262: local7 := 
wrap_lines.Append(cur_line);
1263: local #2
1264: local #5
1265: Call Method id append (#52, 1 params)
1266: #
cur_line := "";
1267: ""
1268: local5 := 
cur_length := 0;
1269: 0L
1270: local6 := 
if ( word )
1271: local #8
1272: if false goto 1285
cur_line += word+" ";
1273: local #5
1274: local #8
1275: " "
1276: +
1277: +=
1278: #
cur_length += word_width+space_size;
1279: local #6
1280: local #11
1281: local #4
1282: +
1283: +=
1284: #
SleepMS(2);
1285: 2L
1286: Func(3,0): Sleepms
1287: #
1288: leave block(1)
1289: stepforeach @1222
1290: leave block(3)
if ( wrap_lines[wrap_lines.Size()] != cur_line )
1291: local #2
1292: local #2
1293: Call Method id size (#48, 0 params)
1294: [] 1
1295: local #5
1296: <>
1297: if false goto 1314
if ( cur_line[Len(cur_line)] == " " )
1298: local #5
1299: local #5
1300: Func(0,2): Len
1301: [] 1
1302: " "
1303: ==
1304: if false goto 1310
cur_line[Len(cur_line)] := "";
1305: local #5
1306: local #5
1307: Func(0,2): Len
1308: ""
1309: [] := (1) #
wrap_lines.Append(cur_line);
1310: local #2
1311: local #5
1312: Call Method id append (#52, 1 params)
1313: #
return wrap_lines;
1314: local #2
1315: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 335
function XGFError(text, log:=0)
1316: pop param 'log'
1317: pop param 'text'
if ( log )
1318: local #0
1319: if false goto 1325
SysLog("Gump Error:: "+text);
1320: "Gump Error:: "
1321: local #1
1322: +
1323: Func(3,1): SysLog
1324: #
return error{"errortext":=text};
1325: error
1326: local #1
1327: addmember-assign(errortext)
1328: return
c:/ZH099/scripts/include/string.inc, Line 147
function Check_ValidChar( text, allow_space:=0 )
1329: pop param 'allow_space'
1330: pop param 'text'
var valid_char := array{ "a", "b", "c", "d", "e", "f", "g",
1331: decl local #2
1332: array
1333: "a"
1334: init{}
1335: "b"
1336: init{}
1337: "c"
1338: init{}
1339: "d"
1340: init{}
1341: "e"
1342: init{}
1343: "f"
1344: init{}
1345: "g"
1346: init{}
1347: "h"
1348: init{}
1349: "i"
1350: init{}
1351: "j"
1352: init{}
1353: "k"
1354: init{}
1355: "l"
1356: init{}
1357: "m"
1358: init{}
1359: "n"
1360: init{}
1361: "o"
1362: init{}
1363: "p"
1364: init{}
1365: "q"
1366: init{}
1367: "r"
1368: init{}
1369: "s"
1370: init{}
1371: "t"
1372: init{}
1373: "u"
1374: init{}
1375: "v"
1376: init{}
1377: "w"
1378: init{}
1379: "x"
1380: init{}
1381: "y"
1382: init{}
1383: "z"
1384: init{}
1385: "A"
1386: init{}
1387: "B"
1388: init{}
1389: "C"
1390: init{}
1391: "D"
1392: init{}
1393: "E"
1394: init{}
1395: "F"
1396: init{}
1397: "G"
1398: init{}
1399: "H"
1400: init{}
1401: "I"
1402: init{}
1403: "P"
1404: init{}
1405: "O"
1406: init{}
1407: "N"
1408: init{}
1409: "M"
1410: init{}
1411: "L"
1412: init{}
1413: "K"
1414: init{}
1415: "J"
1416: init{}
1417: "Q"
1418: init{}
1419: "R"
1420: init{}
1421: "S"
1422: init{}
1423: "T"
1424: init{}
1425: "U"
1426: init{}
1427: "V"
1428: init{}
1429: "W"
1430: init{}
1431: "X"
1432: init{}
1433: "Y"
1434: init{}
1435: "Z"
1436: init{}
1437: "1"
1438: init{}
1439: "2"
1440: init{}
1441: "3"
1442: init{}
1443: "4"
1444: init{}
1445: "5"
1446: init{}
1447: "6"
1448: init{}
1449: "7"
1450: init{}
1451: "8"
1452: init{}
1453: "9"
1454: init{}
1455: "0"
1456: init{}
1457: :=
1458: #
var len_text := Len( text );
1459: decl local #3
1460: local #1
1461: Func(0,2): Len
1462: :=
1463: #
var i;
1464: decl local #4
1465: #
for( i:=1; i<=len_text; i+=1 )
1466: local #4
1467: 1L
1468: :=
1469: #
1470: local #4
1471: local #3
1472: <=
1473: if false goto 1516
SleepMS(5);
1474: 5L
1475: Func(3,0): Sleepms
1476: #
var letter := CStr( text[i] );
1477: decl local #0
1478: local #1
1479: local #4
1480: [] 1
1481: Func(0,1): CStr
1482: :=
1483: #
if( letter in valid_char )
1484: local #5
1485: local #2
1486: in
1487: if false goto 1491
continue;
1488: leave block(1)
1489: goto1511
1490: goto1508
elseif( allow_space && ( text[i] == " " || CAsc( text[i] ) == 0 ))
1491: local #0
1492: local #1
1493: local #4
1494: [] 1
1495: " "
1496: ==
1497: local #1
1498: local #4
1499: [] 1
1500: Func(0,7): CAsc
1501: 0L
1502: ==
1503: ||
1504: &&
1505: if false goto 1508
continue;
1506: leave block(1)
1507: goto1511
return 0;
1508: 0L
1509: return
1510: leave block(1)
1511: local #4
1512: 1L
1513: +=
1514: #
1515: goto1470
return 1;
1516: 1L
1517: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 124
function GFTextWidth(gump_text)
1518: pop param 'gump_text'
var gft_length := struct;
1519: decl local #1
1520: struct
1521: :=
1522: #
gft_length.+charsf :=
1523: local #1
1524: "charsf"
1525: .+
1526: "||||||||||||||`',.;:::::::::!!!!!!!!!!!!!!il1[]]]]]]]]]"bcejot”(){}===adfpqrszI„~~~~ghnuvy<>-----xJ578$?++++++ kCE2369^/*****mwABDFOPŽ™40%%GLNQSZ@#######HRT&__________KšUYYYYYYYYYYYXXXXXXXXXXXXXXVVVVVVVVVVVVVVMMMMMMMMMMMMMMWWWWWWWWWWWWWW"
1527: := #
gft_length.+width := array
1528: local #1
1529: "width"
1530: .+
1531: array
1532: 2L
1533: init{}
1534: 3L
1535: init{}
1536: 4L
1537: init{}
1538: 5L
1539: init{}
1540: 6L
1541: init{}
1542: 7L
1543: init{}
1544: 8L
1545: init{}
1546: 9L
1547: init{}
1548: 10L
1549: init{}
1550: 11L
1551: init{}
1552: 12L
1553: init{}
1554: 13L
1555: init{}
1556: 14L
1557: init{}
1558: 15L
1559: init{}
1560: 16L
1561: init{}
1562: 18L
1563: init{}
1564: 21L
1565: init{}
1566: := #
var points:=0;
1567: decl local #2
1568: 0L
1569: :=
1570: #
var j := Len(gump_text);
1571: decl local #3
1572: local #0
1573: Func(0,2): Len
1574: :=
1575: #
for ( j; j>0; j-=1 )
1576: local #3
1577: #
1578: local #3
1579: 0L
1580: >
1581: if false goto 1626
var i := Find(gft_length.charsf, gump_text[j], 1) - 1;
1582: decl local #0
1583: local #1
1584: get member 'charsf'
1585: local #0
1586: local #3
1587: [] 1
1588: 1L
1589: Func(0,4): Find
1590: 1L
1591: -
1592: :=
1593: #
if ( i>=0 )
1594: local #4
1595: 0L
1596: >=
1597: if false goto 1611
points += gft_length.width[CInt(i/14)+1];
1598: local #2
1599: local #1
1600: get member 'width'
1601: local #4
1602: 14L
1603: /
1604: Func(0,0): CInt
1605: 1L
1606: +
1607: [] 1
1608: +=
1609: #
1610: goto1620
print("XGFTextWidth: Unknown Character = '"+gump_text[j]+"'");
1611: "XGFTextWidth: Unknown Character = '"
1612: local #0
1613: local #3
1614: [] 1
1615: +
1616: "'"
1617: +
1618: Func(1,0): Print
1619: #
1620: leave block(1)
1621: local #3
1622: 1L
1623: -=
1624: #
1625: goto1578
return (points);
1626: local #2
1627: return
