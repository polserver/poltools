C:\ZH099\pkg\systems\brainAI\commands\gm\cmassacre.src, Line 12
program textcmd_massacre( who, range )
CONST REPORT_ALL	:= 0x7;
0: get arg 'who'
1: get arg 'range'
if( !AuthorizationCode( who ))
2: local #0
3: makelocal
4: jmp userfunc @56
5: if true goto 14
SendSysMessage( who, "Cancelled." );
6: local #0
7: "Cancelled."
8: 3L
9: 1000L
10: Func(2,1): SendSysMessage
11: #
return 0;
12: 0L
13: progend
range := CInt( range );
14: local #1
15: Func(0,0): CInt
16: local1 := 
if( !range )
17: local #1
18: if true goto 28
range := CInt( RequestGump( who, "Enter the radius to kill npcs.", "", 0 ));
19: local #0
20: "Enter the radius to kill npcs."
21: ""
22: 0L
23: 0L
24: makelocal
25: jmp userfunc @279
26: Func(0,0): CInt
27: local1 := 
foreach mobile in ( ListMobilesNearLocationEX( who.x, who.y, who.z, CInt( range
28: local #0
29: get member id 'x' (0)
30: local #0
31: get member id 'y' (1)
32: local #0
33: get member id 'z' (2)
34: local #1
35: Func(0,0): CInt
36: 3L
37: local #0
38: get member id 'realm' (112)
39: Func(2,9): ListMobilesNearLocationEx
40: initforeach @50
if( mobile.npctemplate )
41: local #2
42: get member id 'npctemplate' (62)
43: if false goto 47
mobile.kill();
44: local #2
45: Call Method id kill (#75, 0 params)
46: #
SleepMS(2);
47: 2L
48: Func(4,0): Sleepms
49: #
50: stepforeach @41
51: leave block(3)
return 1;
52: 1L
53: progend
54: leave block(2)
55: progend
c:/ZH099/scripts/include/security.inc, Line 14
function AuthorizationCode( mobile )
56: pop param 'mobile'
if( GetObjProperty( mobile, "#AuthCodeGiven" ));
57: local #0
58: "#AuthCodeGiven"
59: Func(2,4): GetObjProperty
60: if false goto 63
return 1;
61: 1L
62: return
var autocode := GetGlobalProperty( "CA" );
63: decl local #1
64: "CA"
65: Func(2,5): GetGlobalProperty
66: :=
67: #
if( !autocode )
68: local #1
69: if true goto 85
SendSysMessage( mobile, "Authorization code is not given yet.", 3, 53 );
70: local #0
71: "Authorization code is not given yet."
72: 3L
73: 53L
74: Func(2,1): SendSysMessage
75: #
SendSysMessage( mobile, "Uses .setauthcode to create a new code.", 3, 53 );
76: local #0
77: "Uses .setauthcode to create a new code."
78: 3L
79: 53L
80: Func(2,1): SendSysMessage
81: #
return 0;
82: 0L
83: return
84: goto127
var code := SendTextEntryGump( mobile, "Enter the Authorization Code.", TE_CANC
85: decl local #0
86: local #0
87: "Enter the Authorization Code."
88: 1L
89: 1L
90: 10L
91: ""
92: Func(2,6): SendTextEntryGump
93: :=
94: #
if( code == autocode )
95: local #2
96: local #1
97: ==
98: if false goto 113
SendSysMessage( mobile, "Code Accepted!", 3, 70 );
99: local #0
100: "Code Accepted!"
101: 3L
102: 70L
103: Func(2,1): SendSysMessage
104: #
SetObjProperty( mobile, "#AuthCodeGiven", 1 );
105: local #0
106: "#AuthCodeGiven"
107: 1L
108: Func(2,7): SetObjProperty
109: #
return 1;
110: 1L
111: return
112: goto126
SendSysMessage( mobile, "It is not the Authorization code.", 3, 33 );
113: local #0
114: "It is not the Authorization code."
115: 3L
116: 33L
117: Func(2,1): SendSysMessage
118: #
NotifyStaffOnline( mobile, "has provided a wrong authorization code." );
119: local #0
120: "has provided a wrong authorization code."
121: makelocal
122: jmp userfunc @129
123: #
return 0;
124: 0L
125: return
126: leave block(1)
127: 0L
128: return
c:/ZH099/scripts/include/security.inc, Line 40
function NotifyStaffOnline( object, text )
129: pop param 'text'
130: pop param 'object'
var name := object.name;
131: decl local #2
132: local #1
133: get member id 'name' (3)
134: :=
135: #
if( !name )
136: local #2
137: if true goto 145
name := object.desc;
138: local #1
139: get member id 'desc' (19)
140: local2 := 
if( !name )
141: local #2
142: if true goto 145
name := object;
143: local #1
144: local2 := 
foreach character in EnumerateOnlineCharacters()
145: Func(2,8): EnumerateOnlineCharacters
146: initforeach @181
if( GetObjProperty( character, "Notify" ))
147: local #3
148: "Notify"
149: Func(2,4): GetObjProperty
150: if false goto 178
if( object.cmdlevel <= character.cmdlevel || character.cmdlevel >= 4 )
151: local #1
152: get member id 'cmdlevel' (46)
153: local #3
154: get member id 'cmdlevel' (46)
155: <=
156: local #3
157: get member id 'cmdlevel' (46)
158: 4L
159: >=
160: ||
161: if false goto 178
SendSysMessage( character, "You receive a notification:", 3, 55 );
162: local #3
163: "You receive a notification:"
164: 3L
165: 55L
166: Func(2,1): SendSysMessage
167: #
SendSysMessage( character, name+" >>> "+text, 3, 55 );
168: local #3
169: local #2
170: " >>> "
171: +
172: local #0
173: +
174: 3L
175: 55L
176: Func(2,1): SendSysMessage
177: #
SleepMS(5);
178: 5L
179: Func(4,0): Sleepms
180: #
181: stepforeach @147
182: leave block(3)
if( object.serial )
183: local #1
184: get member id 'serial' (6)
185: if false goto 202
ReportText( name+"["+object.serial+"] >>> "+text, REPORT_SYSLOG );
186: local #2
187: "["
188: +
189: local #1
190: get member id 'serial' (6)
191: +
192: "] >>> "
193: +
194: local #0
195: +
196: 2L
197: 0L
198: makelocal
199: jmp userfunc @214
200: #
201: goto212
ReportText( name+" >>> "+text, REPORT_SYSLOG );
202: local #2
203: " >>> "
204: +
205: local #0
206: +
207: 2L
208: 0L
209: makelocal
210: jmp userfunc @214
211: #
return 1;
212: 1L
213: return
c:/ZH099/pkg/utils/security/include/report.inc, Line 22
function ReportText( report_text:="?", flags:=REPORT_DISABLE, text_color:=0 )
214: pop param 'text_color'
215: pop param 'flags'
216: pop param 'report_text'
if( !flags )
217: local #1
218: if true goto 222
return 0;
219: 0L
220: return
221: goto277
elseif( flags & REPORT_CONSOLE )
222: local #1
223: 1L
224: &
225: if false goto 232
Print( ""+report_text );
226: ""
227: local #2
228: +
229: Func(1,0): Print
230: #
231: goto277
elseif( flags & REPORT_SYSLOG )
232: local #1
233: 2L
234: &
235: if false goto 266
var script_name := CStr( GetProcess( GetPid() ).name ),
236: decl local #0
237: Func(4,4): GetPid
238: Func(4,3): GetProcess
239: get member id 'name' (3)
240: Func(0,1): CStr
241: :=
242: #
243: decl local #1
244: local #3
245: makelocal
246: jmp userfunc @482
247: :=
248: #
LogToFile( "::log/"+pkg_name+".log", "["+script_name+"]: "+report_text, LOG_DAT
249: "::log/"
250: local #4
251: +
252: ".log"
253: +
254: "["
255: local #3
256: +
257: "]: "
258: +
259: local #2
260: +
261: 1L
262: Func(7,0): LogToFile
263: #
264: leave block(2)
265: goto277
elseif( flags & REPORT_BROADCAST )
266: local #1
267: 4L
268: &
269: if false goto 277
Broadcast( ""+report_text, 3, text_color );
270: ""
271: local #2
272: +
273: 3L
274: local #0
275: Func(2,3): Broadcast
276: #
return 1;
277: 1L
278: return
c:/ZH099/pkg/utils/gumps/include/requestgump.inc, Line 39
function RequestGump(mobile, question, option := "", pre_val := "", cancel_btn:
279: pop param 'cancel_btn'
280: pop param 'pre_val'
281: pop param 'option'
282: pop param 'question'
283: pop param 'mobile'
if ( !pre_val || pre_val == error )
284: local #1
285: !
286: local #1
287: error
288: ==
289: ||
290: if false goto 293
pre_val := "";
291: ""
292: local1 := 
var r_gump := GFCreateGump(140, 100);
293: decl local #5
294: 140L
295: 100L
296: 0L
297: 0L
298: makelocal
299: jmp userfunc @704
300: :=
301: #
GFClosable(r_gump, 0);
302: local #5
303: 0L
304: makelocal
305: jmp userfunc @645
306: #
GFResizePic(r_gump, 0, 0, GFGetCfgConst("Defaults", "BackGround"), 400, 205);
307: local #5
308: 0L
309: 0L
310: "Defaults"
311: "BackGround"
312: makelocal
313: jmp userfunc @813
314: 400L
315: 205L
316: makelocal
317: jmp userfunc @875
318: #
GFResizePic(r_gump, 15, 15, GFGetCfgConst("Defaults", "ForeGround"), 370, 175);
319: local #5
320: 15L
321: 15L
322: "Defaults"
323: "ForeGround"
324: makelocal
325: jmp userfunc @813
326: 370L
327: 175L
328: makelocal
329: jmp userfunc @875
330: #
GFAddAlphaRegion( r_gump, 0, 0, 400, 205 );
331: local #5
332: 0L
333: 0L
334: 400L
335: 205L
336: makelocal
337: jmp userfunc @529
338: #
var y_pos := 20;
339: decl local #6
340: 20L
341: :=
342: #
foreach line in (GFWordWrap(question, 370))
343: local #3
344: 370L
345: makelocal
346: jmp userfunc @1103
347: initforeach @363
GFTextLine(r_gump, 20, y_pos, 1153, line);
348: local #5
349: 20L
350: local #6
351: 1153L
352: local #7
353: makelocal
354: jmp userfunc @1054
355: #
y_pos += 20;
356: local #6
357: 20L
358: +=
359: #
SleepMS(2);
360: 2L
361: Func(4,0): Sleepms
362: #
363: stepforeach @348
364: leave block(3)
y_pos := 75;
365: 75L
366: local6 := 
foreach line in (GFWordWrap(option, 370))
367: local #2
368: 370L
369: makelocal
370: jmp userfunc @1103
371: initforeach @387
GFTextLine(r_gump, 20, y_pos, 1153, line);
372: local #5
373: 20L
374: local #6
375: 1153L
376: local #7
377: makelocal
378: jmp userfunc @1054
379: #
y_pos += 20;
380: local #6
381: 20L
382: +=
383: #
SleepMS(2);
384: 2L
385: Func(4,0): Sleepms
386: #
387: stepforeach @372
388: leave block(3)
GFResizePic(r_gump, 20, 100, GFGetCfgConst("BackGrounds", "GOLDTRIM"), 360, 30)
389: local #5
390: 20L
391: 100L
392: "BackGrounds"
393: "GOLDTRIM"
394: makelocal
395: jmp userfunc @813
396: 360L
397: 30L
398: makelocal
399: jmp userfunc @875
400: #
var r_txt := GFTextEntry(r_gump, 30, 105, 335, 25, 1153, pre_val);
401: decl local #7
402: local #5
403: 30L
404: 105L
405: 335L
406: 25L
407: 1153L
408: local #1
409: 0L
410: makelocal
411: jmp userfunc @970
412: :=
413: #
if ( cancel_btn )
414: local #0
415: if false goto 437
GFAddButton(r_gump, 90, 160, 2128, 2129, GF_CLOSE_BTN, 100);
416: local #5
417: 90L
418: 160L
419: 2128L
420: 2129L
421: 1L
422: 100L
423: makelocal
424: jmp userfunc @563
425: #
GFAddButton(r_gump, 240, 160, 2119, 2120, GF_CLOSE_BTN, 200);
426: local #5
427: 240L
428: 160L
429: 2119L
430: 2120L
431: 1L
432: 200L
433: makelocal
434: jmp userfunc @563
435: #
436: goto447
GFAddButton(r_gump, 180, 160, 2128, 2129, GF_CLOSE_BTN, 100);
437: local #5
438: 180L
439: 160L
440: 2128L
441: 2129L
442: 1L
443: 100L
444: makelocal
445: jmp userfunc @563
446: #
var input := GFSendGump(mobile, r_gump);
447: decl local #8
448: local #4
449: local #5
450: makelocal
451: jmp userfunc @932
452: :=
453: #
var text_area := GFExtractData(input, r_txt);
454: decl local #9
455: local #8
456: local #7
457: makelocal
458: jmp userfunc @785
459: :=
460: #
if ( input[200] )
461: local #8
462: 200L
463: [] 1
464: if false goto 468
return error;
465: error
466: return
467: goto480
elseif ( !text_area || text_area == error )
468: local #9
469: !
470: local #9
471: error
472: ==
473: ||
474: if false goto 478
return 0;
475: 0L
476: return
477: goto480
return text_area;
478: local #9
479: return
480: 0L
481: return
c:/ZH099/pkg/utils/security/include/report.inc, Line 40
function GetPkgName( script_name )
482: pop param 'script_name'
var i;
483: decl local #1
484: #
for( i:=1; i<=len(script_name); i+=1 )
485: local #1
486: 1L
487: :=
488: #
489: local #1
490: local #0
491: Func(0,2): Len
492: <=
493: if false goto 513
if( !Check_ValidChar( script_name[i] ))
494: local #0
495: local #1
496: [] 1
497: 0L
498: makelocal
499: jmp userfunc @1242
500: if true goto 505
script_name[i] := " ";
501: local #0
502: local #1
503: " "
504: [] := (1) #
SleepMS(5);
505: 5L
506: Func(4,0): Sleepms
507: #
508: local #1
509: 1L
510: +=
511: #
512: goto489
foreach poss_pkg in ( SplitWords( script_name ))
513: local #0
514: " "
515: Func(0,5): SplitWords
516: initforeach @525
if( GetPackageByName( poss_pkg ))
517: local #2
518: Func(5,0): GetPackageByName
519: if false goto 522
return poss_pkg;
520: local #2
521: return
SleepMS(5);
522: 5L
523: Func(4,0): Sleepms
524: #
525: stepforeach @517
526: leave block(3)
return 0;
527: 0L
528: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 166
function GFAddAlphaRegion(byref gump, x, y, width, height)
529: pop param 'height'
530: pop param 'width'
531: pop param 'y'
532: pop param 'x'
533: pop param byref 'gump'
(gump.layout).Append("CheckerTrans "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
534: local #4
535: get member 'layout'
536: "CheckerTrans "
537: local #3
538: Func(0,0): CInt
539: Func(0,1): CStr
540: +
541: " "
542: +
543: local #2
544: Func(0,0): CInt
545: Func(0,1): CStr
546: +
547: " "
548: +
549: local #1
550: Func(0,0): CInt
551: Func(0,1): CStr
552: +
553: " "
554: +
555: local #0
556: Func(0,0): CInt
557: Func(0,1): CStr
558: +
559: Call Method id append (#52, 1 params)
560: #
return 1;
561: 1L
562: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 172
function GFAddButton(byref gump, x, y, off_id, on_id, btn_type:=GF_PAGE_BTN, bt
563: pop param 'btn_value'
564: pop param 'btn_type'
565: pop param 'on_id'
566: pop param 'off_id'
567: pop param 'y'
568: pop param 'x'
569: pop param byref 'gump'
var line := "Button "+CStr(x)+" "+CStr(y)+" "+CStr(off_id)+" "+CStr(on_id);
570: decl local #7
571: "Button "
572: local #5
573: Func(0,1): CStr
574: +
575: " "
576: +
577: local #4
578: Func(0,1): CStr
579: +
580: " "
581: +
582: local #3
583: Func(0,1): CStr
584: +
585: " "
586: +
587: local #2
588: Func(0,1): CStr
589: +
590: :=
591: #
btn_value := CInt(btn_value);
592: local #0
593: Func(0,0): CInt
594: local0 := 
if ( btn_value < 1 ) // Catch errors (0) and invalid (negative) values
595: local #0
596: 1L
597: <
598: if false goto 607
gump.data_id += 1;
599: local #6
600: get member 'data_id'
601: 1L
602: +=
603: #
btn_value := gump.data_id;
604: local #6
605: get member 'data_id'
606: local0 := 
if ( btn_type == GF_CLOSE_BTN )
607: local #1
608: 1L
609: ==
610: if false goto 619
line += " 1 0 "+CStr(btn_value);
611: local #7
612: " 1 0 "
613: local #0
614: Func(0,1): CStr
615: +
616: +=
617: #
618: goto638
elseif ( btn_type == GF_DUMMY_BTN )
619: local #1
620: 2L
621: ==
622: if false goto 631
line += " 0 0 "+CStr(btn_value);
623: local #7
624: " 0 0 "
625: local #0
626: Func(0,1): CStr
627: +
628: +=
629: #
630: goto638
line += " 0 "+CStr(btn_value);
631: local #7
632: " 0 "
633: local #0
634: Func(0,1): CStr
635: +
636: +=
637: #
(gump.layout).Append(line);
638: local #6
639: get member 'layout'
640: local #7
641: Call Method id append (#52, 1 params)
642: #
return (btn_value);
643: local #0
644: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 71
function GFClosable(byref gump, bool)
645: pop param 'bool'
646: pop param byref 'gump'
case ( bool )
647: local #0
648: casejmp
	0: @649
	1: @671
	default: @693
if ( gump.base.CloseLoc )
649: local #1
650: get member 'base'
651: get member 'CloseLoc'
652: if false goto 658
return XGFError("Gump already contains the 'NoClose' flag.");
653: "Gump already contains the 'NoClose' flag."
654: 0L
655: makelocal
656: jmp userfunc @1229
657: return
(gump.layout).Append("NoClose");
658: local #1
659: get member 'layout'
660: "NoClose"
661: Call Method id append (#52, 1 params)
662: #
gump.base.CloseLoc := (gump.layout).Size();
663: local #1
664: get member 'base'
665: local #1
666: get member 'layout'
667: Call Method id size (#48, 0 params)
668: set member 'CloseLoc' #
break;
669: goto670
670: goto702
if ( !gump.base.CloseLoc )
671: local #1
672: get member 'base'
673: get member 'CloseLoc'
674: if true goto 680
return XGFError("Gump is already closable.");
675: "Gump is already closable."
676: 0L
677: makelocal
678: jmp userfunc @1229
679: return
(gump.layout).Erase(gump.base.CloseLoc);
680: local #1
681: get member 'layout'
682: local #1
683: get member 'base'
684: get member 'CloseLoc'
685: Call Method id erase (#49, 1 params)
686: #
gump.base.CloseLoc := 0;
687: local #1
688: get member 'base'
689: 0L
690: set member 'CloseLoc' #
break;
691: goto692
692: goto702
return XGFError("gumps::Closable: Invalid bool value '"+bool+"'");
693: "gumps::Closable: Invalid bool value '"
694: local #0
695: +
696: "'"
697: +
698: 0L
699: makelocal
700: jmp userfunc @1229
701: return
return 1;
702: 1L
703: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 40
function GFCreateGump(x:=0, y:=0, width:=0, height:=0)
704: pop param 'height'
705: pop param 'width'
706: pop param 'y'
707: pop param 'x'
var gump := struct;
708: decl local #4
709: struct
710: :=
711: #
gump.+base := struct;
712: local #4
713: "base"
714: .+
715: struct
716: := #
gump.base.+x := CInt(x);
717: local #4
718: get member 'base'
719: "x"
720: .+
721: local #3
722: Func(0,0): CInt
723: := #
gump.base.+y := CInt(y);
724: local #4
725: get member 'base'
726: "y"
727: .+
728: local #2
729: Func(0,0): CInt
730: := #
gump.base.+width := CInt(width);
731: local #4
732: get member 'base'
733: "width"
734: .+
735: local #1
736: Func(0,0): CInt
737: := #
gump.base.+height := CInt(height);
738: local #4
739: get member 'base'
740: "height"
741: .+
742: local #0
743: Func(0,0): CInt
744: := #
gump.base.+MoveLoc := 0;	// Movable flag location
745: local #4
746: get member 'base'
747: "MoveLoc"
748: .+
749: 0L
750: := #
gump.base.+CloseLoc := 0;	// NoClose flag location
751: local #4
752: get member 'base'
753: "CloseLoc"
754: .+
755: 0L
756: := #
gump.base.+DisposeLoc := 0;	// NoDispose flag location
757: local #4
758: get member 'base'
759: "DisposeLoc"
760: .+
761: 0L
762: := #
gump.+layout	:= array;	// Main layout array for entire gump
763: local #4
764: "layout"
765: .+
766: array
767: := #
gump.+data	:= array;	// Storage array for static-text and
768: local #4
769: "data"
770: .+
771: array
772: := #
gump.+data_id	:= 1;
773: local #4
774: "data_id"
775: .+
776: 1L
777: := #
gump.+cur_page := 0;
778: local #4
779: "cur_page"
780: .+
781: 0L
782: := #
return(gump);
783: local #4
784: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 56
function GFExtractData(input, data_id)
785: pop param 'data_id'
786: pop param 'input'
var key_string := CStr(data_id)+": ";
787: decl local #2
788: local #0
789: Func(0,1): CStr
790: ": "
791: +
792: :=
793: #
var data_string := input[data_id];
794: decl local #3
795: local #1
796: local #0
797: [] 1
798: :=
799: #
var ret_val := data_string[Len(key_string)+1,Len(data_string)];
800: decl local #4
801: local #3
802: local #2
803: Func(0,2): Len
804: 1L
805: +
806: local #3
807: Func(0,2): Len
808: [,]
809: :=
810: #
return ret_val;
811: local #4
812: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 37
function GFGetCfgConst(elem_name, prop_name)
813: pop param 'prop_name'
814: pop param 'elem_name'
var cfg := ReadConfigFile(":gumps:GumpInfo");
815: decl local #2
816: ":gumps:GumpInfo"
817: Func(6,0): ReadConfigFile
818: :=
819: #
if ( cfg.errortext )
820: local #2
821: get member 'errortext'
822: if false goto 831
return XGFError("GFGetCfgConst():: Unable to open GumpInfo.cfg -> "+cfg.errorte
823: "GFGetCfgConst():: Unable to open GumpInfo.cfg -> "
824: local #2
825: get member 'errortext'
826: +
827: 0L
828: makelocal
829: jmp userfunc @1229
830: return
var elem := cfg[elem_name];
831: decl local #3
832: local #2
833: local #1
834: [] 1
835: :=
836: #
if ( elem.errortext )
837: local #3
838: get member 'errortext'
839: if false goto 852
return XGFError("GFGetCfgConst():: Unable to find GumpInfo.cfg["+elem_name+"] -
840: "GFGetCfgConst():: Unable to find GumpInfo.cfg["
841: local #1
842: +
843: "] ->"
844: +
845: local #3
846: get member 'errortext'
847: +
848: 0L
849: makelocal
850: jmp userfunc @1229
851: return
var value := GetConfigInt(elem, prop_name);
852: decl local #4
853: local #3
854: local #0
855: Func(6,1): GetConfigInt
856: :=
857: #
if ( !value )
858: local #4
859: if true goto 873
return XGFError("GFGetCfgConst():: Unable to find property ["+prop_name+"] in e
860: "GFGetCfgConst():: Unable to find property ["
861: local #0
862: +
863: "] in elem ["
864: +
865: local #1
866: +
867: "]"
868: +
869: 0L
870: makelocal
871: jmp userfunc @1229
872: return
return value;
873: local #4
874: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 151
function GFResizePic(byref gump, x, y, gump_id, width, height)
875: pop param 'height'
876: pop param 'width'
877: pop param 'gump_id'
878: pop param 'y'
879: pop param 'x'
880: pop param byref 'gump'
width := CInt(width);
881: local #1
882: Func(0,0): CInt
883: local1 := 
height := CInt(height);
884: local #0
885: Func(0,0): CInt
886: local0 := 
if ( !width )
887: local #1
888: if true goto 893
width := gump.base.width;
889: local #5
890: get member 'base'
891: get member 'width'
892: local1 := 
if ( !height )
893: local #0
894: if true goto 899
height := gump.base.width;
895: local #5
896: get member 'base'
897: get member 'width'
898: local0 := 
(gump.layout).Append("ResizePic "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
899: local #5
900: get member 'layout'
901: "ResizePic "
902: local #4
903: Func(0,0): CInt
904: Func(0,1): CStr
905: +
906: " "
907: +
908: local #3
909: Func(0,0): CInt
910: Func(0,1): CStr
911: +
912: " "
913: +
914: local #2
915: Func(0,0): CInt
916: Func(0,1): CStr
917: +
918: " "
919: +
920: local #1
921: Func(0,1): CStr
922: +
923: " "
924: +
925: local #0
926: Func(0,1): CStr
927: +
928: Call Method id append (#52, 1 params)
929: #
return 1;
930: 1L
931: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 314
function GFSendGump(mobile, byref gump)
932: pop param byref 'gump'
933: pop param 'mobile'
var ret_val := SendDialogGump(mobile, gump.layout, gump.data, gump.base.x, gump
934: decl local #2
935: local #1
936: local #0
937: get member 'layout'
938: local #0
939: get member 'data'
940: local #0
941: get member 'base'
942: get member id 'x' (0)
943: local #0
944: get member 'base'
945: get member id 'y' (1)
946: 0L
947: Func(2,0): SendDialogGump
948: :=
949: #
if ( ret_val.errortext )
950: local #2
951: get member 'errortext'
952: if false goto 968
SendSysMessage(mobile, "Error - Unable to display gump.");
953: local #1
954: "Error - Unable to display gump."
955: 3L
956: 1000L
957: Func(2,1): SendSysMessage
958: #
SendSysMessage(mobile, "Error text is ->"+ret_val.errortext);
959: local #1
960: "Error text is ->"
961: local #2
962: get member 'errortext'
963: +
964: 3L
965: 1000L
966: Func(2,1): SendSysMessage
967: #
return ret_val;
968: local #2
969: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 296
function GFTextEntry(byref gump, x, y, width, height, txt_color, ini_text:="", 
970: pop param 'txt_id'
971: pop param 'ini_text'
972: pop param 'txt_color'
973: pop param 'height'
974: pop param 'width'
975: pop param 'y'
976: pop param 'x'
977: pop param byref 'gump'
gump.data.Append(""+CStr(ini_text));
978: local #7
979: get member 'data'
980: ""
981: local #1
982: Func(0,1): CStr
983: +
984: Call Method id append (#52, 1 params)
985: #
var index := gump.data.Size()-1;
986: decl local #8
987: local #7
988: get member 'data'
989: Call Method id size (#48, 0 params)
990: 1L
991: -
992: :=
993: #
txt_id := CInt(txt_id);
994: local #0
995: Func(0,0): CInt
996: local0 := 
if ( txt_id < 1 ) // Catch errors (0) and invalid (negative) values
997: local #0
998: 1L
999: <
1000: if false goto 1009
gump.data_id += 1;
1001: local #7
1002: get member 'data_id'
1003: 1L
1004: +=
1005: #
txt_id := gump.data_id;
1006: local #7
1007: get member 'data_id'
1008: local0 := 
(gump.layout).Append("TextEntry "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1009: local #7
1010: get member 'layout'
1011: "TextEntry "
1012: local #6
1013: Func(0,0): CInt
1014: Func(0,1): CStr
1015: +
1016: " "
1017: +
1018: local #5
1019: Func(0,0): CInt
1020: Func(0,1): CStr
1021: +
1022: " "
1023: +
1024: local #4
1025: Func(0,0): CInt
1026: Func(0,1): CStr
1027: +
1028: " "
1029: +
1030: local #3
1031: Func(0,0): CInt
1032: Func(0,1): CStr
1033: +
1034: " "
1035: +
1036: local #2
1037: Func(0,0): CInt
1038: Func(0,1): CStr
1039: +
1040: " "
1041: +
1042: local #0
1043: Func(0,1): CStr
1044: +
1045: " "
1046: +
1047: local #8
1048: Func(0,1): CStr
1049: +
1050: Call Method id append (#52, 1 params)
1051: #
return (txt_id);
1052: local #0
1053: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 263
function GFTextLine(byref gump, x, y, hue:=0, text:="")
1054: pop param 'text'
1055: pop param 'hue'
1056: pop param 'y'
1057: pop param 'x'
1058: pop param byref 'gump'
gump.data.Append(""+CStr(text));
1059: local #4
1060: get member 'data'
1061: ""
1062: local #0
1063: Func(0,1): CStr
1064: +
1065: Call Method id append (#52, 1 params)
1066: #
var index := gump.data.Size()-1;
1067: decl local #5
1068: local #4
1069: get member 'data'
1070: Call Method id size (#48, 0 params)
1071: 1L
1072: -
1073: :=
1074: #
(gump.layout).Append("Text "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1075: local #4
1076: get member 'layout'
1077: "Text "
1078: local #3
1079: Func(0,0): CInt
1080: Func(0,1): CStr
1081: +
1082: " "
1083: +
1084: local #2
1085: Func(0,0): CInt
1086: Func(0,1): CStr
1087: +
1088: " "
1089: +
1090: local #1
1091: Func(0,0): CInt
1092: Func(0,1): CStr
1093: +
1094: " "
1095: +
1096: local #5
1097: Func(0,1): CStr
1098: +
1099: Call Method id append (#52, 1 params)
1100: #
return (index);
1101: local #5
1102: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 165
function GFWordWrap(text, pixels)
1103: pop param 'pixels'
1104: pop param 'text'
var wrap_lines := array{};
1105: decl local #2
1106: array
1107: :=
1108: #
var word_list := SplitWords(text);
1109: decl local #3
1110: local #1
1111: " "
1112: Func(0,5): SplitWords
1113: :=
1114: #
var space_size := GFTextWidth(" ");
1115: decl local #4
1116: " "
1117: makelocal
1118: jmp userfunc @1431
1119: :=
1120: #
var cur_line := "";
1121: decl local #5
1122: ""
1123: :=
1124: #
var cur_length := 0;
1125: decl local #6
1126: 0L
1127: :=
1128: #
var start_new := 0;
1129: decl local #7
1130: 0L
1131: :=
1132: #
foreach word in ( word_list )
1133: local #3
1134: initforeach @1202
var word_width := GFTextWidth(word);
1135: decl local #0
1136: local #8
1137: makelocal
1138: jmp userfunc @1431
1139: :=
1140: #
if ( word == "[P]" )
1141: local #8
1142: "[P]"
1143: ==
1144: if false goto 1152
word := "";
1145: ""
1146: local8 := 
word_width := 0;
1147: 0L
1148: local11 := 
start_new := 1;
1149: 1L
1150: local7 := 
1151: goto1172
elseif ( (word_width+cur_length) > pixels )
1152: local #11
1153: local #6
1154: +
1155: local #0
1156: >
1157: if false goto 1172
start_new := 1;
1158: 1L
1159: local7 := 
if ( cur_line[Len(cur_line)] == " " )
1160: local #5
1161: local #5
1162: Func(0,2): Len
1163: [] 1
1164: " "
1165: ==
1166: if false goto 1172
cur_line[Len(cur_line)] := "";
1167: local #5
1168: local #5
1169: Func(0,2): Len
1170: ""
1171: [] := (1) #
if ( start_new )
1172: local #7
1173: if false goto 1184
start_new := 0;
1174: 0L
1175: local7 := 
wrap_lines.Append(cur_line);
1176: local #2
1177: local #5
1178: Call Method id append (#52, 1 params)
1179: #
cur_line := "";
1180: ""
1181: local5 := 
cur_length := 0;
1182: 0L
1183: local6 := 
if ( word )
1184: local #8
1185: if false goto 1198
cur_line += word+" ";
1186: local #5
1187: local #8
1188: " "
1189: +
1190: +=
1191: #
cur_length += word_width+space_size;
1192: local #6
1193: local #11
1194: local #4
1195: +
1196: +=
1197: #
SleepMS(2);
1198: 2L
1199: Func(4,0): Sleepms
1200: #
1201: leave block(1)
1202: stepforeach @1135
1203: leave block(3)
if ( wrap_lines[wrap_lines.Size()] != cur_line )
1204: local #2
1205: local #2
1206: Call Method id size (#48, 0 params)
1207: [] 1
1208: local #5
1209: <>
1210: if false goto 1227
if ( cur_line[Len(cur_line)] == " " )
1211: local #5
1212: local #5
1213: Func(0,2): Len
1214: [] 1
1215: " "
1216: ==
1217: if false goto 1223
cur_line[Len(cur_line)] := "";
1218: local #5
1219: local #5
1220: Func(0,2): Len
1221: ""
1222: [] := (1) #
wrap_lines.Append(cur_line);
1223: local #2
1224: local #5
1225: Call Method id append (#52, 1 params)
1226: #
return wrap_lines;
1227: local #2
1228: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 335
function XGFError(text, log:=0)
1229: pop param 'log'
1230: pop param 'text'
if ( log )
1231: local #0
1232: if false goto 1238
SysLog("Gump Error:: "+text);
1233: "Gump Error:: "
1234: local #1
1235: +
1236: Func(4,1): SysLog
1237: #
return error{"errortext":=text};
1238: error
1239: local #1
1240: addmember-assign(errortext)
1241: return
c:/ZH099/scripts/include/string.inc, Line 147
function Check_ValidChar( text, allow_space:=0 )
1242: pop param 'allow_space'
1243: pop param 'text'
var valid_char := array{ "a", "b", "c", "d", "e", "f", "g",
1244: decl local #2
1245: array
1246: "a"
1247: init{}
1248: "b"
1249: init{}
1250: "c"
1251: init{}
1252: "d"
1253: init{}
1254: "e"
1255: init{}
1256: "f"
1257: init{}
1258: "g"
1259: init{}
1260: "h"
1261: init{}
1262: "i"
1263: init{}
1264: "j"
1265: init{}
1266: "k"
1267: init{}
1268: "l"
1269: init{}
1270: "m"
1271: init{}
1272: "n"
1273: init{}
1274: "o"
1275: init{}
1276: "p"
1277: init{}
1278: "q"
1279: init{}
1280: "r"
1281: init{}
1282: "s"
1283: init{}
1284: "t"
1285: init{}
1286: "u"
1287: init{}
1288: "v"
1289: init{}
1290: "w"
1291: init{}
1292: "x"
1293: init{}
1294: "y"
1295: init{}
1296: "z"
1297: init{}
1298: "A"
1299: init{}
1300: "B"
1301: init{}
1302: "C"
1303: init{}
1304: "D"
1305: init{}
1306: "E"
1307: init{}
1308: "F"
1309: init{}
1310: "G"
1311: init{}
1312: "H"
1313: init{}
1314: "I"
1315: init{}
1316: "P"
1317: init{}
1318: "O"
1319: init{}
1320: "N"
1321: init{}
1322: "M"
1323: init{}
1324: "L"
1325: init{}
1326: "K"
1327: init{}
1328: "J"
1329: init{}
1330: "Q"
1331: init{}
1332: "R"
1333: init{}
1334: "S"
1335: init{}
1336: "T"
1337: init{}
1338: "U"
1339: init{}
1340: "V"
1341: init{}
1342: "W"
1343: init{}
1344: "X"
1345: init{}
1346: "Y"
1347: init{}
1348: "Z"
1349: init{}
1350: "1"
1351: init{}
1352: "2"
1353: init{}
1354: "3"
1355: init{}
1356: "4"
1357: init{}
1358: "5"
1359: init{}
1360: "6"
1361: init{}
1362: "7"
1363: init{}
1364: "8"
1365: init{}
1366: "9"
1367: init{}
1368: "0"
1369: init{}
1370: :=
1371: #
var len_text := Len( text );
1372: decl local #3
1373: local #1
1374: Func(0,2): Len
1375: :=
1376: #
var i;
1377: decl local #4
1378: #
for( i:=1; i<=len_text; i+=1 )
1379: local #4
1380: 1L
1381: :=
1382: #
1383: local #4
1384: local #3
1385: <=
1386: if false goto 1429
SleepMS(5);
1387: 5L
1388: Func(4,0): Sleepms
1389: #
var letter := CStr( text[i] );
1390: decl local #0
1391: local #1
1392: local #4
1393: [] 1
1394: Func(0,1): CStr
1395: :=
1396: #
if( letter in valid_char )
1397: local #5
1398: local #2
1399: in
1400: if false goto 1404
continue;
1401: leave block(1)
1402: goto1424
1403: goto1421
elseif( allow_space && ( text[i] == " " || CAsc( text[i] ) == 0 ))
1404: local #0
1405: local #1
1406: local #4
1407: [] 1
1408: " "
1409: ==
1410: local #1
1411: local #4
1412: [] 1
1413: Func(0,7): CAsc
1414: 0L
1415: ==
1416: ||
1417: &&
1418: if false goto 1421
continue;
1419: leave block(1)
1420: goto1424
return 0;
1421: 0L
1422: return
1423: leave block(1)
1424: local #4
1425: 1L
1426: +=
1427: #
1428: goto1383
return 1;
1429: 1L
1430: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 124
function GFTextWidth(gump_text)
1431: pop param 'gump_text'
var gft_length := struct;
1432: decl local #1
1433: struct
1434: :=
1435: #
gft_length.+charsf :=
1436: local #1
1437: "charsf"
1438: .+
1439: "||||||||||||||`',.;:::::::::!!!!!!!!!!!!!!il1[]]]]]]]]]"bcejot”(){}===adfpqrszI„~~~~ghnuvy<>-----xJ578$?++++++ kCE2369^/*****mwABDFOPŽ™40%%GLNQSZ@#######HRT&__________KšUYYYYYYYYYYYXXXXXXXXXXXXXXVVVVVVVVVVVVVVMMMMMMMMMMMMMMWWWWWWWWWWWWWW"
1440: := #
gft_length.+width := array
1441: local #1
1442: "width"
1443: .+
1444: array
1445: 2L
1446: init{}
1447: 3L
1448: init{}
1449: 4L
1450: init{}
1451: 5L
1452: init{}
1453: 6L
1454: init{}
1455: 7L
1456: init{}
1457: 8L
1458: init{}
1459: 9L
1460: init{}
1461: 10L
1462: init{}
1463: 11L
1464: init{}
1465: 12L
1466: init{}
1467: 13L
1468: init{}
1469: 14L
1470: init{}
1471: 15L
1472: init{}
1473: 16L
1474: init{}
1475: 18L
1476: init{}
1477: 21L
1478: init{}
1479: := #
var points:=0;
1480: decl local #2
1481: 0L
1482: :=
1483: #
var j := Len(gump_text);
1484: decl local #3
1485: local #0
1486: Func(0,2): Len
1487: :=
1488: #
for ( j; j>0; j-=1 )
1489: local #3
1490: #
1491: local #3
1492: 0L
1493: >
1494: if false goto 1539
var i := Find(gft_length.charsf, gump_text[j], 1) - 1;
1495: decl local #0
1496: local #1
1497: get member 'charsf'
1498: local #0
1499: local #3
1500: [] 1
1501: 1L
1502: Func(0,4): Find
1503: 1L
1504: -
1505: :=
1506: #
if ( i>=0 )
1507: local #4
1508: 0L
1509: >=
1510: if false goto 1524
points += gft_length.width[CInt(i/14)+1];
1511: local #2
1512: local #1
1513: get member 'width'
1514: local #4
1515: 14L
1516: /
1517: Func(0,0): CInt
1518: 1L
1519: +
1520: [] 1
1521: +=
1522: #
1523: goto1533
print("XGFTextWidth: Unknown Character = '"+gump_text[j]+"'");
1524: "XGFTextWidth: Unknown Character = '"
1525: local #0
1526: local #3
1527: [] 1
1528: +
1529: "'"
1530: +
1531: Func(1,0): Print
1532: #
1533: leave block(1)
1534: local #3
1535: 1L
1536: -=
1537: #
1538: goto1491
return (points);
1539: local #2
1540: return
