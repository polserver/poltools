C:\ZH099\pkg\systems\brainAI\commands\gm\makeswarm.src, Line 10
program MakeSwarm(who, text)
CONST REPORT_ALL	:= 0x7;
0: get arg 'who'
1: get arg 'text'
if( !AuthorizationCode( who ))
2: local #0
3: makelocal
4: jmp userfunc @210
5: if true goto 14
SendSysMessage( who, "Cancelled." );
6: local #0
7: "Cancelled."
8: 3L
9: 1000L
10: Func(2,1): SendSysMessage
11: #
return 0;
12: 0L
13: progend
var template:=0, radius:=0;
14: decl local #2
15: 0L
16: :=
17: #
18: decl local #3
19: 0L
20: :=
21: #
if ( text ) 
22: local #1
23: if false goto 37
text := SplitWords(text);
24: local #1
25: " "
26: Func(0,5): SplitWords
27: local1 := 
template := text[1];
28: local #1
29: 1L
30: [] 1
31: local2 := 
radius := CInt(text[2]);
32: local #1
33: 2L
34: [] 1
35: Func(0,0): CInt
36: local3 := 
if ( !template )
37: local #2
38: if true goto 57
template := RequestGump(who, "Enter the npc template name to use.", "");
39: local #0
40: "Enter the npc template name to use."
41: ""
42: ""
43: 0L
44: makelocal
45: jmp userfunc @433
46: local2 := 
if ( !template )
47: local #2
48: if true goto 57
SendSysMessage(who, "Cancelled.");
49: local #0
50: "Cancelled."
51: 3L
52: 1000L
53: Func(2,1): SendSysMessage
54: #
return 0;
55: 0L
56: progend
if ( !radius )
57: local #3
58: if true goto 80
if ( !radius )
59: local #3
60: if true goto 70
radius := CInt(RequestGump(who, "Enter the radius to create npcs.", "", 1));
61: local #0
62: "Enter the radius to create npcs."
63: ""
64: 1L
65: 0L
66: makelocal
67: jmp userfunc @433
68: Func(0,0): CInt
69: local3 := 
if ( !radius )
70: local #3
71: if true goto 80
SendSysMessage(who, "Radius is less than 1. Setting to 1.");
72: local #0
73: "Radius is less than 1. Setting to 1."
74: 3L
75: 1000L
76: Func(2,1): SendSysMessage
77: #
radius := 1;
78: 1L
79: local3 := 
if ( radius > 10 ) // 100 npcs
80: local #3
81: 10L
82: >
83: if false goto 92
SendSysMessage(who, "Radius exceeds 10 spaces. Setting to 10.");
84: local #0
85: "Radius exceeds 10 spaces. Setting to 10."
86: 3L
87: 1000L
88: Func(2,1): SendSysMessage
89: #
radius := 10;
90: 10L
91: local3 := 
var start_x := who.x - CInt(radius);
92: decl local #4
93: local #0
94: get member id 'x' (0)
95: local #3
96: Func(0,0): CInt
97: -
98: :=
99: #
var start_y := who.y - CInt(radius);
100: decl local #5
101: local #0
102: get member id 'y' (1)
103: local #3
104: Func(0,0): CInt
105: -
106: :=
107: #
var end_x := who.x + CInt(radius);
108: decl local #6
109: local #0
110: get member id 'x' (0)
111: local #3
112: Func(0,0): CInt
113: +
114: :=
115: #
var end_y := who.y + CInt(radius);
116: decl local #7
117: local #0
118: get member id 'y' (1)
119: local #3
120: Func(0,0): CInt
121: +
122: :=
123: #
var x := start_x, y := start_y;
124: decl local #8
125: local #4
126: :=
127: #
128: decl local #9
129: local #5
130: :=
131: #
var created := 0;
132: decl local #10
133: 0L
134: :=
135: #
for ( x:=start_x; x<=end_x; x+=1 )
136: local #8
137: local #4
138: :=
139: #
140: local #8
141: local #6
142: <=
143: if false goto 192
for ( y:=start_y; y<=end_y; y+=1 )
144: local #9
145: local #5
146: :=
147: #
148: local #9
149: local #7
150: <=
151: if false goto 187
var npc := CreateNPCFromTemplate(template, x, y, who.z, 0, who.realm);
152: decl local #0
153: local #2
154: local #8
155: local #9
156: local #0
157: get member id 'z' (2)
158: 0L
159: local #0
160: get member id 'realm' (112)
161: Func(2,9): CreateNpcFromTemplate
162: :=
163: #
if ( npc )
164: local #11
165: if false goto 171
created += 1;
166: local #10
167: 1L
168: +=
169: #
170: goto178
elseif ( npc.errortext )
171: local #11
172: get member 'errortext'
173: if false goto 178
Print(npc.errortext);
174: local #11
175: get member 'errortext'
176: Func(1,0): Print
177: #
SleepMS(3);
178: 3L
179: Func(3,0): Sleepms
180: #
181: leave block(1)
182: local #9
183: 1L
184: +=
185: #
186: goto148
187: local #8
188: 1L
189: +=
190: #
191: goto140
SendSysMessage(who, "Done making npc swarm. Created ["+created+"] ["+template+"
192: local #0
193: "Done making npc swarm. Created ["
194: local #10
195: +
196: "] ["
197: +
198: local #2
199: +
200: "] npcs."
201: +
202: 3L
203: 1000L
204: Func(2,1): SendSysMessage
205: #
return 1;
206: 1L
207: progend
208: leave block(11)
209: progend
c:/ZH099/scripts/include/security.inc, Line 14
function AuthorizationCode( mobile )
210: pop param 'mobile'
if( GetObjProperty( mobile, "#AuthCodeGiven" ));
211: local #0
212: "#AuthCodeGiven"
213: Func(2,4): GetObjProperty
214: if false goto 217
return 1;
215: 1L
216: return
var autocode := GetGlobalProperty( "CA" );
217: decl local #1
218: "CA"
219: Func(2,5): GetGlobalProperty
220: :=
221: #
if( !autocode )
222: local #1
223: if true goto 239
SendSysMessage( mobile, "Authorization code is not given yet.", 3, 53 );
224: local #0
225: "Authorization code is not given yet."
226: 3L
227: 53L
228: Func(2,1): SendSysMessage
229: #
SendSysMessage( mobile, "Uses .setauthcode to create a new code.", 3, 53 );
230: local #0
231: "Uses .setauthcode to create a new code."
232: 3L
233: 53L
234: Func(2,1): SendSysMessage
235: #
return 0;
236: 0L
237: return
238: goto281
var code := SendTextEntryGump( mobile, "Enter the Authorization Code.", TE_CANC
239: decl local #0
240: local #0
241: "Enter the Authorization Code."
242: 1L
243: 1L
244: 10L
245: ""
246: Func(2,6): SendTextEntryGump
247: :=
248: #
if( code == autocode )
249: local #2
250: local #1
251: ==
252: if false goto 267
SendSysMessage( mobile, "Code Accepted!", 3, 70 );
253: local #0
254: "Code Accepted!"
255: 3L
256: 70L
257: Func(2,1): SendSysMessage
258: #
SetObjProperty( mobile, "#AuthCodeGiven", 1 );
259: local #0
260: "#AuthCodeGiven"
261: 1L
262: Func(2,7): SetObjProperty
263: #
return 1;
264: 1L
265: return
266: goto280
SendSysMessage( mobile, "It is not the Authorization code.", 3, 33 );
267: local #0
268: "It is not the Authorization code."
269: 3L
270: 33L
271: Func(2,1): SendSysMessage
272: #
NotifyStaffOnline( mobile, "has provided a wrong authorization code." );
273: local #0
274: "has provided a wrong authorization code."
275: makelocal
276: jmp userfunc @283
277: #
return 0;
278: 0L
279: return
280: leave block(1)
281: 0L
282: return
c:/ZH099/scripts/include/security.inc, Line 40
function NotifyStaffOnline( object, text )
283: pop param 'text'
284: pop param 'object'
var name := object.name;
285: decl local #2
286: local #1
287: get member id 'name' (3)
288: :=
289: #
if( !name )
290: local #2
291: if true goto 299
name := object.desc;
292: local #1
293: get member id 'desc' (19)
294: local2 := 
if( !name )
295: local #2
296: if true goto 299
name := object;
297: local #1
298: local2 := 
foreach character in EnumerateOnlineCharacters()
299: Func(2,8): EnumerateOnlineCharacters
300: initforeach @335
if( GetObjProperty( character, "Notify" ))
301: local #3
302: "Notify"
303: Func(2,4): GetObjProperty
304: if false goto 332
if( object.cmdlevel <= character.cmdlevel || character.cmdlevel >= 4 )
305: local #1
306: get member id 'cmdlevel' (46)
307: local #3
308: get member id 'cmdlevel' (46)
309: <=
310: local #3
311: get member id 'cmdlevel' (46)
312: 4L
313: >=
314: ||
315: if false goto 332
SendSysMessage( character, "You receive a notification:", 3, 55 );
316: local #3
317: "You receive a notification:"
318: 3L
319: 55L
320: Func(2,1): SendSysMessage
321: #
SendSysMessage( character, name+" >>> "+text, 3, 55 );
322: local #3
323: local #2
324: " >>> "
325: +
326: local #0
327: +
328: 3L
329: 55L
330: Func(2,1): SendSysMessage
331: #
SleepMS(5);
332: 5L
333: Func(3,0): Sleepms
334: #
335: stepforeach @301
336: leave block(3)
if( object.serial )
337: local #1
338: get member id 'serial' (6)
339: if false goto 356
ReportText( name+"["+object.serial+"] >>> "+text, REPORT_SYSLOG );
340: local #2
341: "["
342: +
343: local #1
344: get member id 'serial' (6)
345: +
346: "] >>> "
347: +
348: local #0
349: +
350: 2L
351: 0L
352: makelocal
353: jmp userfunc @368
354: #
355: goto366
ReportText( name+" >>> "+text, REPORT_SYSLOG );
356: local #2
357: " >>> "
358: +
359: local #0
360: +
361: 2L
362: 0L
363: makelocal
364: jmp userfunc @368
365: #
return 1;
366: 1L
367: return
c:/ZH099/pkg/utils/security/include/report.inc, Line 22
function ReportText( report_text:="?", flags:=REPORT_DISABLE, text_color:=0 )
368: pop param 'text_color'
369: pop param 'flags'
370: pop param 'report_text'
if( !flags )
371: local #1
372: if true goto 376
return 0;
373: 0L
374: return
375: goto431
elseif( flags & REPORT_CONSOLE )
376: local #1
377: 1L
378: &
379: if false goto 386
Print( ""+report_text );
380: ""
381: local #2
382: +
383: Func(1,0): Print
384: #
385: goto431
elseif( flags & REPORT_SYSLOG )
386: local #1
387: 2L
388: &
389: if false goto 420
var script_name := CStr( GetProcess( GetPid() ).name ),
390: decl local #0
391: Func(3,4): GetPid
392: Func(3,3): GetProcess
393: get member id 'name' (3)
394: Func(0,1): CStr
395: :=
396: #
397: decl local #1
398: local #3
399: makelocal
400: jmp userfunc @636
401: :=
402: #
LogToFile( "::log/"+pkg_name+".log", "["+script_name+"]: "+report_text, LOG_DAT
403: "::log/"
404: local #4
405: +
406: ".log"
407: +
408: "["
409: local #3
410: +
411: "]: "
412: +
413: local #2
414: +
415: 1L
416: Func(7,0): LogToFile
417: #
418: leave block(2)
419: goto431
elseif( flags & REPORT_BROADCAST )
420: local #1
421: 4L
422: &
423: if false goto 431
Broadcast( ""+report_text, 3, text_color );
424: ""
425: local #2
426: +
427: 3L
428: local #0
429: Func(2,3): Broadcast
430: #
return 1;
431: 1L
432: return
c:/ZH099/pkg/utils/gumps/include/requestgump.inc, Line 39
function RequestGump(mobile, question, option := "", pre_val := "", cancel_btn:
433: pop param 'cancel_btn'
434: pop param 'pre_val'
435: pop param 'option'
436: pop param 'question'
437: pop param 'mobile'
if ( !pre_val || pre_val == error )
438: local #1
439: !
440: local #1
441: error
442: ==
443: ||
444: if false goto 447
pre_val := "";
445: ""
446: local1 := 
var r_gump := GFCreateGump(140, 100);
447: decl local #5
448: 140L
449: 100L
450: 0L
451: 0L
452: makelocal
453: jmp userfunc @858
454: :=
455: #
GFClosable(r_gump, 0);
456: local #5
457: 0L
458: makelocal
459: jmp userfunc @799
460: #
GFResizePic(r_gump, 0, 0, GFGetCfgConst("Defaults", "BackGround"), 400, 205);
461: local #5
462: 0L
463: 0L
464: "Defaults"
465: "BackGround"
466: makelocal
467: jmp userfunc @967
468: 400L
469: 205L
470: makelocal
471: jmp userfunc @1029
472: #
GFResizePic(r_gump, 15, 15, GFGetCfgConst("Defaults", "ForeGround"), 370, 175);
473: local #5
474: 15L
475: 15L
476: "Defaults"
477: "ForeGround"
478: makelocal
479: jmp userfunc @967
480: 370L
481: 175L
482: makelocal
483: jmp userfunc @1029
484: #
GFAddAlphaRegion( r_gump, 0, 0, 400, 205 );
485: local #5
486: 0L
487: 0L
488: 400L
489: 205L
490: makelocal
491: jmp userfunc @683
492: #
var y_pos := 20;
493: decl local #6
494: 20L
495: :=
496: #
foreach line in (GFWordWrap(question, 370))
497: local #3
498: 370L
499: makelocal
500: jmp userfunc @1257
501: initforeach @517
GFTextLine(r_gump, 20, y_pos, 1153, line);
502: local #5
503: 20L
504: local #6
505: 1153L
506: local #7
507: makelocal
508: jmp userfunc @1208
509: #
y_pos += 20;
510: local #6
511: 20L
512: +=
513: #
SleepMS(2);
514: 2L
515: Func(3,0): Sleepms
516: #
517: stepforeach @502
518: leave block(3)
y_pos := 75;
519: 75L
520: local6 := 
foreach line in (GFWordWrap(option, 370))
521: local #2
522: 370L
523: makelocal
524: jmp userfunc @1257
525: initforeach @541
GFTextLine(r_gump, 20, y_pos, 1153, line);
526: local #5
527: 20L
528: local #6
529: 1153L
530: local #7
531: makelocal
532: jmp userfunc @1208
533: #
y_pos += 20;
534: local #6
535: 20L
536: +=
537: #
SleepMS(2);
538: 2L
539: Func(3,0): Sleepms
540: #
541: stepforeach @526
542: leave block(3)
GFResizePic(r_gump, 20, 100, GFGetCfgConst("BackGrounds", "GOLDTRIM"), 360, 30)
543: local #5
544: 20L
545: 100L
546: "BackGrounds"
547: "GOLDTRIM"
548: makelocal
549: jmp userfunc @967
550: 360L
551: 30L
552: makelocal
553: jmp userfunc @1029
554: #
var r_txt := GFTextEntry(r_gump, 30, 105, 335, 25, 1153, pre_val);
555: decl local #7
556: local #5
557: 30L
558: 105L
559: 335L
560: 25L
561: 1153L
562: local #1
563: 0L
564: makelocal
565: jmp userfunc @1124
566: :=
567: #
if ( cancel_btn )
568: local #0
569: if false goto 591
GFAddButton(r_gump, 90, 160, 2128, 2129, GF_CLOSE_BTN, 100);
570: local #5
571: 90L
572: 160L
573: 2128L
574: 2129L
575: 1L
576: 100L
577: makelocal
578: jmp userfunc @717
579: #
GFAddButton(r_gump, 240, 160, 2119, 2120, GF_CLOSE_BTN, 200);
580: local #5
581: 240L
582: 160L
583: 2119L
584: 2120L
585: 1L
586: 200L
587: makelocal
588: jmp userfunc @717
589: #
590: goto601
GFAddButton(r_gump, 180, 160, 2128, 2129, GF_CLOSE_BTN, 100);
591: local #5
592: 180L
593: 160L
594: 2128L
595: 2129L
596: 1L
597: 100L
598: makelocal
599: jmp userfunc @717
600: #
var input := GFSendGump(mobile, r_gump);
601: decl local #8
602: local #4
603: local #5
604: makelocal
605: jmp userfunc @1086
606: :=
607: #
var text_area := GFExtractData(input, r_txt);
608: decl local #9
609: local #8
610: local #7
611: makelocal
612: jmp userfunc @939
613: :=
614: #
if ( input[200] )
615: local #8
616: 200L
617: [] 1
618: if false goto 622
return error;
619: error
620: return
621: goto634
elseif ( !text_area || text_area == error )
622: local #9
623: !
624: local #9
625: error
626: ==
627: ||
628: if false goto 632
return 0;
629: 0L
630: return
631: goto634
return text_area;
632: local #9
633: return
634: 0L
635: return
c:/ZH099/pkg/utils/security/include/report.inc, Line 40
function GetPkgName( script_name )
636: pop param 'script_name'
var i;
637: decl local #1
638: #
for( i:=1; i<=len(script_name); i+=1 )
639: local #1
640: 1L
641: :=
642: #
643: local #1
644: local #0
645: Func(0,2): Len
646: <=
647: if false goto 667
if( !Check_ValidChar( script_name[i] ))
648: local #0
649: local #1
650: [] 1
651: 0L
652: makelocal
653: jmp userfunc @1396
654: if true goto 659
script_name[i] := " ";
655: local #0
656: local #1
657: " "
658: [] := (1) #
SleepMS(5);
659: 5L
660: Func(3,0): Sleepms
661: #
662: local #1
663: 1L
664: +=
665: #
666: goto643
foreach poss_pkg in ( SplitWords( script_name ))
667: local #0
668: " "
669: Func(0,5): SplitWords
670: initforeach @679
if( GetPackageByName( poss_pkg ))
671: local #2
672: Func(5,0): GetPackageByName
673: if false goto 676
return poss_pkg;
674: local #2
675: return
SleepMS(5);
676: 5L
677: Func(3,0): Sleepms
678: #
679: stepforeach @671
680: leave block(3)
return 0;
681: 0L
682: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 166
function GFAddAlphaRegion(byref gump, x, y, width, height)
683: pop param 'height'
684: pop param 'width'
685: pop param 'y'
686: pop param 'x'
687: pop param byref 'gump'
(gump.layout).Append("CheckerTrans "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
688: local #4
689: get member 'layout'
690: "CheckerTrans "
691: local #3
692: Func(0,0): CInt
693: Func(0,1): CStr
694: +
695: " "
696: +
697: local #2
698: Func(0,0): CInt
699: Func(0,1): CStr
700: +
701: " "
702: +
703: local #1
704: Func(0,0): CInt
705: Func(0,1): CStr
706: +
707: " "
708: +
709: local #0
710: Func(0,0): CInt
711: Func(0,1): CStr
712: +
713: Call Method id append (#52, 1 params)
714: #
return 1;
715: 1L
716: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 172
function GFAddButton(byref gump, x, y, off_id, on_id, btn_type:=GF_PAGE_BTN, bt
717: pop param 'btn_value'
718: pop param 'btn_type'
719: pop param 'on_id'
720: pop param 'off_id'
721: pop param 'y'
722: pop param 'x'
723: pop param byref 'gump'
var line := "Button "+CStr(x)+" "+CStr(y)+" "+CStr(off_id)+" "+CStr(on_id);
724: decl local #7
725: "Button "
726: local #5
727: Func(0,1): CStr
728: +
729: " "
730: +
731: local #4
732: Func(0,1): CStr
733: +
734: " "
735: +
736: local #3
737: Func(0,1): CStr
738: +
739: " "
740: +
741: local #2
742: Func(0,1): CStr
743: +
744: :=
745: #
btn_value := CInt(btn_value);
746: local #0
747: Func(0,0): CInt
748: local0 := 
if ( btn_value < 1 ) // Catch errors (0) and invalid (negative) values
749: local #0
750: 1L
751: <
752: if false goto 761
gump.data_id += 1;
753: local #6
754: get member 'data_id'
755: 1L
756: +=
757: #
btn_value := gump.data_id;
758: local #6
759: get member 'data_id'
760: local0 := 
if ( btn_type == GF_CLOSE_BTN )
761: local #1
762: 1L
763: ==
764: if false goto 773
line += " 1 0 "+CStr(btn_value);
765: local #7
766: " 1 0 "
767: local #0
768: Func(0,1): CStr
769: +
770: +=
771: #
772: goto792
elseif ( btn_type == GF_DUMMY_BTN )
773: local #1
774: 2L
775: ==
776: if false goto 785
line += " 0 0 "+CStr(btn_value);
777: local #7
778: " 0 0 "
779: local #0
780: Func(0,1): CStr
781: +
782: +=
783: #
784: goto792
line += " 0 "+CStr(btn_value);
785: local #7
786: " 0 "
787: local #0
788: Func(0,1): CStr
789: +
790: +=
791: #
(gump.layout).Append(line);
792: local #6
793: get member 'layout'
794: local #7
795: Call Method id append (#52, 1 params)
796: #
return (btn_value);
797: local #0
798: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 71
function GFClosable(byref gump, bool)
799: pop param 'bool'
800: pop param byref 'gump'
case ( bool )
801: local #0
802: casejmp
	0: @803
	1: @825
	default: @847
if ( gump.base.CloseLoc )
803: local #1
804: get member 'base'
805: get member 'CloseLoc'
806: if false goto 812
return XGFError("Gump already contains the 'NoClose' flag.");
807: "Gump already contains the 'NoClose' flag."
808: 0L
809: makelocal
810: jmp userfunc @1383
811: return
(gump.layout).Append("NoClose");
812: local #1
813: get member 'layout'
814: "NoClose"
815: Call Method id append (#52, 1 params)
816: #
gump.base.CloseLoc := (gump.layout).Size();
817: local #1
818: get member 'base'
819: local #1
820: get member 'layout'
821: Call Method id size (#48, 0 params)
822: set member 'CloseLoc' #
break;
823: goto824
824: goto856
if ( !gump.base.CloseLoc )
825: local #1
826: get member 'base'
827: get member 'CloseLoc'
828: if true goto 834
return XGFError("Gump is already closable.");
829: "Gump is already closable."
830: 0L
831: makelocal
832: jmp userfunc @1383
833: return
(gump.layout).Erase(gump.base.CloseLoc);
834: local #1
835: get member 'layout'
836: local #1
837: get member 'base'
838: get member 'CloseLoc'
839: Call Method id erase (#49, 1 params)
840: #
gump.base.CloseLoc := 0;
841: local #1
842: get member 'base'
843: 0L
844: set member 'CloseLoc' #
break;
845: goto846
846: goto856
return XGFError("gumps::Closable: Invalid bool value '"+bool+"'");
847: "gumps::Closable: Invalid bool value '"
848: local #0
849: +
850: "'"
851: +
852: 0L
853: makelocal
854: jmp userfunc @1383
855: return
return 1;
856: 1L
857: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 40
function GFCreateGump(x:=0, y:=0, width:=0, height:=0)
858: pop param 'height'
859: pop param 'width'
860: pop param 'y'
861: pop param 'x'
var gump := struct;
862: decl local #4
863: struct
864: :=
865: #
gump.+base := struct;
866: local #4
867: "base"
868: .+
869: struct
870: := #
gump.base.+x := CInt(x);
871: local #4
872: get member 'base'
873: "x"
874: .+
875: local #3
876: Func(0,0): CInt
877: := #
gump.base.+y := CInt(y);
878: local #4
879: get member 'base'
880: "y"
881: .+
882: local #2
883: Func(0,0): CInt
884: := #
gump.base.+width := CInt(width);
885: local #4
886: get member 'base'
887: "width"
888: .+
889: local #1
890: Func(0,0): CInt
891: := #
gump.base.+height := CInt(height);
892: local #4
893: get member 'base'
894: "height"
895: .+
896: local #0
897: Func(0,0): CInt
898: := #
gump.base.+MoveLoc := 0;	// Movable flag location
899: local #4
900: get member 'base'
901: "MoveLoc"
902: .+
903: 0L
904: := #
gump.base.+CloseLoc := 0;	// NoClose flag location
905: local #4
906: get member 'base'
907: "CloseLoc"
908: .+
909: 0L
910: := #
gump.base.+DisposeLoc := 0;	// NoDispose flag location
911: local #4
912: get member 'base'
913: "DisposeLoc"
914: .+
915: 0L
916: := #
gump.+layout	:= array;	// Main layout array for entire gump
917: local #4
918: "layout"
919: .+
920: array
921: := #
gump.+data	:= array;	// Storage array for static-text and
922: local #4
923: "data"
924: .+
925: array
926: := #
gump.+data_id	:= 1;
927: local #4
928: "data_id"
929: .+
930: 1L
931: := #
gump.+cur_page := 0;
932: local #4
933: "cur_page"
934: .+
935: 0L
936: := #
return(gump);
937: local #4
938: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 56
function GFExtractData(input, data_id)
939: pop param 'data_id'
940: pop param 'input'
var key_string := CStr(data_id)+": ";
941: decl local #2
942: local #0
943: Func(0,1): CStr
944: ": "
945: +
946: :=
947: #
var data_string := input[data_id];
948: decl local #3
949: local #1
950: local #0
951: [] 1
952: :=
953: #
var ret_val := data_string[Len(key_string)+1,Len(data_string)];
954: decl local #4
955: local #3
956: local #2
957: Func(0,2): Len
958: 1L
959: +
960: local #3
961: Func(0,2): Len
962: [,]
963: :=
964: #
return ret_val;
965: local #4
966: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 37
function GFGetCfgConst(elem_name, prop_name)
967: pop param 'prop_name'
968: pop param 'elem_name'
var cfg := ReadConfigFile(":gumps:GumpInfo");
969: decl local #2
970: ":gumps:GumpInfo"
971: Func(6,0): ReadConfigFile
972: :=
973: #
if ( cfg.errortext )
974: local #2
975: get member 'errortext'
976: if false goto 985
return XGFError("GFGetCfgConst():: Unable to open GumpInfo.cfg -> "+cfg.errorte
977: "GFGetCfgConst():: Unable to open GumpInfo.cfg -> "
978: local #2
979: get member 'errortext'
980: +
981: 0L
982: makelocal
983: jmp userfunc @1383
984: return
var elem := cfg[elem_name];
985: decl local #3
986: local #2
987: local #1
988: [] 1
989: :=
990: #
if ( elem.errortext )
991: local #3
992: get member 'errortext'
993: if false goto 1006
return XGFError("GFGetCfgConst():: Unable to find GumpInfo.cfg["+elem_name+"] -
994: "GFGetCfgConst():: Unable to find GumpInfo.cfg["
995: local #1
996: +
997: "] ->"
998: +
999: local #3
1000: get member 'errortext'
1001: +
1002: 0L
1003: makelocal
1004: jmp userfunc @1383
1005: return
var value := GetConfigInt(elem, prop_name);
1006: decl local #4
1007: local #3
1008: local #0
1009: Func(6,1): GetConfigInt
1010: :=
1011: #
if ( !value )
1012: local #4
1013: if true goto 1027
return XGFError("GFGetCfgConst():: Unable to find property ["+prop_name+"] in e
1014: "GFGetCfgConst():: Unable to find property ["
1015: local #0
1016: +
1017: "] in elem ["
1018: +
1019: local #1
1020: +
1021: "]"
1022: +
1023: 0L
1024: makelocal
1025: jmp userfunc @1383
1026: return
return value;
1027: local #4
1028: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 151
function GFResizePic(byref gump, x, y, gump_id, width, height)
1029: pop param 'height'
1030: pop param 'width'
1031: pop param 'gump_id'
1032: pop param 'y'
1033: pop param 'x'
1034: pop param byref 'gump'
width := CInt(width);
1035: local #1
1036: Func(0,0): CInt
1037: local1 := 
height := CInt(height);
1038: local #0
1039: Func(0,0): CInt
1040: local0 := 
if ( !width )
1041: local #1
1042: if true goto 1047
width := gump.base.width;
1043: local #5
1044: get member 'base'
1045: get member 'width'
1046: local1 := 
if ( !height )
1047: local #0
1048: if true goto 1053
height := gump.base.width;
1049: local #5
1050: get member 'base'
1051: get member 'width'
1052: local0 := 
(gump.layout).Append("ResizePic "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1053: local #5
1054: get member 'layout'
1055: "ResizePic "
1056: local #4
1057: Func(0,0): CInt
1058: Func(0,1): CStr
1059: +
1060: " "
1061: +
1062: local #3
1063: Func(0,0): CInt
1064: Func(0,1): CStr
1065: +
1066: " "
1067: +
1068: local #2
1069: Func(0,0): CInt
1070: Func(0,1): CStr
1071: +
1072: " "
1073: +
1074: local #1
1075: Func(0,1): CStr
1076: +
1077: " "
1078: +
1079: local #0
1080: Func(0,1): CStr
1081: +
1082: Call Method id append (#52, 1 params)
1083: #
return 1;
1084: 1L
1085: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 314
function GFSendGump(mobile, byref gump)
1086: pop param byref 'gump'
1087: pop param 'mobile'
var ret_val := SendDialogGump(mobile, gump.layout, gump.data, gump.base.x, gump
1088: decl local #2
1089: local #1
1090: local #0
1091: get member 'layout'
1092: local #0
1093: get member 'data'
1094: local #0
1095: get member 'base'
1096: get member id 'x' (0)
1097: local #0
1098: get member 'base'
1099: get member id 'y' (1)
1100: 0L
1101: Func(2,0): SendDialogGump
1102: :=
1103: #
if ( ret_val.errortext )
1104: local #2
1105: get member 'errortext'
1106: if false goto 1122
SendSysMessage(mobile, "Error - Unable to display gump.");
1107: local #1
1108: "Error - Unable to display gump."
1109: 3L
1110: 1000L
1111: Func(2,1): SendSysMessage
1112: #
SendSysMessage(mobile, "Error text is ->"+ret_val.errortext);
1113: local #1
1114: "Error text is ->"
1115: local #2
1116: get member 'errortext'
1117: +
1118: 3L
1119: 1000L
1120: Func(2,1): SendSysMessage
1121: #
return ret_val;
1122: local #2
1123: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 296
function GFTextEntry(byref gump, x, y, width, height, txt_color, ini_text:="", 
1124: pop param 'txt_id'
1125: pop param 'ini_text'
1126: pop param 'txt_color'
1127: pop param 'height'
1128: pop param 'width'
1129: pop param 'y'
1130: pop param 'x'
1131: pop param byref 'gump'
gump.data.Append(""+CStr(ini_text));
1132: local #7
1133: get member 'data'
1134: ""
1135: local #1
1136: Func(0,1): CStr
1137: +
1138: Call Method id append (#52, 1 params)
1139: #
var index := gump.data.Size()-1;
1140: decl local #8
1141: local #7
1142: get member 'data'
1143: Call Method id size (#48, 0 params)
1144: 1L
1145: -
1146: :=
1147: #
txt_id := CInt(txt_id);
1148: local #0
1149: Func(0,0): CInt
1150: local0 := 
if ( txt_id < 1 ) // Catch errors (0) and invalid (negative) values
1151: local #0
1152: 1L
1153: <
1154: if false goto 1163
gump.data_id += 1;
1155: local #7
1156: get member 'data_id'
1157: 1L
1158: +=
1159: #
txt_id := gump.data_id;
1160: local #7
1161: get member 'data_id'
1162: local0 := 
(gump.layout).Append("TextEntry "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1163: local #7
1164: get member 'layout'
1165: "TextEntry "
1166: local #6
1167: Func(0,0): CInt
1168: Func(0,1): CStr
1169: +
1170: " "
1171: +
1172: local #5
1173: Func(0,0): CInt
1174: Func(0,1): CStr
1175: +
1176: " "
1177: +
1178: local #4
1179: Func(0,0): CInt
1180: Func(0,1): CStr
1181: +
1182: " "
1183: +
1184: local #3
1185: Func(0,0): CInt
1186: Func(0,1): CStr
1187: +
1188: " "
1189: +
1190: local #2
1191: Func(0,0): CInt
1192: Func(0,1): CStr
1193: +
1194: " "
1195: +
1196: local #0
1197: Func(0,1): CStr
1198: +
1199: " "
1200: +
1201: local #8
1202: Func(0,1): CStr
1203: +
1204: Call Method id append (#52, 1 params)
1205: #
return (txt_id);
1206: local #0
1207: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 263
function GFTextLine(byref gump, x, y, hue:=0, text:="")
1208: pop param 'text'
1209: pop param 'hue'
1210: pop param 'y'
1211: pop param 'x'
1212: pop param byref 'gump'
gump.data.Append(""+CStr(text));
1213: local #4
1214: get member 'data'
1215: ""
1216: local #0
1217: Func(0,1): CStr
1218: +
1219: Call Method id append (#52, 1 params)
1220: #
var index := gump.data.Size()-1;
1221: decl local #5
1222: local #4
1223: get member 'data'
1224: Call Method id size (#48, 0 params)
1225: 1L
1226: -
1227: :=
1228: #
(gump.layout).Append("Text "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1229: local #4
1230: get member 'layout'
1231: "Text "
1232: local #3
1233: Func(0,0): CInt
1234: Func(0,1): CStr
1235: +
1236: " "
1237: +
1238: local #2
1239: Func(0,0): CInt
1240: Func(0,1): CStr
1241: +
1242: " "
1243: +
1244: local #1
1245: Func(0,0): CInt
1246: Func(0,1): CStr
1247: +
1248: " "
1249: +
1250: local #5
1251: Func(0,1): CStr
1252: +
1253: Call Method id append (#52, 1 params)
1254: #
return (index);
1255: local #5
1256: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 165
function GFWordWrap(text, pixels)
1257: pop param 'pixels'
1258: pop param 'text'
var wrap_lines := array{};
1259: decl local #2
1260: array
1261: :=
1262: #
var word_list := SplitWords(text);
1263: decl local #3
1264: local #1
1265: " "
1266: Func(0,5): SplitWords
1267: :=
1268: #
var space_size := GFTextWidth(" ");
1269: decl local #4
1270: " "
1271: makelocal
1272: jmp userfunc @1585
1273: :=
1274: #
var cur_line := "";
1275: decl local #5
1276: ""
1277: :=
1278: #
var cur_length := 0;
1279: decl local #6
1280: 0L
1281: :=
1282: #
var start_new := 0;
1283: decl local #7
1284: 0L
1285: :=
1286: #
foreach word in ( word_list )
1287: local #3
1288: initforeach @1356
var word_width := GFTextWidth(word);
1289: decl local #0
1290: local #8
1291: makelocal
1292: jmp userfunc @1585
1293: :=
1294: #
if ( word == "[P]" )
1295: local #8
1296: "[P]"
1297: ==
1298: if false goto 1306
word := "";
1299: ""
1300: local8 := 
word_width := 0;
1301: 0L
1302: local11 := 
start_new := 1;
1303: 1L
1304: local7 := 
1305: goto1326
elseif ( (word_width+cur_length) > pixels )
1306: local #11
1307: local #6
1308: +
1309: local #0
1310: >
1311: if false goto 1326
start_new := 1;
1312: 1L
1313: local7 := 
if ( cur_line[Len(cur_line)] == " " )
1314: local #5
1315: local #5
1316: Func(0,2): Len
1317: [] 1
1318: " "
1319: ==
1320: if false goto 1326
cur_line[Len(cur_line)] := "";
1321: local #5
1322: local #5
1323: Func(0,2): Len
1324: ""
1325: [] := (1) #
if ( start_new )
1326: local #7
1327: if false goto 1338
start_new := 0;
1328: 0L
1329: local7 := 
wrap_lines.Append(cur_line);
1330: local #2
1331: local #5
1332: Call Method id append (#52, 1 params)
1333: #
cur_line := "";
1334: ""
1335: local5 := 
cur_length := 0;
1336: 0L
1337: local6 := 
if ( word )
1338: local #8
1339: if false goto 1352
cur_line += word+" ";
1340: local #5
1341: local #8
1342: " "
1343: +
1344: +=
1345: #
cur_length += word_width+space_size;
1346: local #6
1347: local #11
1348: local #4
1349: +
1350: +=
1351: #
SleepMS(2);
1352: 2L
1353: Func(3,0): Sleepms
1354: #
1355: leave block(1)
1356: stepforeach @1289
1357: leave block(3)
if ( wrap_lines[wrap_lines.Size()] != cur_line )
1358: local #2
1359: local #2
1360: Call Method id size (#48, 0 params)
1361: [] 1
1362: local #5
1363: <>
1364: if false goto 1381
if ( cur_line[Len(cur_line)] == " " )
1365: local #5
1366: local #5
1367: Func(0,2): Len
1368: [] 1
1369: " "
1370: ==
1371: if false goto 1377
cur_line[Len(cur_line)] := "";
1372: local #5
1373: local #5
1374: Func(0,2): Len
1375: ""
1376: [] := (1) #
wrap_lines.Append(cur_line);
1377: local #2
1378: local #5
1379: Call Method id append (#52, 1 params)
1380: #
return wrap_lines;
1381: local #2
1382: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 335
function XGFError(text, log:=0)
1383: pop param 'log'
1384: pop param 'text'
if ( log )
1385: local #0
1386: if false goto 1392
SysLog("Gump Error:: "+text);
1387: "Gump Error:: "
1388: local #1
1389: +
1390: Func(3,1): SysLog
1391: #
return error{"errortext":=text};
1392: error
1393: local #1
1394: addmember-assign(errortext)
1395: return
c:/ZH099/scripts/include/string.inc, Line 147
function Check_ValidChar( text, allow_space:=0 )
1396: pop param 'allow_space'
1397: pop param 'text'
var valid_char := array{ "a", "b", "c", "d", "e", "f", "g",
1398: decl local #2
1399: array
1400: "a"
1401: init{}
1402: "b"
1403: init{}
1404: "c"
1405: init{}
1406: "d"
1407: init{}
1408: "e"
1409: init{}
1410: "f"
1411: init{}
1412: "g"
1413: init{}
1414: "h"
1415: init{}
1416: "i"
1417: init{}
1418: "j"
1419: init{}
1420: "k"
1421: init{}
1422: "l"
1423: init{}
1424: "m"
1425: init{}
1426: "n"
1427: init{}
1428: "o"
1429: init{}
1430: "p"
1431: init{}
1432: "q"
1433: init{}
1434: "r"
1435: init{}
1436: "s"
1437: init{}
1438: "t"
1439: init{}
1440: "u"
1441: init{}
1442: "v"
1443: init{}
1444: "w"
1445: init{}
1446: "x"
1447: init{}
1448: "y"
1449: init{}
1450: "z"
1451: init{}
1452: "A"
1453: init{}
1454: "B"
1455: init{}
1456: "C"
1457: init{}
1458: "D"
1459: init{}
1460: "E"
1461: init{}
1462: "F"
1463: init{}
1464: "G"
1465: init{}
1466: "H"
1467: init{}
1468: "I"
1469: init{}
1470: "P"
1471: init{}
1472: "O"
1473: init{}
1474: "N"
1475: init{}
1476: "M"
1477: init{}
1478: "L"
1479: init{}
1480: "K"
1481: init{}
1482: "J"
1483: init{}
1484: "Q"
1485: init{}
1486: "R"
1487: init{}
1488: "S"
1489: init{}
1490: "T"
1491: init{}
1492: "U"
1493: init{}
1494: "V"
1495: init{}
1496: "W"
1497: init{}
1498: "X"
1499: init{}
1500: "Y"
1501: init{}
1502: "Z"
1503: init{}
1504: "1"
1505: init{}
1506: "2"
1507: init{}
1508: "3"
1509: init{}
1510: "4"
1511: init{}
1512: "5"
1513: init{}
1514: "6"
1515: init{}
1516: "7"
1517: init{}
1518: "8"
1519: init{}
1520: "9"
1521: init{}
1522: "0"
1523: init{}
1524: :=
1525: #
var len_text := Len( text );
1526: decl local #3
1527: local #1
1528: Func(0,2): Len
1529: :=
1530: #
var i;
1531: decl local #4
1532: #
for( i:=1; i<=len_text; i+=1 )
1533: local #4
1534: 1L
1535: :=
1536: #
1537: local #4
1538: local #3
1539: <=
1540: if false goto 1583
SleepMS(5);
1541: 5L
1542: Func(3,0): Sleepms
1543: #
var letter := CStr( text[i] );
1544: decl local #0
1545: local #1
1546: local #4
1547: [] 1
1548: Func(0,1): CStr
1549: :=
1550: #
if( letter in valid_char )
1551: local #5
1552: local #2
1553: in
1554: if false goto 1558
continue;
1555: leave block(1)
1556: goto1578
1557: goto1575
elseif( allow_space && ( text[i] == " " || CAsc( text[i] ) == 0 ))
1558: local #0
1559: local #1
1560: local #4
1561: [] 1
1562: " "
1563: ==
1564: local #1
1565: local #4
1566: [] 1
1567: Func(0,7): CAsc
1568: 0L
1569: ==
1570: ||
1571: &&
1572: if false goto 1575
continue;
1573: leave block(1)
1574: goto1578
return 0;
1575: 0L
1576: return
1577: leave block(1)
1578: local #4
1579: 1L
1580: +=
1581: #
1582: goto1537
return 1;
1583: 1L
1584: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 124
function GFTextWidth(gump_text)
1585: pop param 'gump_text'
var gft_length := struct;
1586: decl local #1
1587: struct
1588: :=
1589: #
gft_length.+charsf :=
1590: local #1
1591: "charsf"
1592: .+
1593: "||||||||||||||`',.;:::::::::!!!!!!!!!!!!!!il1[]]]]]]]]]"bcejot”(){}===adfpqrszI„~~~~ghnuvy<>-----xJ578$?++++++ kCE2369^/*****mwABDFOPŽ™40%%GLNQSZ@#######HRT&__________KšUYYYYYYYYYYYXXXXXXXXXXXXXXVVVVVVVVVVVVVVMMMMMMMMMMMMMMWWWWWWWWWWWWWW"
1594: := #
gft_length.+width := array
1595: local #1
1596: "width"
1597: .+
1598: array
1599: 2L
1600: init{}
1601: 3L
1602: init{}
1603: 4L
1604: init{}
1605: 5L
1606: init{}
1607: 6L
1608: init{}
1609: 7L
1610: init{}
1611: 8L
1612: init{}
1613: 9L
1614: init{}
1615: 10L
1616: init{}
1617: 11L
1618: init{}
1619: 12L
1620: init{}
1621: 13L
1622: init{}
1623: 14L
1624: init{}
1625: 15L
1626: init{}
1627: 16L
1628: init{}
1629: 18L
1630: init{}
1631: 21L
1632: init{}
1633: := #
var points:=0;
1634: decl local #2
1635: 0L
1636: :=
1637: #
var j := Len(gump_text);
1638: decl local #3
1639: local #0
1640: Func(0,2): Len
1641: :=
1642: #
for ( j; j>0; j-=1 )
1643: local #3
1644: #
1645: local #3
1646: 0L
1647: >
1648: if false goto 1693
var i := Find(gft_length.charsf, gump_text[j], 1) - 1;
1649: decl local #0
1650: local #1
1651: get member 'charsf'
1652: local #0
1653: local #3
1654: [] 1
1655: 1L
1656: Func(0,4): Find
1657: 1L
1658: -
1659: :=
1660: #
if ( i>=0 )
1661: local #4
1662: 0L
1663: >=
1664: if false goto 1678
points += gft_length.width[CInt(i/14)+1];
1665: local #2
1666: local #1
1667: get member 'width'
1668: local #4
1669: 14L
1670: /
1671: Func(0,0): CInt
1672: 1L
1673: +
1674: [] 1
1675: +=
1676: #
1677: goto1687
print("XGFTextWidth: Unknown Character = '"+gump_text[j]+"'");
1678: "XGFTextWidth: Unknown Character = '"
1679: local #0
1680: local #3
1681: [] 1
1682: +
1683: "'"
1684: +
1685: Func(1,0): Print
1686: #
1687: leave block(1)
1688: local #3
1689: 1L
1690: -=
1691: #
1692: goto1645
return (points);
1693: local #2
1694: return
