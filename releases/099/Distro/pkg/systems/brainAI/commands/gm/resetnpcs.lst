c:/ZH099/pkg/systems/classes/include/classes.inc, Line 26
var settings := Classes_GetSettingsCfgElem( "Settings" );
0: decl global #0
1: "Settings"
2: 0L
3: makelocal
4: jmp userfunc @187
5: :=
6: #
c:/ZH099/pkg/utils/datafile/include/datafile.inc, Line 35
var DF_DEBUG_MODE	:= 0;
7: decl global #1
8: 0L
9: :=
10: #
C:\ZH099\pkg\systems\brainAI\commands\gm\resetnpcs.src, Line 13
program textcmd_resetAllNPCs(who)
include ":datafile:datafile";
11: get arg 'who'
if( !AuthorizationCode( who ))
12: local #0
13: makelocal
14: jmp userfunc @114
15: if true goto 24
SendSysMessage( who, "Cancelled." );
16: local #0
17: "Cancelled."
18: 3L
19: 1000L
20: Func(2,3): SendSysMessage
21: #
return 0;
22: 0L
23: progend
var realm_name := RequestGump(who, "Enter the realm name to perform the AI rest
24: decl local #1
25: local #0
26: "Enter the realm name to perform the AI restarts on."
27: ""
28: local #0
29: get member id 'realm' (112)
30: 0L
31: makelocal
32: jmp userfunc @381
33: :=
34: #
var realm_info := Realms()[realm_name];
35: decl local #2
36: ""
37: Func(4,1): Realms
38: local #1
39: [] 1
40: :=
41: #
if ( !realm_info )
42: local #2
43: if true goto 52
SendSysMessage(who, "Invalid realm name.");
44: local #0
45: "Invalid realm name."
46: 3L
47: 1000L
48: Func(2,3): SendSysMessage
49: #
return 0;
50: 0L
51: progend
SendSysMessage(who, "Starting NPC AI reset.");
52: local #0
53: "Starting NPC AI reset."
54: 3L
55: 1000L
56: Func(2,3): SendSysMessage
57: #
var x1 := 1, y1 := 1, x2 := realm_info.width, y2 := realm_info.height;
58: decl local #3
59: 1L
60: :=
61: #
62: decl local #4
63: 1L
64: :=
65: #
66: decl local #5
67: local #2
68: get member 'width'
69: :=
70: #
71: decl local #6
72: local #2
73: get member id 'height' (8)
74: :=
75: #
var z1 := -120, z2 := 120;
76: decl local #7
77: -120L
78: :=
79: #
80: decl local #8
81: 120L
82: :=
83: #
foreach mobile in ListObjectsInBox( x1, y1, z1, x2, y2, z2)
84: local #3
85: local #4
86: local #7
87: local #5
88: local #6
89: local #8
90: "britannia"
91: Func(2,11): ListObjectsInBox
92: initforeach @102
if (mobile.npctemplate)
93: local #9
94: get member id 'npctemplate' (62)
95: if false goto 99
RestartScript(mobile);
96: local #9
97: Func(2,12): RestartScript
98: #
SleepMS(5);
99: 5L
100: Func(3,3): Sleepms
101: #
102: stepforeach @93
103: leave block(3)
SendSysMessage(who, "Done restarting all npcs.");
104: local #0
105: "Done restarting all npcs."
106: 3L
107: 1000L
108: Func(2,3): SendSysMessage
109: #
return 1;
110: 1L
111: progend
112: leave block(9)
113: progend
c:/ZH099/scripts/include/security.inc, Line 14
function AuthorizationCode( mobile )
114: pop param 'mobile'
if( GetObjProperty( mobile, "#AuthCodeGiven" ));
115: local #0
116: "#AuthCodeGiven"
117: Func(2,6): GetObjProperty
118: if false goto 121
return 1;
119: 1L
120: return
var autocode := GetGlobalProperty( "CA" );
121: decl local #1
122: "CA"
123: Func(2,7): GetGlobalProperty
124: :=
125: #
if( !autocode )
126: local #1
127: if true goto 143
SendSysMessage( mobile, "Authorization code is not given yet.", 3, 53 );
128: local #0
129: "Authorization code is not given yet."
130: 3L
131: 53L
132: Func(2,3): SendSysMessage
133: #
SendSysMessage( mobile, "Uses .setauthcode to create a new code.", 3, 53 );
134: local #0
135: "Uses .setauthcode to create a new code."
136: 3L
137: 53L
138: Func(2,3): SendSysMessage
139: #
return 0;
140: 0L
141: return
142: goto185
var code := SendTextEntryGump( mobile, "Enter the Authorization Code.", TE_CANC
143: decl local #0
144: local #0
145: "Enter the Authorization Code."
146: 1L
147: 1L
148: 10L
149: ""
150: Func(2,8): SendTextEntryGump
151: :=
152: #
if( code == autocode )
153: local #2
154: local #1
155: ==
156: if false goto 171
SendSysMessage( mobile, "Code Accepted!", 3, 70 );
157: local #0
158: "Code Accepted!"
159: 3L
160: 70L
161: Func(2,3): SendSysMessage
162: #
SetObjProperty( mobile, "#AuthCodeGiven", 1 );
163: local #0
164: "#AuthCodeGiven"
165: 1L
166: Func(2,9): SetObjProperty
167: #
return 1;
168: 1L
169: return
170: goto184
SendSysMessage( mobile, "It is not the Authorization code.", 3, 33 );
171: local #0
172: "It is not the Authorization code."
173: 3L
174: 33L
175: Func(2,3): SendSysMessage
176: #
NotifyStaffOnline( mobile, "has provided a wrong authorization code." );
177: local #0
178: "has provided a wrong authorization code."
179: makelocal
180: jmp userfunc @231
181: #
return 0;
182: 0L
183: return
184: leave block(1)
185: 0L
186: return
c:/ZH099/pkg/systems/classes/include/settings.inc, Line 20
function Classes_GetSettingsCfgElem( elem_name, byref cfg_file:=0 )
187: pop param byref 'cfg_file'
188: pop param 'elem_name'
if( !cfg_file )
189: local #0
190: if true goto 194
cfg_file := Classes_GetSettingsCfgFile();
191: makelocal
192: jmp userfunc @215
193: local0 := 
var elem := cfg_file[elem_name];
194: decl local #2
195: local #0
196: local #1
197: [] 1
198: :=
199: #
if( elem.errortext )
200: local #2
201: get member 'errortext'
202: if false goto 213
SysLog( "Error::Classes_GetSettingsCfgElem() - Unable to find elem ["+elem_name
203: "Error::Classes_GetSettingsCfgElem() - Unable to find elem ["
204: local #1
205: +
206: "] ->"
207: +
208: local #2
209: get member 'errortext'
210: +
211: Func(3,4): SysLog
212: #
return elem;
213: local #2
214: return
c:/ZH099/pkg/systems/classes/include/settings.inc, Line 12
function Classes_GetSettingsCfgFile()
var cfg := ReadConfigFile( ":classes:settings" );
215: decl local #0
216: ":classes:settings"
217: Func(6,0): ReadConfigFile
218: :=
219: #
if( cfg.errortext )
220: local #0
221: get member 'errortext'
222: if false goto 229
SysLog( "Error::Classes_GetSettingsCfgFile() - Unable to open [:classes:setting
223: "Error::Classes_GetSettingsCfgFile() - Unable to open [:classes:settings.cfg] ->"
224: local #0
225: get member 'errortext'
226: +
227: Func(3,4): SysLog
228: #
return cfg;
229: local #0
230: return
c:/ZH099/scripts/include/security.inc, Line 40
function NotifyStaffOnline( object, text )
231: pop param 'text'
232: pop param 'object'
var name := object.name;
233: decl local #2
234: local #1
235: get member id 'name' (3)
236: :=
237: #
if( !name )
238: local #2
239: if true goto 247
name := object.desc;
240: local #1
241: get member id 'desc' (19)
242: local2 := 
if( !name )
243: local #2
244: if true goto 247
name := object;
245: local #1
246: local2 := 
foreach character in EnumerateOnlineCharacters()
247: Func(2,10): EnumerateOnlineCharacters
248: initforeach @283
if( GetObjProperty( character, "Notify" ))
249: local #3
250: "Notify"
251: Func(2,6): GetObjProperty
252: if false goto 280
if( object.cmdlevel <= character.cmdlevel || character.cmdlevel >= 4 )
253: local #1
254: get member id 'cmdlevel' (46)
255: local #3
256: get member id 'cmdlevel' (46)
257: <=
258: local #3
259: get member id 'cmdlevel' (46)
260: 4L
261: >=
262: ||
263: if false goto 280
SendSysMessage( character, "You receive a notification:", 3, 55 );
264: local #3
265: "You receive a notification:"
266: 3L
267: 55L
268: Func(2,3): SendSysMessage
269: #
SendSysMessage( character, name+" >>> "+text, 3, 55 );
270: local #3
271: local #2
272: " >>> "
273: +
274: local #0
275: +
276: 3L
277: 55L
278: Func(2,3): SendSysMessage
279: #
SleepMS(5);
280: 5L
281: Func(3,3): Sleepms
282: #
283: stepforeach @249
284: leave block(3)
if( object.serial )
285: local #1
286: get member id 'serial' (6)
287: if false goto 304
ReportText( name+"["+object.serial+"] >>> "+text, REPORT_SYSLOG );
288: local #2
289: "["
290: +
291: local #1
292: get member id 'serial' (6)
293: +
294: "] >>> "
295: +
296: local #0
297: +
298: 2L
299: 0L
300: makelocal
301: jmp userfunc @316
302: #
303: goto314
ReportText( name+" >>> "+text, REPORT_SYSLOG );
304: local #2
305: " >>> "
306: +
307: local #0
308: +
309: 2L
310: 0L
311: makelocal
312: jmp userfunc @316
313: #
return 1;
314: 1L
315: return
c:/ZH099/pkg/utils/security/include/report.inc, Line 22
function ReportText( report_text:="?", flags:=REPORT_DISABLE, text_color:=0 )
316: pop param 'text_color'
317: pop param 'flags'
318: pop param 'report_text'
if( !flags )
319: local #1
320: if true goto 324
return 0;
321: 0L
322: return
323: goto379
elseif( flags & REPORT_CONSOLE )
324: local #1
325: 1L
326: &
327: if false goto 334
Print( ""+report_text );
328: ""
329: local #2
330: +
331: Func(1,0): Print
332: #
333: goto379
elseif( flags & REPORT_SYSLOG )
334: local #1
335: 2L
336: &
337: if false goto 368
var script_name := CStr( GetProcess( GetPid() ).name ),
338: decl local #0
339: Func(3,1): GetPid
340: Func(3,0): GetProcess
341: get member id 'name' (3)
342: Func(0,1): CStr
343: :=
344: #
345: decl local #1
346: local #3
347: makelocal
348: jmp userfunc @584
349: :=
350: #
LogToFile( "::log/"+pkg_name+".log", "["+script_name+"]: "+report_text, LOG_DAT
351: "::log/"
352: local #4
353: +
354: ".log"
355: +
356: "["
357: local #3
358: +
359: "]: "
360: +
361: local #2
362: +
363: 1L
364: Func(7,0): LogToFile
365: #
366: leave block(2)
367: goto379
elseif( flags & REPORT_BROADCAST )
368: local #1
369: 4L
370: &
371: if false goto 379
Broadcast( ""+report_text, 3, text_color );
372: ""
373: local #2
374: +
375: 3L
376: local #0
377: Func(2,5): Broadcast
378: #
return 1;
379: 1L
380: return
c:/ZH099/pkg/utils/gumps/include/requestgump.inc, Line 39
function RequestGump(mobile, question, option := "", pre_val := "", cancel_btn:
381: pop param 'cancel_btn'
382: pop param 'pre_val'
383: pop param 'option'
384: pop param 'question'
385: pop param 'mobile'
if ( !pre_val || pre_val == error )
386: local #1
387: !
388: local #1
389: error
390: ==
391: ||
392: if false goto 395
pre_val := "";
393: ""
394: local1 := 
var r_gump := GFCreateGump(140, 100);
395: decl local #5
396: 140L
397: 100L
398: 0L
399: 0L
400: makelocal
401: jmp userfunc @806
402: :=
403: #
GFClosable(r_gump, 0);
404: local #5
405: 0L
406: makelocal
407: jmp userfunc @747
408: #
GFResizePic(r_gump, 0, 0, GFGetCfgConst("Defaults", "BackGround"), 400, 205);
409: local #5
410: 0L
411: 0L
412: "Defaults"
413: "BackGround"
414: makelocal
415: jmp userfunc @915
416: 400L
417: 205L
418: makelocal
419: jmp userfunc @977
420: #
GFResizePic(r_gump, 15, 15, GFGetCfgConst("Defaults", "ForeGround"), 370, 175);
421: local #5
422: 15L
423: 15L
424: "Defaults"
425: "ForeGround"
426: makelocal
427: jmp userfunc @915
428: 370L
429: 175L
430: makelocal
431: jmp userfunc @977
432: #
GFAddAlphaRegion( r_gump, 0, 0, 400, 205 );
433: local #5
434: 0L
435: 0L
436: 400L
437: 205L
438: makelocal
439: jmp userfunc @631
440: #
var y_pos := 20;
441: decl local #6
442: 20L
443: :=
444: #
foreach line in (GFWordWrap(question, 370))
445: local #3
446: 370L
447: makelocal
448: jmp userfunc @1205
449: initforeach @465
GFTextLine(r_gump, 20, y_pos, 1153, line);
450: local #5
451: 20L
452: local #6
453: 1153L
454: local #7
455: makelocal
456: jmp userfunc @1156
457: #
y_pos += 20;
458: local #6
459: 20L
460: +=
461: #
SleepMS(2);
462: 2L
463: Func(3,3): Sleepms
464: #
465: stepforeach @450
466: leave block(3)
y_pos := 75;
467: 75L
468: local6 := 
foreach line in (GFWordWrap(option, 370))
469: local #2
470: 370L
471: makelocal
472: jmp userfunc @1205
473: initforeach @489
GFTextLine(r_gump, 20, y_pos, 1153, line);
474: local #5
475: 20L
476: local #6
477: 1153L
478: local #7
479: makelocal
480: jmp userfunc @1156
481: #
y_pos += 20;
482: local #6
483: 20L
484: +=
485: #
SleepMS(2);
486: 2L
487: Func(3,3): Sleepms
488: #
489: stepforeach @474
490: leave block(3)
GFResizePic(r_gump, 20, 100, GFGetCfgConst("BackGrounds", "GOLDTRIM"), 360, 30)
491: local #5
492: 20L
493: 100L
494: "BackGrounds"
495: "GOLDTRIM"
496: makelocal
497: jmp userfunc @915
498: 360L
499: 30L
500: makelocal
501: jmp userfunc @977
502: #
var r_txt := GFTextEntry(r_gump, 30, 105, 335, 25, 1153, pre_val);
503: decl local #7
504: local #5
505: 30L
506: 105L
507: 335L
508: 25L
509: 1153L
510: local #1
511: 0L
512: makelocal
513: jmp userfunc @1072
514: :=
515: #
if ( cancel_btn )
516: local #0
517: if false goto 539
GFAddButton(r_gump, 90, 160, 2128, 2129, GF_CLOSE_BTN, 100);
518: local #5
519: 90L
520: 160L
521: 2128L
522: 2129L
523: 1L
524: 100L
525: makelocal
526: jmp userfunc @665
527: #
GFAddButton(r_gump, 240, 160, 2119, 2120, GF_CLOSE_BTN, 200);
528: local #5
529: 240L
530: 160L
531: 2119L
532: 2120L
533: 1L
534: 200L
535: makelocal
536: jmp userfunc @665
537: #
538: goto549
GFAddButton(r_gump, 180, 160, 2128, 2129, GF_CLOSE_BTN, 100);
539: local #5
540: 180L
541: 160L
542: 2128L
543: 2129L
544: 1L
545: 100L
546: makelocal
547: jmp userfunc @665
548: #
var input := GFSendGump(mobile, r_gump);
549: decl local #8
550: local #4
551: local #5
552: makelocal
553: jmp userfunc @1034
554: :=
555: #
var text_area := GFExtractData(input, r_txt);
556: decl local #9
557: local #8
558: local #7
559: makelocal
560: jmp userfunc @887
561: :=
562: #
if ( input[200] )
563: local #8
564: 200L
565: [] 1
566: if false goto 570
return error;
567: error
568: return
569: goto582
elseif ( !text_area || text_area == error )
570: local #9
571: !
572: local #9
573: error
574: ==
575: ||
576: if false goto 580
return 0;
577: 0L
578: return
579: goto582
return text_area;
580: local #9
581: return
582: 0L
583: return
c:/ZH099/pkg/utils/security/include/report.inc, Line 40
function GetPkgName( script_name )
584: pop param 'script_name'
var i;
585: decl local #1
586: #
for( i:=1; i<=len(script_name); i+=1 )
587: local #1
588: 1L
589: :=
590: #
591: local #1
592: local #0
593: Func(0,2): Len
594: <=
595: if false goto 615
if( !Check_ValidChar( script_name[i] ))
596: local #0
597: local #1
598: [] 1
599: 0L
600: makelocal
601: jmp userfunc @1344
602: if true goto 607
script_name[i] := " ";
603: local #0
604: local #1
605: " "
606: [] := (1) #
SleepMS(5);
607: 5L
608: Func(3,3): Sleepms
609: #
610: local #1
611: 1L
612: +=
613: #
614: goto591
foreach poss_pkg in ( SplitWords( script_name ))
615: local #0
616: " "
617: Func(0,5): SplitWords
618: initforeach @627
if( GetPackageByName( poss_pkg ))
619: local #2
620: Func(4,0): GetPackageByName
621: if false goto 624
return poss_pkg;
622: local #2
623: return
SleepMS(5);
624: 5L
625: Func(3,3): Sleepms
626: #
627: stepforeach @619
628: leave block(3)
return 0;
629: 0L
630: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 166
function GFAddAlphaRegion(byref gump, x, y, width, height)
631: pop param 'height'
632: pop param 'width'
633: pop param 'y'
634: pop param 'x'
635: pop param byref 'gump'
(gump.layout).Append("CheckerTrans "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
636: local #4
637: get member 'layout'
638: "CheckerTrans "
639: local #3
640: Func(0,0): CInt
641: Func(0,1): CStr
642: +
643: " "
644: +
645: local #2
646: Func(0,0): CInt
647: Func(0,1): CStr
648: +
649: " "
650: +
651: local #1
652: Func(0,0): CInt
653: Func(0,1): CStr
654: +
655: " "
656: +
657: local #0
658: Func(0,0): CInt
659: Func(0,1): CStr
660: +
661: Call Method id append (#52, 1 params)
662: #
return 1;
663: 1L
664: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 172
function GFAddButton(byref gump, x, y, off_id, on_id, btn_type:=GF_PAGE_BTN, bt
665: pop param 'btn_value'
666: pop param 'btn_type'
667: pop param 'on_id'
668: pop param 'off_id'
669: pop param 'y'
670: pop param 'x'
671: pop param byref 'gump'
var line := "Button "+CStr(x)+" "+CStr(y)+" "+CStr(off_id)+" "+CStr(on_id);
672: decl local #7
673: "Button "
674: local #5
675: Func(0,1): CStr
676: +
677: " "
678: +
679: local #4
680: Func(0,1): CStr
681: +
682: " "
683: +
684: local #3
685: Func(0,1): CStr
686: +
687: " "
688: +
689: local #2
690: Func(0,1): CStr
691: +
692: :=
693: #
btn_value := CInt(btn_value);
694: local #0
695: Func(0,0): CInt
696: local0 := 
if ( btn_value < 1 ) // Catch errors (0) and invalid (negative) values
697: local #0
698: 1L
699: <
700: if false goto 709
gump.data_id += 1;
701: local #6
702: get member 'data_id'
703: 1L
704: +=
705: #
btn_value := gump.data_id;
706: local #6
707: get member 'data_id'
708: local0 := 
if ( btn_type == GF_CLOSE_BTN )
709: local #1
710: 1L
711: ==
712: if false goto 721
line += " 1 0 "+CStr(btn_value);
713: local #7
714: " 1 0 "
715: local #0
716: Func(0,1): CStr
717: +
718: +=
719: #
720: goto740
elseif ( btn_type == GF_DUMMY_BTN )
721: local #1
722: 2L
723: ==
724: if false goto 733
line += " 0 0 "+CStr(btn_value);
725: local #7
726: " 0 0 "
727: local #0
728: Func(0,1): CStr
729: +
730: +=
731: #
732: goto740
line += " 0 "+CStr(btn_value);
733: local #7
734: " 0 "
735: local #0
736: Func(0,1): CStr
737: +
738: +=
739: #
(gump.layout).Append(line);
740: local #6
741: get member 'layout'
742: local #7
743: Call Method id append (#52, 1 params)
744: #
return (btn_value);
745: local #0
746: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 71
function GFClosable(byref gump, bool)
747: pop param 'bool'
748: pop param byref 'gump'
case ( bool )
749: local #0
750: casejmp
	0: @751
	1: @773
	default: @795
if ( gump.base.CloseLoc )
751: local #1
752: get member 'base'
753: get member 'CloseLoc'
754: if false goto 760
return XGFError("Gump already contains the 'NoClose' flag.");
755: "Gump already contains the 'NoClose' flag."
756: 0L
757: makelocal
758: jmp userfunc @1331
759: return
(gump.layout).Append("NoClose");
760: local #1
761: get member 'layout'
762: "NoClose"
763: Call Method id append (#52, 1 params)
764: #
gump.base.CloseLoc := (gump.layout).Size();
765: local #1
766: get member 'base'
767: local #1
768: get member 'layout'
769: Call Method id size (#48, 0 params)
770: set member 'CloseLoc' #
break;
771: goto772
772: goto804
if ( !gump.base.CloseLoc )
773: local #1
774: get member 'base'
775: get member 'CloseLoc'
776: if true goto 782
return XGFError("Gump is already closable.");
777: "Gump is already closable."
778: 0L
779: makelocal
780: jmp userfunc @1331
781: return
(gump.layout).Erase(gump.base.CloseLoc);
782: local #1
783: get member 'layout'
784: local #1
785: get member 'base'
786: get member 'CloseLoc'
787: Call Method id erase (#49, 1 params)
788: #
gump.base.CloseLoc := 0;
789: local #1
790: get member 'base'
791: 0L
792: set member 'CloseLoc' #
break;
793: goto794
794: goto804
return XGFError("gumps::Closable: Invalid bool value '"+bool+"'");
795: "gumps::Closable: Invalid bool value '"
796: local #0
797: +
798: "'"
799: +
800: 0L
801: makelocal
802: jmp userfunc @1331
803: return
return 1;
804: 1L
805: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 40
function GFCreateGump(x:=0, y:=0, width:=0, height:=0)
806: pop param 'height'
807: pop param 'width'
808: pop param 'y'
809: pop param 'x'
var gump := struct;
810: decl local #4
811: struct
812: :=
813: #
gump.+base := struct;
814: local #4
815: "base"
816: .+
817: struct
818: := #
gump.base.+x := CInt(x);
819: local #4
820: get member 'base'
821: "x"
822: .+
823: local #3
824: Func(0,0): CInt
825: := #
gump.base.+y := CInt(y);
826: local #4
827: get member 'base'
828: "y"
829: .+
830: local #2
831: Func(0,0): CInt
832: := #
gump.base.+width := CInt(width);
833: local #4
834: get member 'base'
835: "width"
836: .+
837: local #1
838: Func(0,0): CInt
839: := #
gump.base.+height := CInt(height);
840: local #4
841: get member 'base'
842: "height"
843: .+
844: local #0
845: Func(0,0): CInt
846: := #
gump.base.+MoveLoc := 0;	// Movable flag location
847: local #4
848: get member 'base'
849: "MoveLoc"
850: .+
851: 0L
852: := #
gump.base.+CloseLoc := 0;	// NoClose flag location
853: local #4
854: get member 'base'
855: "CloseLoc"
856: .+
857: 0L
858: := #
gump.base.+DisposeLoc := 0;	// NoDispose flag location
859: local #4
860: get member 'base'
861: "DisposeLoc"
862: .+
863: 0L
864: := #
gump.+layout	:= array;	// Main layout array for entire gump
865: local #4
866: "layout"
867: .+
868: array
869: := #
gump.+data	:= array;	// Storage array for static-text and
870: local #4
871: "data"
872: .+
873: array
874: := #
gump.+data_id	:= 1;
875: local #4
876: "data_id"
877: .+
878: 1L
879: := #
gump.+cur_page := 0;
880: local #4
881: "cur_page"
882: .+
883: 0L
884: := #
return(gump);
885: local #4
886: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 56
function GFExtractData(input, data_id)
887: pop param 'data_id'
888: pop param 'input'
var key_string := CStr(data_id)+": ";
889: decl local #2
890: local #0
891: Func(0,1): CStr
892: ": "
893: +
894: :=
895: #
var data_string := input[data_id];
896: decl local #3
897: local #1
898: local #0
899: [] 1
900: :=
901: #
var ret_val := data_string[Len(key_string)+1,Len(data_string)];
902: decl local #4
903: local #3
904: local #2
905: Func(0,2): Len
906: 1L
907: +
908: local #3
909: Func(0,2): Len
910: [,]
911: :=
912: #
return ret_val;
913: local #4
914: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 37
function GFGetCfgConst(elem_name, prop_name)
915: pop param 'prop_name'
916: pop param 'elem_name'
var cfg := ReadConfigFile(":gumps:GumpInfo");
917: decl local #2
918: ":gumps:GumpInfo"
919: Func(6,0): ReadConfigFile
920: :=
921: #
if ( cfg.errortext )
922: local #2
923: get member 'errortext'
924: if false goto 933
return XGFError("GFGetCfgConst():: Unable to open GumpInfo.cfg -> "+cfg.errorte
925: "GFGetCfgConst():: Unable to open GumpInfo.cfg -> "
926: local #2
927: get member 'errortext'
928: +
929: 0L
930: makelocal
931: jmp userfunc @1331
932: return
var elem := cfg[elem_name];
933: decl local #3
934: local #2
935: local #1
936: [] 1
937: :=
938: #
if ( elem.errortext )
939: local #3
940: get member 'errortext'
941: if false goto 954
return XGFError("GFGetCfgConst():: Unable to find GumpInfo.cfg["+elem_name+"] -
942: "GFGetCfgConst():: Unable to find GumpInfo.cfg["
943: local #1
944: +
945: "] ->"
946: +
947: local #3
948: get member 'errortext'
949: +
950: 0L
951: makelocal
952: jmp userfunc @1331
953: return
var value := GetConfigInt(elem, prop_name);
954: decl local #4
955: local #3
956: local #0
957: Func(6,1): GetConfigInt
958: :=
959: #
if ( !value )
960: local #4
961: if true goto 975
return XGFError("GFGetCfgConst():: Unable to find property ["+prop_name+"] in e
962: "GFGetCfgConst():: Unable to find property ["
963: local #0
964: +
965: "] in elem ["
966: +
967: local #1
968: +
969: "]"
970: +
971: 0L
972: makelocal
973: jmp userfunc @1331
974: return
return value;
975: local #4
976: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 151
function GFResizePic(byref gump, x, y, gump_id, width, height)
977: pop param 'height'
978: pop param 'width'
979: pop param 'gump_id'
980: pop param 'y'
981: pop param 'x'
982: pop param byref 'gump'
width := CInt(width);
983: local #1
984: Func(0,0): CInt
985: local1 := 
height := CInt(height);
986: local #0
987: Func(0,0): CInt
988: local0 := 
if ( !width )
989: local #1
990: if true goto 995
width := gump.base.width;
991: local #5
992: get member 'base'
993: get member 'width'
994: local1 := 
if ( !height )
995: local #0
996: if true goto 1001
height := gump.base.width;
997: local #5
998: get member 'base'
999: get member 'width'
1000: local0 := 
(gump.layout).Append("ResizePic "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1001: local #5
1002: get member 'layout'
1003: "ResizePic "
1004: local #4
1005: Func(0,0): CInt
1006: Func(0,1): CStr
1007: +
1008: " "
1009: +
1010: local #3
1011: Func(0,0): CInt
1012: Func(0,1): CStr
1013: +
1014: " "
1015: +
1016: local #2
1017: Func(0,0): CInt
1018: Func(0,1): CStr
1019: +
1020: " "
1021: +
1022: local #1
1023: Func(0,1): CStr
1024: +
1025: " "
1026: +
1027: local #0
1028: Func(0,1): CStr
1029: +
1030: Call Method id append (#52, 1 params)
1031: #
return 1;
1032: 1L
1033: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 314
function GFSendGump(mobile, byref gump)
1034: pop param byref 'gump'
1035: pop param 'mobile'
var ret_val := SendDialogGump(mobile, gump.layout, gump.data, gump.base.x, gump
1036: decl local #2
1037: local #1
1038: local #0
1039: get member 'layout'
1040: local #0
1041: get member 'data'
1042: local #0
1043: get member 'base'
1044: get member id 'x' (0)
1045: local #0
1046: get member 'base'
1047: get member id 'y' (1)
1048: 0L
1049: Func(2,2): SendDialogGump
1050: :=
1051: #
if ( ret_val.errortext )
1052: local #2
1053: get member 'errortext'
1054: if false goto 1070
SendSysMessage(mobile, "Error - Unable to display gump.");
1055: local #1
1056: "Error - Unable to display gump."
1057: 3L
1058: 1000L
1059: Func(2,3): SendSysMessage
1060: #
SendSysMessage(mobile, "Error text is ->"+ret_val.errortext);
1061: local #1
1062: "Error text is ->"
1063: local #2
1064: get member 'errortext'
1065: +
1066: 3L
1067: 1000L
1068: Func(2,3): SendSysMessage
1069: #
return ret_val;
1070: local #2
1071: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 296
function GFTextEntry(byref gump, x, y, width, height, txt_color, ini_text:="", 
1072: pop param 'txt_id'
1073: pop param 'ini_text'
1074: pop param 'txt_color'
1075: pop param 'height'
1076: pop param 'width'
1077: pop param 'y'
1078: pop param 'x'
1079: pop param byref 'gump'
gump.data.Append(""+CStr(ini_text));
1080: local #7
1081: get member 'data'
1082: ""
1083: local #1
1084: Func(0,1): CStr
1085: +
1086: Call Method id append (#52, 1 params)
1087: #
var index := gump.data.Size()-1;
1088: decl local #8
1089: local #7
1090: get member 'data'
1091: Call Method id size (#48, 0 params)
1092: 1L
1093: -
1094: :=
1095: #
txt_id := CInt(txt_id);
1096: local #0
1097: Func(0,0): CInt
1098: local0 := 
if ( txt_id < 1 ) // Catch errors (0) and invalid (negative) values
1099: local #0
1100: 1L
1101: <
1102: if false goto 1111
gump.data_id += 1;
1103: local #7
1104: get member 'data_id'
1105: 1L
1106: +=
1107: #
txt_id := gump.data_id;
1108: local #7
1109: get member 'data_id'
1110: local0 := 
(gump.layout).Append("TextEntry "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1111: local #7
1112: get member 'layout'
1113: "TextEntry "
1114: local #6
1115: Func(0,0): CInt
1116: Func(0,1): CStr
1117: +
1118: " "
1119: +
1120: local #5
1121: Func(0,0): CInt
1122: Func(0,1): CStr
1123: +
1124: " "
1125: +
1126: local #4
1127: Func(0,0): CInt
1128: Func(0,1): CStr
1129: +
1130: " "
1131: +
1132: local #3
1133: Func(0,0): CInt
1134: Func(0,1): CStr
1135: +
1136: " "
1137: +
1138: local #2
1139: Func(0,0): CInt
1140: Func(0,1): CStr
1141: +
1142: " "
1143: +
1144: local #0
1145: Func(0,1): CStr
1146: +
1147: " "
1148: +
1149: local #8
1150: Func(0,1): CStr
1151: +
1152: Call Method id append (#52, 1 params)
1153: #
return (txt_id);
1154: local #0
1155: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 263
function GFTextLine(byref gump, x, y, hue:=0, text:="")
1156: pop param 'text'
1157: pop param 'hue'
1158: pop param 'y'
1159: pop param 'x'
1160: pop param byref 'gump'
gump.data.Append(""+CStr(text));
1161: local #4
1162: get member 'data'
1163: ""
1164: local #0
1165: Func(0,1): CStr
1166: +
1167: Call Method id append (#52, 1 params)
1168: #
var index := gump.data.Size()-1;
1169: decl local #5
1170: local #4
1171: get member 'data'
1172: Call Method id size (#48, 0 params)
1173: 1L
1174: -
1175: :=
1176: #
(gump.layout).Append("Text "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1177: local #4
1178: get member 'layout'
1179: "Text "
1180: local #3
1181: Func(0,0): CInt
1182: Func(0,1): CStr
1183: +
1184: " "
1185: +
1186: local #2
1187: Func(0,0): CInt
1188: Func(0,1): CStr
1189: +
1190: " "
1191: +
1192: local #1
1193: Func(0,0): CInt
1194: Func(0,1): CStr
1195: +
1196: " "
1197: +
1198: local #5
1199: Func(0,1): CStr
1200: +
1201: Call Method id append (#52, 1 params)
1202: #
return (index);
1203: local #5
1204: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 165
function GFWordWrap(text, pixels)
1205: pop param 'pixels'
1206: pop param 'text'
var wrap_lines := array{};
1207: decl local #2
1208: array
1209: :=
1210: #
var word_list := SplitWords(text);
1211: decl local #3
1212: local #1
1213: " "
1214: Func(0,5): SplitWords
1215: :=
1216: #
var space_size := GFTextWidth(" ");
1217: decl local #4
1218: " "
1219: makelocal
1220: jmp userfunc @1533
1221: :=
1222: #
var cur_line := "";
1223: decl local #5
1224: ""
1225: :=
1226: #
var cur_length := 0;
1227: decl local #6
1228: 0L
1229: :=
1230: #
var start_new := 0;
1231: decl local #7
1232: 0L
1233: :=
1234: #
foreach word in ( word_list )
1235: local #3
1236: initforeach @1304
var word_width := GFTextWidth(word);
1237: decl local #0
1238: local #8
1239: makelocal
1240: jmp userfunc @1533
1241: :=
1242: #
if ( word == "[P]" )
1243: local #8
1244: "[P]"
1245: ==
1246: if false goto 1254
word := "";
1247: ""
1248: local8 := 
word_width := 0;
1249: 0L
1250: local11 := 
start_new := 1;
1251: 1L
1252: local7 := 
1253: goto1274
elseif ( (word_width+cur_length) > pixels )
1254: local #11
1255: local #6
1256: +
1257: local #0
1258: >
1259: if false goto 1274
start_new := 1;
1260: 1L
1261: local7 := 
if ( cur_line[Len(cur_line)] == " " )
1262: local #5
1263: local #5
1264: Func(0,2): Len
1265: [] 1
1266: " "
1267: ==
1268: if false goto 1274
cur_line[Len(cur_line)] := "";
1269: local #5
1270: local #5
1271: Func(0,2): Len
1272: ""
1273: [] := (1) #
if ( start_new )
1274: local #7
1275: if false goto 1286
start_new := 0;
1276: 0L
1277: local7 := 
wrap_lines.Append(cur_line);
1278: local #2
1279: local #5
1280: Call Method id append (#52, 1 params)
1281: #
cur_line := "";
1282: ""
1283: local5 := 
cur_length := 0;
1284: 0L
1285: local6 := 
if ( word )
1286: local #8
1287: if false goto 1300
cur_line += word+" ";
1288: local #5
1289: local #8
1290: " "
1291: +
1292: +=
1293: #
cur_length += word_width+space_size;
1294: local #6
1295: local #11
1296: local #4
1297: +
1298: +=
1299: #
SleepMS(2);
1300: 2L
1301: Func(3,3): Sleepms
1302: #
1303: leave block(1)
1304: stepforeach @1237
1305: leave block(3)
if ( wrap_lines[wrap_lines.Size()] != cur_line )
1306: local #2
1307: local #2
1308: Call Method id size (#48, 0 params)
1309: [] 1
1310: local #5
1311: <>
1312: if false goto 1329
if ( cur_line[Len(cur_line)] == " " )
1313: local #5
1314: local #5
1315: Func(0,2): Len
1316: [] 1
1317: " "
1318: ==
1319: if false goto 1325
cur_line[Len(cur_line)] := "";
1320: local #5
1321: local #5
1322: Func(0,2): Len
1323: ""
1324: [] := (1) #
wrap_lines.Append(cur_line);
1325: local #2
1326: local #5
1327: Call Method id append (#52, 1 params)
1328: #
return wrap_lines;
1329: local #2
1330: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 335
function XGFError(text, log:=0)
1331: pop param 'log'
1332: pop param 'text'
if ( log )
1333: local #0
1334: if false goto 1340
SysLog("Gump Error:: "+text);
1335: "Gump Error:: "
1336: local #1
1337: +
1338: Func(3,4): SysLog
1339: #
return error{"errortext":=text};
1340: error
1341: local #1
1342: addmember-assign(errortext)
1343: return
c:/ZH099/scripts/include/string.inc, Line 147
function Check_ValidChar( text, allow_space:=0 )
1344: pop param 'allow_space'
1345: pop param 'text'
var valid_char := array{ "a", "b", "c", "d", "e", "f", "g",
1346: decl local #2
1347: array
1348: "a"
1349: init{}
1350: "b"
1351: init{}
1352: "c"
1353: init{}
1354: "d"
1355: init{}
1356: "e"
1357: init{}
1358: "f"
1359: init{}
1360: "g"
1361: init{}
1362: "h"
1363: init{}
1364: "i"
1365: init{}
1366: "j"
1367: init{}
1368: "k"
1369: init{}
1370: "l"
1371: init{}
1372: "m"
1373: init{}
1374: "n"
1375: init{}
1376: "o"
1377: init{}
1378: "p"
1379: init{}
1380: "q"
1381: init{}
1382: "r"
1383: init{}
1384: "s"
1385: init{}
1386: "t"
1387: init{}
1388: "u"
1389: init{}
1390: "v"
1391: init{}
1392: "w"
1393: init{}
1394: "x"
1395: init{}
1396: "y"
1397: init{}
1398: "z"
1399: init{}
1400: "A"
1401: init{}
1402: "B"
1403: init{}
1404: "C"
1405: init{}
1406: "D"
1407: init{}
1408: "E"
1409: init{}
1410: "F"
1411: init{}
1412: "G"
1413: init{}
1414: "H"
1415: init{}
1416: "I"
1417: init{}
1418: "P"
1419: init{}
1420: "O"
1421: init{}
1422: "N"
1423: init{}
1424: "M"
1425: init{}
1426: "L"
1427: init{}
1428: "K"
1429: init{}
1430: "J"
1431: init{}
1432: "Q"
1433: init{}
1434: "R"
1435: init{}
1436: "S"
1437: init{}
1438: "T"
1439: init{}
1440: "U"
1441: init{}
1442: "V"
1443: init{}
1444: "W"
1445: init{}
1446: "X"
1447: init{}
1448: "Y"
1449: init{}
1450: "Z"
1451: init{}
1452: "1"
1453: init{}
1454: "2"
1455: init{}
1456: "3"
1457: init{}
1458: "4"
1459: init{}
1460: "5"
1461: init{}
1462: "6"
1463: init{}
1464: "7"
1465: init{}
1466: "8"
1467: init{}
1468: "9"
1469: init{}
1470: "0"
1471: init{}
1472: :=
1473: #
var len_text := Len( text );
1474: decl local #3
1475: local #1
1476: Func(0,2): Len
1477: :=
1478: #
var i;
1479: decl local #4
1480: #
for( i:=1; i<=len_text; i+=1 )
1481: local #4
1482: 1L
1483: :=
1484: #
1485: local #4
1486: local #3
1487: <=
1488: if false goto 1531
SleepMS(5);
1489: 5L
1490: Func(3,3): Sleepms
1491: #
var letter := CStr( text[i] );
1492: decl local #0
1493: local #1
1494: local #4
1495: [] 1
1496: Func(0,1): CStr
1497: :=
1498: #
if( letter in valid_char )
1499: local #5
1500: local #2
1501: in
1502: if false goto 1506
continue;
1503: leave block(1)
1504: goto1526
1505: goto1523
elseif( allow_space && ( text[i] == " " || CAsc( text[i] ) == 0 ))
1506: local #0
1507: local #1
1508: local #4
1509: [] 1
1510: " "
1511: ==
1512: local #1
1513: local #4
1514: [] 1
1515: Func(0,7): CAsc
1516: 0L
1517: ==
1518: ||
1519: &&
1520: if false goto 1523
continue;
1521: leave block(1)
1522: goto1526
return 0;
1523: 0L
1524: return
1525: leave block(1)
1526: local #4
1527: 1L
1528: +=
1529: #
1530: goto1485
return 1;
1531: 1L
1532: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 124
function GFTextWidth(gump_text)
1533: pop param 'gump_text'
var gft_length := struct;
1534: decl local #1
1535: struct
1536: :=
1537: #
gft_length.+charsf :=
1538: local #1
1539: "charsf"
1540: .+
1541: "||||||||||||||`',.;:::::::::!!!!!!!!!!!!!!il1[]]]]]]]]]"bcejot”(){}===adfpqrszI„~~~~ghnuvy<>-----xJ578$?++++++ kCE2369^/*****mwABDFOPŽ™40%%GLNQSZ@#######HRT&__________KšUYYYYYYYYYYYXXXXXXXXXXXXXXVVVVVVVVVVVVVVMMMMMMMMMMMMMMWWWWWWWWWWWWWW"
1542: := #
gft_length.+width := array
1543: local #1
1544: "width"
1545: .+
1546: array
1547: 2L
1548: init{}
1549: 3L
1550: init{}
1551: 4L
1552: init{}
1553: 5L
1554: init{}
1555: 6L
1556: init{}
1557: 7L
1558: init{}
1559: 8L
1560: init{}
1561: 9L
1562: init{}
1563: 10L
1564: init{}
1565: 11L
1566: init{}
1567: 12L
1568: init{}
1569: 13L
1570: init{}
1571: 14L
1572: init{}
1573: 15L
1574: init{}
1575: 16L
1576: init{}
1577: 18L
1578: init{}
1579: 21L
1580: init{}
1581: := #
var points:=0;
1582: decl local #2
1583: 0L
1584: :=
1585: #
var j := Len(gump_text);
1586: decl local #3
1587: local #0
1588: Func(0,2): Len
1589: :=
1590: #
for ( j; j>0; j-=1 )
1591: local #3
1592: #
1593: local #3
1594: 0L
1595: >
1596: if false goto 1641
var i := Find(gft_length.charsf, gump_text[j], 1) - 1;
1597: decl local #0
1598: local #1
1599: get member 'charsf'
1600: local #0
1601: local #3
1602: [] 1
1603: 1L
1604: Func(0,4): Find
1605: 1L
1606: -
1607: :=
1608: #
if ( i>=0 )
1609: local #4
1610: 0L
1611: >=
1612: if false goto 1626
points += gft_length.width[CInt(i/14)+1];
1613: local #2
1614: local #1
1615: get member 'width'
1616: local #4
1617: 14L
1618: /
1619: Func(0,0): CInt
1620: 1L
1621: +
1622: [] 1
1623: +=
1624: #
1625: goto1635
print("XGFTextWidth: Unknown Character = '"+gump_text[j]+"'");
1626: "XGFTextWidth: Unknown Character = '"
1627: local #0
1628: local #3
1629: [] 1
1630: +
1631: "'"
1632: +
1633: Func(1,0): Print
1634: #
1635: leave block(1)
1636: local #3
1637: 1L
1638: -=
1639: #
1640: goto1593
return (points);
1641: local #2
1642: return
