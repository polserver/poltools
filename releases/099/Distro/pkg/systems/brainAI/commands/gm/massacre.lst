C:\ZH099\pkg\systems\brainAI\commands\gm\massacre.src, Line 13
program Massacre( who, range )
CONST REPORT_ALL	:= 0x7;
0: get arg 'who'
1: get arg 'range'
if( !AuthorizationCode( who ))
2: local #0
3: makelocal
4: jmp userfunc @64
5: if true goto 14
SendSysMessage( who, "Cancelled." );
6: local #0
7: "Cancelled."
8: 3L
9: 1000L
10: Func(2,1): SendSysMessage
11: #
return 0;
12: 0L
13: progend
range := CInt( range );
14: local #1
15: Func(0,0): CInt
16: local1 := 
if( !range )
17: local #1
18: if true goto 28
range := CInt( RequestGump( who, "Enter the radius to kill npcs.", "", 0 ));
19: local #0
20: "Enter the radius to kill npcs."
21: ""
22: 0L
23: 0L
24: makelocal
25: jmp userfunc @287
26: Func(0,0): CInt
27: local1 := 
var mobile_list := ListMobilesNearLocationEX( who.x, who.y, who.z, range, LISTE
28: decl local #2
29: local #0
30: get member id 'x' (0)
31: local #0
32: get member id 'y' (1)
33: local #0
34: get member id 'z' (2)
35: local #1
36: 3L
37: local #0
38: get member id 'realm' (112)
39: Func(2,9): ListMobilesNearLocationEx
40: :=
41: #
foreach mobile in ( mobile_list )
42: local #2
43: initforeach @58
if( mobile.npctemplate )
44: local #3
45: get member id 'npctemplate' (62)
46: if false goto 55
SetObjProperty( mobile, "GuardKill", 1 );
47: local #3
48: "GuardKill"
49: 1L
50: Func(2,7): SetObjProperty
51: #
mobile.Kill();
52: local #3
53: Call Method id kill (#75, 0 params)
54: #
SleepMS(2);
55: 2L
56: Func(3,0): Sleepms
57: #
58: stepforeach @44
59: leave block(3)
return 1;
60: 1L
61: progend
62: leave block(3)
63: progend
c:/ZH099/scripts/include/security.inc, Line 14
function AuthorizationCode( mobile )
64: pop param 'mobile'
if( GetObjProperty( mobile, "#AuthCodeGiven" ));
65: local #0
66: "#AuthCodeGiven"
67: Func(2,4): GetObjProperty
68: if false goto 71
return 1;
69: 1L
70: return
var autocode := GetGlobalProperty( "CA" );
71: decl local #1
72: "CA"
73: Func(2,5): GetGlobalProperty
74: :=
75: #
if( !autocode )
76: local #1
77: if true goto 93
SendSysMessage( mobile, "Authorization code is not given yet.", 3, 53 );
78: local #0
79: "Authorization code is not given yet."
80: 3L
81: 53L
82: Func(2,1): SendSysMessage
83: #
SendSysMessage( mobile, "Uses .setauthcode to create a new code.", 3, 53 );
84: local #0
85: "Uses .setauthcode to create a new code."
86: 3L
87: 53L
88: Func(2,1): SendSysMessage
89: #
return 0;
90: 0L
91: return
92: goto135
var code := SendTextEntryGump( mobile, "Enter the Authorization Code.", TE_CANC
93: decl local #0
94: local #0
95: "Enter the Authorization Code."
96: 1L
97: 1L
98: 10L
99: ""
100: Func(2,6): SendTextEntryGump
101: :=
102: #
if( code == autocode )
103: local #2
104: local #1
105: ==
106: if false goto 121
SendSysMessage( mobile, "Code Accepted!", 3, 70 );
107: local #0
108: "Code Accepted!"
109: 3L
110: 70L
111: Func(2,1): SendSysMessage
112: #
SetObjProperty( mobile, "#AuthCodeGiven", 1 );
113: local #0
114: "#AuthCodeGiven"
115: 1L
116: Func(2,7): SetObjProperty
117: #
return 1;
118: 1L
119: return
120: goto134
SendSysMessage( mobile, "It is not the Authorization code.", 3, 33 );
121: local #0
122: "It is not the Authorization code."
123: 3L
124: 33L
125: Func(2,1): SendSysMessage
126: #
NotifyStaffOnline( mobile, "has provided a wrong authorization code." );
127: local #0
128: "has provided a wrong authorization code."
129: makelocal
130: jmp userfunc @137
131: #
return 0;
132: 0L
133: return
134: leave block(1)
135: 0L
136: return
c:/ZH099/scripts/include/security.inc, Line 40
function NotifyStaffOnline( object, text )
137: pop param 'text'
138: pop param 'object'
var name := object.name;
139: decl local #2
140: local #1
141: get member id 'name' (3)
142: :=
143: #
if( !name )
144: local #2
145: if true goto 153
name := object.desc;
146: local #1
147: get member id 'desc' (19)
148: local2 := 
if( !name )
149: local #2
150: if true goto 153
name := object;
151: local #1
152: local2 := 
foreach character in EnumerateOnlineCharacters()
153: Func(2,8): EnumerateOnlineCharacters
154: initforeach @189
if( GetObjProperty( character, "Notify" ))
155: local #3
156: "Notify"
157: Func(2,4): GetObjProperty
158: if false goto 186
if( object.cmdlevel <= character.cmdlevel || character.cmdlevel >= 4 )
159: local #1
160: get member id 'cmdlevel' (46)
161: local #3
162: get member id 'cmdlevel' (46)
163: <=
164: local #3
165: get member id 'cmdlevel' (46)
166: 4L
167: >=
168: ||
169: if false goto 186
SendSysMessage( character, "You receive a notification:", 3, 55 );
170: local #3
171: "You receive a notification:"
172: 3L
173: 55L
174: Func(2,1): SendSysMessage
175: #
SendSysMessage( character, name+" >>> "+text, 3, 55 );
176: local #3
177: local #2
178: " >>> "
179: +
180: local #0
181: +
182: 3L
183: 55L
184: Func(2,1): SendSysMessage
185: #
SleepMS(5);
186: 5L
187: Func(3,0): Sleepms
188: #
189: stepforeach @155
190: leave block(3)
if( object.serial )
191: local #1
192: get member id 'serial' (6)
193: if false goto 210
ReportText( name+"["+object.serial+"] >>> "+text, REPORT_SYSLOG );
194: local #2
195: "["
196: +
197: local #1
198: get member id 'serial' (6)
199: +
200: "] >>> "
201: +
202: local #0
203: +
204: 2L
205: 0L
206: makelocal
207: jmp userfunc @222
208: #
209: goto220
ReportText( name+" >>> "+text, REPORT_SYSLOG );
210: local #2
211: " >>> "
212: +
213: local #0
214: +
215: 2L
216: 0L
217: makelocal
218: jmp userfunc @222
219: #
return 1;
220: 1L
221: return
c:/ZH099/pkg/utils/security/include/report.inc, Line 22
function ReportText( report_text:="?", flags:=REPORT_DISABLE, text_color:=0 )
222: pop param 'text_color'
223: pop param 'flags'
224: pop param 'report_text'
if( !flags )
225: local #1
226: if true goto 230
return 0;
227: 0L
228: return
229: goto285
elseif( flags & REPORT_CONSOLE )
230: local #1
231: 1L
232: &
233: if false goto 240
Print( ""+report_text );
234: ""
235: local #2
236: +
237: Func(1,0): Print
238: #
239: goto285
elseif( flags & REPORT_SYSLOG )
240: local #1
241: 2L
242: &
243: if false goto 274
var script_name := CStr( GetProcess( GetPid() ).name ),
244: decl local #0
245: Func(3,4): GetPid
246: Func(3,3): GetProcess
247: get member id 'name' (3)
248: Func(0,1): CStr
249: :=
250: #
251: decl local #1
252: local #3
253: makelocal
254: jmp userfunc @490
255: :=
256: #
LogToFile( "::log/"+pkg_name+".log", "["+script_name+"]: "+report_text, LOG_DAT
257: "::log/"
258: local #4
259: +
260: ".log"
261: +
262: "["
263: local #3
264: +
265: "]: "
266: +
267: local #2
268: +
269: 1L
270: Func(7,0): LogToFile
271: #
272: leave block(2)
273: goto285
elseif( flags & REPORT_BROADCAST )
274: local #1
275: 4L
276: &
277: if false goto 285
Broadcast( ""+report_text, 3, text_color );
278: ""
279: local #2
280: +
281: 3L
282: local #0
283: Func(2,3): Broadcast
284: #
return 1;
285: 1L
286: return
c:/ZH099/pkg/utils/gumps/include/requestgump.inc, Line 39
function RequestGump(mobile, question, option := "", pre_val := "", cancel_btn:
287: pop param 'cancel_btn'
288: pop param 'pre_val'
289: pop param 'option'
290: pop param 'question'
291: pop param 'mobile'
if ( !pre_val || pre_val == error )
292: local #1
293: !
294: local #1
295: error
296: ==
297: ||
298: if false goto 301
pre_val := "";
299: ""
300: local1 := 
var r_gump := GFCreateGump(140, 100);
301: decl local #5
302: 140L
303: 100L
304: 0L
305: 0L
306: makelocal
307: jmp userfunc @712
308: :=
309: #
GFClosable(r_gump, 0);
310: local #5
311: 0L
312: makelocal
313: jmp userfunc @653
314: #
GFResizePic(r_gump, 0, 0, GFGetCfgConst("Defaults", "BackGround"), 400, 205);
315: local #5
316: 0L
317: 0L
318: "Defaults"
319: "BackGround"
320: makelocal
321: jmp userfunc @821
322: 400L
323: 205L
324: makelocal
325: jmp userfunc @883
326: #
GFResizePic(r_gump, 15, 15, GFGetCfgConst("Defaults", "ForeGround"), 370, 175);
327: local #5
328: 15L
329: 15L
330: "Defaults"
331: "ForeGround"
332: makelocal
333: jmp userfunc @821
334: 370L
335: 175L
336: makelocal
337: jmp userfunc @883
338: #
GFAddAlphaRegion( r_gump, 0, 0, 400, 205 );
339: local #5
340: 0L
341: 0L
342: 400L
343: 205L
344: makelocal
345: jmp userfunc @537
346: #
var y_pos := 20;
347: decl local #6
348: 20L
349: :=
350: #
foreach line in (GFWordWrap(question, 370))
351: local #3
352: 370L
353: makelocal
354: jmp userfunc @1111
355: initforeach @371
GFTextLine(r_gump, 20, y_pos, 1153, line);
356: local #5
357: 20L
358: local #6
359: 1153L
360: local #7
361: makelocal
362: jmp userfunc @1062
363: #
y_pos += 20;
364: local #6
365: 20L
366: +=
367: #
SleepMS(2);
368: 2L
369: Func(3,0): Sleepms
370: #
371: stepforeach @356
372: leave block(3)
y_pos := 75;
373: 75L
374: local6 := 
foreach line in (GFWordWrap(option, 370))
375: local #2
376: 370L
377: makelocal
378: jmp userfunc @1111
379: initforeach @395
GFTextLine(r_gump, 20, y_pos, 1153, line);
380: local #5
381: 20L
382: local #6
383: 1153L
384: local #7
385: makelocal
386: jmp userfunc @1062
387: #
y_pos += 20;
388: local #6
389: 20L
390: +=
391: #
SleepMS(2);
392: 2L
393: Func(3,0): Sleepms
394: #
395: stepforeach @380
396: leave block(3)
GFResizePic(r_gump, 20, 100, GFGetCfgConst("BackGrounds", "GOLDTRIM"), 360, 30)
397: local #5
398: 20L
399: 100L
400: "BackGrounds"
401: "GOLDTRIM"
402: makelocal
403: jmp userfunc @821
404: 360L
405: 30L
406: makelocal
407: jmp userfunc @883
408: #
var r_txt := GFTextEntry(r_gump, 30, 105, 335, 25, 1153, pre_val);
409: decl local #7
410: local #5
411: 30L
412: 105L
413: 335L
414: 25L
415: 1153L
416: local #1
417: 0L
418: makelocal
419: jmp userfunc @978
420: :=
421: #
if ( cancel_btn )
422: local #0
423: if false goto 445
GFAddButton(r_gump, 90, 160, 2128, 2129, GF_CLOSE_BTN, 100);
424: local #5
425: 90L
426: 160L
427: 2128L
428: 2129L
429: 1L
430: 100L
431: makelocal
432: jmp userfunc @571
433: #
GFAddButton(r_gump, 240, 160, 2119, 2120, GF_CLOSE_BTN, 200);
434: local #5
435: 240L
436: 160L
437: 2119L
438: 2120L
439: 1L
440: 200L
441: makelocal
442: jmp userfunc @571
443: #
444: goto455
GFAddButton(r_gump, 180, 160, 2128, 2129, GF_CLOSE_BTN, 100);
445: local #5
446: 180L
447: 160L
448: 2128L
449: 2129L
450: 1L
451: 100L
452: makelocal
453: jmp userfunc @571
454: #
var input := GFSendGump(mobile, r_gump);
455: decl local #8
456: local #4
457: local #5
458: makelocal
459: jmp userfunc @940
460: :=
461: #
var text_area := GFExtractData(input, r_txt);
462: decl local #9
463: local #8
464: local #7
465: makelocal
466: jmp userfunc @793
467: :=
468: #
if ( input[200] )
469: local #8
470: 200L
471: [] 1
472: if false goto 476
return error;
473: error
474: return
475: goto488
elseif ( !text_area || text_area == error )
476: local #9
477: !
478: local #9
479: error
480: ==
481: ||
482: if false goto 486
return 0;
483: 0L
484: return
485: goto488
return text_area;
486: local #9
487: return
488: 0L
489: return
c:/ZH099/pkg/utils/security/include/report.inc, Line 40
function GetPkgName( script_name )
490: pop param 'script_name'
var i;
491: decl local #1
492: #
for( i:=1; i<=len(script_name); i+=1 )
493: local #1
494: 1L
495: :=
496: #
497: local #1
498: local #0
499: Func(0,2): Len
500: <=
501: if false goto 521
if( !Check_ValidChar( script_name[i] ))
502: local #0
503: local #1
504: [] 1
505: 0L
506: makelocal
507: jmp userfunc @1250
508: if true goto 513
script_name[i] := " ";
509: local #0
510: local #1
511: " "
512: [] := (1) #
SleepMS(5);
513: 5L
514: Func(3,0): Sleepms
515: #
516: local #1
517: 1L
518: +=
519: #
520: goto497
foreach poss_pkg in ( SplitWords( script_name ))
521: local #0
522: " "
523: Func(0,5): SplitWords
524: initforeach @533
if( GetPackageByName( poss_pkg ))
525: local #2
526: Func(5,0): GetPackageByName
527: if false goto 530
return poss_pkg;
528: local #2
529: return
SleepMS(5);
530: 5L
531: Func(3,0): Sleepms
532: #
533: stepforeach @525
534: leave block(3)
return 0;
535: 0L
536: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 166
function GFAddAlphaRegion(byref gump, x, y, width, height)
537: pop param 'height'
538: pop param 'width'
539: pop param 'y'
540: pop param 'x'
541: pop param byref 'gump'
(gump.layout).Append("CheckerTrans "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
542: local #4
543: get member 'layout'
544: "CheckerTrans "
545: local #3
546: Func(0,0): CInt
547: Func(0,1): CStr
548: +
549: " "
550: +
551: local #2
552: Func(0,0): CInt
553: Func(0,1): CStr
554: +
555: " "
556: +
557: local #1
558: Func(0,0): CInt
559: Func(0,1): CStr
560: +
561: " "
562: +
563: local #0
564: Func(0,0): CInt
565: Func(0,1): CStr
566: +
567: Call Method id append (#52, 1 params)
568: #
return 1;
569: 1L
570: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 172
function GFAddButton(byref gump, x, y, off_id, on_id, btn_type:=GF_PAGE_BTN, bt
571: pop param 'btn_value'
572: pop param 'btn_type'
573: pop param 'on_id'
574: pop param 'off_id'
575: pop param 'y'
576: pop param 'x'
577: pop param byref 'gump'
var line := "Button "+CStr(x)+" "+CStr(y)+" "+CStr(off_id)+" "+CStr(on_id);
578: decl local #7
579: "Button "
580: local #5
581: Func(0,1): CStr
582: +
583: " "
584: +
585: local #4
586: Func(0,1): CStr
587: +
588: " "
589: +
590: local #3
591: Func(0,1): CStr
592: +
593: " "
594: +
595: local #2
596: Func(0,1): CStr
597: +
598: :=
599: #
btn_value := CInt(btn_value);
600: local #0
601: Func(0,0): CInt
602: local0 := 
if ( btn_value < 1 ) // Catch errors (0) and invalid (negative) values
603: local #0
604: 1L
605: <
606: if false goto 615
gump.data_id += 1;
607: local #6
608: get member 'data_id'
609: 1L
610: +=
611: #
btn_value := gump.data_id;
612: local #6
613: get member 'data_id'
614: local0 := 
if ( btn_type == GF_CLOSE_BTN )
615: local #1
616: 1L
617: ==
618: if false goto 627
line += " 1 0 "+CStr(btn_value);
619: local #7
620: " 1 0 "
621: local #0
622: Func(0,1): CStr
623: +
624: +=
625: #
626: goto646
elseif ( btn_type == GF_DUMMY_BTN )
627: local #1
628: 2L
629: ==
630: if false goto 639
line += " 0 0 "+CStr(btn_value);
631: local #7
632: " 0 0 "
633: local #0
634: Func(0,1): CStr
635: +
636: +=
637: #
638: goto646
line += " 0 "+CStr(btn_value);
639: local #7
640: " 0 "
641: local #0
642: Func(0,1): CStr
643: +
644: +=
645: #
(gump.layout).Append(line);
646: local #6
647: get member 'layout'
648: local #7
649: Call Method id append (#52, 1 params)
650: #
return (btn_value);
651: local #0
652: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 71
function GFClosable(byref gump, bool)
653: pop param 'bool'
654: pop param byref 'gump'
case ( bool )
655: local #0
656: casejmp
	0: @657
	1: @679
	default: @701
if ( gump.base.CloseLoc )
657: local #1
658: get member 'base'
659: get member 'CloseLoc'
660: if false goto 666
return XGFError("Gump already contains the 'NoClose' flag.");
661: "Gump already contains the 'NoClose' flag."
662: 0L
663: makelocal
664: jmp userfunc @1237
665: return
(gump.layout).Append("NoClose");
666: local #1
667: get member 'layout'
668: "NoClose"
669: Call Method id append (#52, 1 params)
670: #
gump.base.CloseLoc := (gump.layout).Size();
671: local #1
672: get member 'base'
673: local #1
674: get member 'layout'
675: Call Method id size (#48, 0 params)
676: set member 'CloseLoc' #
break;
677: goto678
678: goto710
if ( !gump.base.CloseLoc )
679: local #1
680: get member 'base'
681: get member 'CloseLoc'
682: if true goto 688
return XGFError("Gump is already closable.");
683: "Gump is already closable."
684: 0L
685: makelocal
686: jmp userfunc @1237
687: return
(gump.layout).Erase(gump.base.CloseLoc);
688: local #1
689: get member 'layout'
690: local #1
691: get member 'base'
692: get member 'CloseLoc'
693: Call Method id erase (#49, 1 params)
694: #
gump.base.CloseLoc := 0;
695: local #1
696: get member 'base'
697: 0L
698: set member 'CloseLoc' #
break;
699: goto700
700: goto710
return XGFError("gumps::Closable: Invalid bool value '"+bool+"'");
701: "gumps::Closable: Invalid bool value '"
702: local #0
703: +
704: "'"
705: +
706: 0L
707: makelocal
708: jmp userfunc @1237
709: return
return 1;
710: 1L
711: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 40
function GFCreateGump(x:=0, y:=0, width:=0, height:=0)
712: pop param 'height'
713: pop param 'width'
714: pop param 'y'
715: pop param 'x'
var gump := struct;
716: decl local #4
717: struct
718: :=
719: #
gump.+base := struct;
720: local #4
721: "base"
722: .+
723: struct
724: := #
gump.base.+x := CInt(x);
725: local #4
726: get member 'base'
727: "x"
728: .+
729: local #3
730: Func(0,0): CInt
731: := #
gump.base.+y := CInt(y);
732: local #4
733: get member 'base'
734: "y"
735: .+
736: local #2
737: Func(0,0): CInt
738: := #
gump.base.+width := CInt(width);
739: local #4
740: get member 'base'
741: "width"
742: .+
743: local #1
744: Func(0,0): CInt
745: := #
gump.base.+height := CInt(height);
746: local #4
747: get member 'base'
748: "height"
749: .+
750: local #0
751: Func(0,0): CInt
752: := #
gump.base.+MoveLoc := 0;	// Movable flag location
753: local #4
754: get member 'base'
755: "MoveLoc"
756: .+
757: 0L
758: := #
gump.base.+CloseLoc := 0;	// NoClose flag location
759: local #4
760: get member 'base'
761: "CloseLoc"
762: .+
763: 0L
764: := #
gump.base.+DisposeLoc := 0;	// NoDispose flag location
765: local #4
766: get member 'base'
767: "DisposeLoc"
768: .+
769: 0L
770: := #
gump.+layout	:= array;	// Main layout array for entire gump
771: local #4
772: "layout"
773: .+
774: array
775: := #
gump.+data	:= array;	// Storage array for static-text and
776: local #4
777: "data"
778: .+
779: array
780: := #
gump.+data_id	:= 1;
781: local #4
782: "data_id"
783: .+
784: 1L
785: := #
gump.+cur_page := 0;
786: local #4
787: "cur_page"
788: .+
789: 0L
790: := #
return(gump);
791: local #4
792: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 56
function GFExtractData(input, data_id)
793: pop param 'data_id'
794: pop param 'input'
var key_string := CStr(data_id)+": ";
795: decl local #2
796: local #0
797: Func(0,1): CStr
798: ": "
799: +
800: :=
801: #
var data_string := input[data_id];
802: decl local #3
803: local #1
804: local #0
805: [] 1
806: :=
807: #
var ret_val := data_string[Len(key_string)+1,Len(data_string)];
808: decl local #4
809: local #3
810: local #2
811: Func(0,2): Len
812: 1L
813: +
814: local #3
815: Func(0,2): Len
816: [,]
817: :=
818: #
return ret_val;
819: local #4
820: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 37
function GFGetCfgConst(elem_name, prop_name)
821: pop param 'prop_name'
822: pop param 'elem_name'
var cfg := ReadConfigFile(":gumps:GumpInfo");
823: decl local #2
824: ":gumps:GumpInfo"
825: Func(6,0): ReadConfigFile
826: :=
827: #
if ( cfg.errortext )
828: local #2
829: get member 'errortext'
830: if false goto 839
return XGFError("GFGetCfgConst():: Unable to open GumpInfo.cfg -> "+cfg.errorte
831: "GFGetCfgConst():: Unable to open GumpInfo.cfg -> "
832: local #2
833: get member 'errortext'
834: +
835: 0L
836: makelocal
837: jmp userfunc @1237
838: return
var elem := cfg[elem_name];
839: decl local #3
840: local #2
841: local #1
842: [] 1
843: :=
844: #
if ( elem.errortext )
845: local #3
846: get member 'errortext'
847: if false goto 860
return XGFError("GFGetCfgConst():: Unable to find GumpInfo.cfg["+elem_name+"] -
848: "GFGetCfgConst():: Unable to find GumpInfo.cfg["
849: local #1
850: +
851: "] ->"
852: +
853: local #3
854: get member 'errortext'
855: +
856: 0L
857: makelocal
858: jmp userfunc @1237
859: return
var value := GetConfigInt(elem, prop_name);
860: decl local #4
861: local #3
862: local #0
863: Func(6,1): GetConfigInt
864: :=
865: #
if ( !value )
866: local #4
867: if true goto 881
return XGFError("GFGetCfgConst():: Unable to find property ["+prop_name+"] in e
868: "GFGetCfgConst():: Unable to find property ["
869: local #0
870: +
871: "] in elem ["
872: +
873: local #1
874: +
875: "]"
876: +
877: 0L
878: makelocal
879: jmp userfunc @1237
880: return
return value;
881: local #4
882: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 151
function GFResizePic(byref gump, x, y, gump_id, width, height)
883: pop param 'height'
884: pop param 'width'
885: pop param 'gump_id'
886: pop param 'y'
887: pop param 'x'
888: pop param byref 'gump'
width := CInt(width);
889: local #1
890: Func(0,0): CInt
891: local1 := 
height := CInt(height);
892: local #0
893: Func(0,0): CInt
894: local0 := 
if ( !width )
895: local #1
896: if true goto 901
width := gump.base.width;
897: local #5
898: get member 'base'
899: get member 'width'
900: local1 := 
if ( !height )
901: local #0
902: if true goto 907
height := gump.base.width;
903: local #5
904: get member 'base'
905: get member 'width'
906: local0 := 
(gump.layout).Append("ResizePic "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
907: local #5
908: get member 'layout'
909: "ResizePic "
910: local #4
911: Func(0,0): CInt
912: Func(0,1): CStr
913: +
914: " "
915: +
916: local #3
917: Func(0,0): CInt
918: Func(0,1): CStr
919: +
920: " "
921: +
922: local #2
923: Func(0,0): CInt
924: Func(0,1): CStr
925: +
926: " "
927: +
928: local #1
929: Func(0,1): CStr
930: +
931: " "
932: +
933: local #0
934: Func(0,1): CStr
935: +
936: Call Method id append (#52, 1 params)
937: #
return 1;
938: 1L
939: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 314
function GFSendGump(mobile, byref gump)
940: pop param byref 'gump'
941: pop param 'mobile'
var ret_val := SendDialogGump(mobile, gump.layout, gump.data, gump.base.x, gump
942: decl local #2
943: local #1
944: local #0
945: get member 'layout'
946: local #0
947: get member 'data'
948: local #0
949: get member 'base'
950: get member id 'x' (0)
951: local #0
952: get member 'base'
953: get member id 'y' (1)
954: 0L
955: Func(2,0): SendDialogGump
956: :=
957: #
if ( ret_val.errortext )
958: local #2
959: get member 'errortext'
960: if false goto 976
SendSysMessage(mobile, "Error - Unable to display gump.");
961: local #1
962: "Error - Unable to display gump."
963: 3L
964: 1000L
965: Func(2,1): SendSysMessage
966: #
SendSysMessage(mobile, "Error text is ->"+ret_val.errortext);
967: local #1
968: "Error text is ->"
969: local #2
970: get member 'errortext'
971: +
972: 3L
973: 1000L
974: Func(2,1): SendSysMessage
975: #
return ret_val;
976: local #2
977: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 296
function GFTextEntry(byref gump, x, y, width, height, txt_color, ini_text:="", 
978: pop param 'txt_id'
979: pop param 'ini_text'
980: pop param 'txt_color'
981: pop param 'height'
982: pop param 'width'
983: pop param 'y'
984: pop param 'x'
985: pop param byref 'gump'
gump.data.Append(""+CStr(ini_text));
986: local #7
987: get member 'data'
988: ""
989: local #1
990: Func(0,1): CStr
991: +
992: Call Method id append (#52, 1 params)
993: #
var index := gump.data.Size()-1;
994: decl local #8
995: local #7
996: get member 'data'
997: Call Method id size (#48, 0 params)
998: 1L
999: -
1000: :=
1001: #
txt_id := CInt(txt_id);
1002: local #0
1003: Func(0,0): CInt
1004: local0 := 
if ( txt_id < 1 ) // Catch errors (0) and invalid (negative) values
1005: local #0
1006: 1L
1007: <
1008: if false goto 1017
gump.data_id += 1;
1009: local #7
1010: get member 'data_id'
1011: 1L
1012: +=
1013: #
txt_id := gump.data_id;
1014: local #7
1015: get member 'data_id'
1016: local0 := 
(gump.layout).Append("TextEntry "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1017: local #7
1018: get member 'layout'
1019: "TextEntry "
1020: local #6
1021: Func(0,0): CInt
1022: Func(0,1): CStr
1023: +
1024: " "
1025: +
1026: local #5
1027: Func(0,0): CInt
1028: Func(0,1): CStr
1029: +
1030: " "
1031: +
1032: local #4
1033: Func(0,0): CInt
1034: Func(0,1): CStr
1035: +
1036: " "
1037: +
1038: local #3
1039: Func(0,0): CInt
1040: Func(0,1): CStr
1041: +
1042: " "
1043: +
1044: local #2
1045: Func(0,0): CInt
1046: Func(0,1): CStr
1047: +
1048: " "
1049: +
1050: local #0
1051: Func(0,1): CStr
1052: +
1053: " "
1054: +
1055: local #8
1056: Func(0,1): CStr
1057: +
1058: Call Method id append (#52, 1 params)
1059: #
return (txt_id);
1060: local #0
1061: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 263
function GFTextLine(byref gump, x, y, hue:=0, text:="")
1062: pop param 'text'
1063: pop param 'hue'
1064: pop param 'y'
1065: pop param 'x'
1066: pop param byref 'gump'
gump.data.Append(""+CStr(text));
1067: local #4
1068: get member 'data'
1069: ""
1070: local #0
1071: Func(0,1): CStr
1072: +
1073: Call Method id append (#52, 1 params)
1074: #
var index := gump.data.Size()-1;
1075: decl local #5
1076: local #4
1077: get member 'data'
1078: Call Method id size (#48, 0 params)
1079: 1L
1080: -
1081: :=
1082: #
(gump.layout).Append("Text "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1083: local #4
1084: get member 'layout'
1085: "Text "
1086: local #3
1087: Func(0,0): CInt
1088: Func(0,1): CStr
1089: +
1090: " "
1091: +
1092: local #2
1093: Func(0,0): CInt
1094: Func(0,1): CStr
1095: +
1096: " "
1097: +
1098: local #1
1099: Func(0,0): CInt
1100: Func(0,1): CStr
1101: +
1102: " "
1103: +
1104: local #5
1105: Func(0,1): CStr
1106: +
1107: Call Method id append (#52, 1 params)
1108: #
return (index);
1109: local #5
1110: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 165
function GFWordWrap(text, pixels)
1111: pop param 'pixels'
1112: pop param 'text'
var wrap_lines := array{};
1113: decl local #2
1114: array
1115: :=
1116: #
var word_list := SplitWords(text);
1117: decl local #3
1118: local #1
1119: " "
1120: Func(0,5): SplitWords
1121: :=
1122: #
var space_size := GFTextWidth(" ");
1123: decl local #4
1124: " "
1125: makelocal
1126: jmp userfunc @1439
1127: :=
1128: #
var cur_line := "";
1129: decl local #5
1130: ""
1131: :=
1132: #
var cur_length := 0;
1133: decl local #6
1134: 0L
1135: :=
1136: #
var start_new := 0;
1137: decl local #7
1138: 0L
1139: :=
1140: #
foreach word in ( word_list )
1141: local #3
1142: initforeach @1210
var word_width := GFTextWidth(word);
1143: decl local #0
1144: local #8
1145: makelocal
1146: jmp userfunc @1439
1147: :=
1148: #
if ( word == "[P]" )
1149: local #8
1150: "[P]"
1151: ==
1152: if false goto 1160
word := "";
1153: ""
1154: local8 := 
word_width := 0;
1155: 0L
1156: local11 := 
start_new := 1;
1157: 1L
1158: local7 := 
1159: goto1180
elseif ( (word_width+cur_length) > pixels )
1160: local #11
1161: local #6
1162: +
1163: local #0
1164: >
1165: if false goto 1180
start_new := 1;
1166: 1L
1167: local7 := 
if ( cur_line[Len(cur_line)] == " " )
1168: local #5
1169: local #5
1170: Func(0,2): Len
1171: [] 1
1172: " "
1173: ==
1174: if false goto 1180
cur_line[Len(cur_line)] := "";
1175: local #5
1176: local #5
1177: Func(0,2): Len
1178: ""
1179: [] := (1) #
if ( start_new )
1180: local #7
1181: if false goto 1192
start_new := 0;
1182: 0L
1183: local7 := 
wrap_lines.Append(cur_line);
1184: local #2
1185: local #5
1186: Call Method id append (#52, 1 params)
1187: #
cur_line := "";
1188: ""
1189: local5 := 
cur_length := 0;
1190: 0L
1191: local6 := 
if ( word )
1192: local #8
1193: if false goto 1206
cur_line += word+" ";
1194: local #5
1195: local #8
1196: " "
1197: +
1198: +=
1199: #
cur_length += word_width+space_size;
1200: local #6
1201: local #11
1202: local #4
1203: +
1204: +=
1205: #
SleepMS(2);
1206: 2L
1207: Func(3,0): Sleepms
1208: #
1209: leave block(1)
1210: stepforeach @1143
1211: leave block(3)
if ( wrap_lines[wrap_lines.Size()] != cur_line )
1212: local #2
1213: local #2
1214: Call Method id size (#48, 0 params)
1215: [] 1
1216: local #5
1217: <>
1218: if false goto 1235
if ( cur_line[Len(cur_line)] == " " )
1219: local #5
1220: local #5
1221: Func(0,2): Len
1222: [] 1
1223: " "
1224: ==
1225: if false goto 1231
cur_line[Len(cur_line)] := "";
1226: local #5
1227: local #5
1228: Func(0,2): Len
1229: ""
1230: [] := (1) #
wrap_lines.Append(cur_line);
1231: local #2
1232: local #5
1233: Call Method id append (#52, 1 params)
1234: #
return wrap_lines;
1235: local #2
1236: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 335
function XGFError(text, log:=0)
1237: pop param 'log'
1238: pop param 'text'
if ( log )
1239: local #0
1240: if false goto 1246
SysLog("Gump Error:: "+text);
1241: "Gump Error:: "
1242: local #1
1243: +
1244: Func(3,1): SysLog
1245: #
return error{"errortext":=text};
1246: error
1247: local #1
1248: addmember-assign(errortext)
1249: return
c:/ZH099/scripts/include/string.inc, Line 147
function Check_ValidChar( text, allow_space:=0 )
1250: pop param 'allow_space'
1251: pop param 'text'
var valid_char := array{ "a", "b", "c", "d", "e", "f", "g",
1252: decl local #2
1253: array
1254: "a"
1255: init{}
1256: "b"
1257: init{}
1258: "c"
1259: init{}
1260: "d"
1261: init{}
1262: "e"
1263: init{}
1264: "f"
1265: init{}
1266: "g"
1267: init{}
1268: "h"
1269: init{}
1270: "i"
1271: init{}
1272: "j"
1273: init{}
1274: "k"
1275: init{}
1276: "l"
1277: init{}
1278: "m"
1279: init{}
1280: "n"
1281: init{}
1282: "o"
1283: init{}
1284: "p"
1285: init{}
1286: "q"
1287: init{}
1288: "r"
1289: init{}
1290: "s"
1291: init{}
1292: "t"
1293: init{}
1294: "u"
1295: init{}
1296: "v"
1297: init{}
1298: "w"
1299: init{}
1300: "x"
1301: init{}
1302: "y"
1303: init{}
1304: "z"
1305: init{}
1306: "A"
1307: init{}
1308: "B"
1309: init{}
1310: "C"
1311: init{}
1312: "D"
1313: init{}
1314: "E"
1315: init{}
1316: "F"
1317: init{}
1318: "G"
1319: init{}
1320: "H"
1321: init{}
1322: "I"
1323: init{}
1324: "P"
1325: init{}
1326: "O"
1327: init{}
1328: "N"
1329: init{}
1330: "M"
1331: init{}
1332: "L"
1333: init{}
1334: "K"
1335: init{}
1336: "J"
1337: init{}
1338: "Q"
1339: init{}
1340: "R"
1341: init{}
1342: "S"
1343: init{}
1344: "T"
1345: init{}
1346: "U"
1347: init{}
1348: "V"
1349: init{}
1350: "W"
1351: init{}
1352: "X"
1353: init{}
1354: "Y"
1355: init{}
1356: "Z"
1357: init{}
1358: "1"
1359: init{}
1360: "2"
1361: init{}
1362: "3"
1363: init{}
1364: "4"
1365: init{}
1366: "5"
1367: init{}
1368: "6"
1369: init{}
1370: "7"
1371: init{}
1372: "8"
1373: init{}
1374: "9"
1375: init{}
1376: "0"
1377: init{}
1378: :=
1379: #
var len_text := Len( text );
1380: decl local #3
1381: local #1
1382: Func(0,2): Len
1383: :=
1384: #
var i;
1385: decl local #4
1386: #
for( i:=1; i<=len_text; i+=1 )
1387: local #4
1388: 1L
1389: :=
1390: #
1391: local #4
1392: local #3
1393: <=
1394: if false goto 1437
SleepMS(5);
1395: 5L
1396: Func(3,0): Sleepms
1397: #
var letter := CStr( text[i] );
1398: decl local #0
1399: local #1
1400: local #4
1401: [] 1
1402: Func(0,1): CStr
1403: :=
1404: #
if( letter in valid_char )
1405: local #5
1406: local #2
1407: in
1408: if false goto 1412
continue;
1409: leave block(1)
1410: goto1432
1411: goto1429
elseif( allow_space && ( text[i] == " " || CAsc( text[i] ) == 0 ))
1412: local #0
1413: local #1
1414: local #4
1415: [] 1
1416: " "
1417: ==
1418: local #1
1419: local #4
1420: [] 1
1421: Func(0,7): CAsc
1422: 0L
1423: ==
1424: ||
1425: &&
1426: if false goto 1429
continue;
1427: leave block(1)
1428: goto1432
return 0;
1429: 0L
1430: return
1431: leave block(1)
1432: local #4
1433: 1L
1434: +=
1435: #
1436: goto1391
return 1;
1437: 1L
1438: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 124
function GFTextWidth(gump_text)
1439: pop param 'gump_text'
var gft_length := struct;
1440: decl local #1
1441: struct
1442: :=
1443: #
gft_length.+charsf :=
1444: local #1
1445: "charsf"
1446: .+
1447: "||||||||||||||`',.;:::::::::!!!!!!!!!!!!!!il1[]]]]]]]]]"bcejot”(){}===adfpqrszI„~~~~ghnuvy<>-----xJ578$?++++++ kCE2369^/*****mwABDFOPŽ™40%%GLNQSZ@#######HRT&__________KšUYYYYYYYYYYYXXXXXXXXXXXXXXVVVVVVVVVVVVVVMMMMMMMMMMMMMMWWWWWWWWWWWWWW"
1448: := #
gft_length.+width := array
1449: local #1
1450: "width"
1451: .+
1452: array
1453: 2L
1454: init{}
1455: 3L
1456: init{}
1457: 4L
1458: init{}
1459: 5L
1460: init{}
1461: 6L
1462: init{}
1463: 7L
1464: init{}
1465: 8L
1466: init{}
1467: 9L
1468: init{}
1469: 10L
1470: init{}
1471: 11L
1472: init{}
1473: 12L
1474: init{}
1475: 13L
1476: init{}
1477: 14L
1478: init{}
1479: 15L
1480: init{}
1481: 16L
1482: init{}
1483: 18L
1484: init{}
1485: 21L
1486: init{}
1487: := #
var points:=0;
1488: decl local #2
1489: 0L
1490: :=
1491: #
var j := Len(gump_text);
1492: decl local #3
1493: local #0
1494: Func(0,2): Len
1495: :=
1496: #
for ( j; j>0; j-=1 )
1497: local #3
1498: #
1499: local #3
1500: 0L
1501: >
1502: if false goto 1547
var i := Find(gft_length.charsf, gump_text[j], 1) - 1;
1503: decl local #0
1504: local #1
1505: get member 'charsf'
1506: local #0
1507: local #3
1508: [] 1
1509: 1L
1510: Func(0,4): Find
1511: 1L
1512: -
1513: :=
1514: #
if ( i>=0 )
1515: local #4
1516: 0L
1517: >=
1518: if false goto 1532
points += gft_length.width[CInt(i/14)+1];
1519: local #2
1520: local #1
1521: get member 'width'
1522: local #4
1523: 14L
1524: /
1525: Func(0,0): CInt
1526: 1L
1527: +
1528: [] 1
1529: +=
1530: #
1531: goto1541
print("XGFTextWidth: Unknown Character = '"+gump_text[j]+"'");
1532: "XGFTextWidth: Unknown Character = '"
1533: local #0
1534: local #3
1535: [] 1
1536: +
1537: "'"
1538: +
1539: Func(1,0): Print
1540: #
1541: leave block(1)
1542: local #3
1543: 1L
1544: -=
1545: #
1546: goto1499
return (points);
1547: local #2
1548: return
