C:\ZH099\pkg\systems\brainAI\commands\gm\npcsleep.src, Line 11
program textcmd_NPCSleep(who)
CONST REPORT_ALL	:= 0x7;
0: get arg 'who'
if( !AuthorizationCode( who ))
1: local #0
2: makelocal
3: jmp userfunc @127
4: if true goto 13
SendSysMessage( who, "Cancelled." );
5: local #0
6: "Cancelled."
7: 3L
8: 1000L
9: Func(2,1): SendSysMessage
10: #
return 0;
11: 0L
12: progend
var realm_name := RequestGump(who, "Enter the realm name to put npcs to sleep o
13: decl local #1
14: local #0
15: "Enter the realm name to put npcs to sleep on."
16: ""
17: local #0
18: get member id 'realm' (112)
19: 0L
20: makelocal
21: jmp userfunc @350
22: :=
23: #
var realm_info := Realms()[realm_name];
24: decl local #2
25: ""
26: Func(4,1): Realms
27: local #1
28: [] 1
29: :=
30: #
if ( !realm_info )
31: local #2
32: if true goto 41
SendSysMessage(who, "Invalid realm name.");
33: local #0
34: "Invalid realm name."
35: 3L
36: 1000L
37: Func(2,1): SendSysMessage
38: #
return 0;
39: 0L
40: progend
var x1 := 1, y1 := 1, x2 := realm_info.width, y2 := realm_info.height;
41: decl local #3
42: 1L
43: :=
44: #
45: decl local #4
46: 1L
47: :=
48: #
49: decl local #5
50: local #2
51: get member 'width'
52: :=
53: #
54: decl local #6
55: local #2
56: get member id 'height' (8)
57: :=
58: #
var z1 := -120, z2 := 120;
59: decl local #7
60: -120L
61: :=
62: #
63: decl local #8
64: 120L
65: :=
66: #
foreach mobile in ListObjectsInBox(x1, y1, z1, x2, y2, z2, realm_name)
67: local #3
68: local #4
69: local #7
70: local #5
71: local #6
72: local #8
73: local #1
74: Func(2,11): ListObjectsInBox
75: initforeach @89
if ( mobile.npctemplate )
76: local #9
77: get member id 'npctemplate' (62)
78: if false goto 84
AI_Sleep(mobile);
79: local #9
80: 0L
81: makelocal
82: jmp userfunc @101
83: #
SleepMS(5);
84: 5L
85: Func(3,0): Sleepms
86: #
clear_event_queue();
87: Func(3,5): Clear_Event_Queue
88: #
89: stepforeach @76
90: leave block(3)
SendSysMessage(who, "Done telling all npcs to sleep.");
91: local #0
92: "Done telling all npcs to sleep."
93: 3L
94: 1000L
95: Func(2,1): SendSysMessage
96: #
return 1;
97: 1L
98: progend
99: leave block(9)
100: progend
c:/ZH099/pkg/systems/brainAI/include/npcCommands.inc, Line 129
function AI_Sleep( npc, no_wake:=NOWAKE )
101: pop param 'no_wake'
102: pop param 'npc'
var ev		:= struct;
103: decl local #2
104: struct
105: :=
106: #
ev.+type	:= NPCEVENT_SLEEP;
107: local #2
108: "type"
109: .+
110: 10485778L
111: := #
ev.+WakeUp	:= NOWAKE;
112: local #2
113: "WakeUp"
114: .+
115: 0L
116: := #
ev.+process	:= GetProcess( GetPid() );
117: local #2
118: "process"
119: .+
120: Func(3,4): GetPid
121: Func(3,3): GetProcess
122: := #
return SendEvent( npc, ev );
123: local #1
124: local #2
125: Func(2,3): SendEvent
126: return
c:/ZH099/scripts/include/security.inc, Line 14
function AuthorizationCode( mobile )
127: pop param 'mobile'
if( GetObjProperty( mobile, "#AuthCodeGiven" ));
128: local #0
129: "#AuthCodeGiven"
130: Func(2,6): GetObjProperty
131: if false goto 134
return 1;
132: 1L
133: return
var autocode := GetGlobalProperty( "CA" );
134: decl local #1
135: "CA"
136: Func(2,7): GetGlobalProperty
137: :=
138: #
if( !autocode )
139: local #1
140: if true goto 156
SendSysMessage( mobile, "Authorization code is not given yet.", 3, 53 );
141: local #0
142: "Authorization code is not given yet."
143: 3L
144: 53L
145: Func(2,1): SendSysMessage
146: #
SendSysMessage( mobile, "Uses .setauthcode to create a new code.", 3, 53 );
147: local #0
148: "Uses .setauthcode to create a new code."
149: 3L
150: 53L
151: Func(2,1): SendSysMessage
152: #
return 0;
153: 0L
154: return
155: goto198
var code := SendTextEntryGump( mobile, "Enter the Authorization Code.", TE_CANC
156: decl local #0
157: local #0
158: "Enter the Authorization Code."
159: 1L
160: 1L
161: 10L
162: ""
163: Func(2,8): SendTextEntryGump
164: :=
165: #
if( code == autocode )
166: local #2
167: local #1
168: ==
169: if false goto 184
SendSysMessage( mobile, "Code Accepted!", 3, 70 );
170: local #0
171: "Code Accepted!"
172: 3L
173: 70L
174: Func(2,1): SendSysMessage
175: #
SetObjProperty( mobile, "#AuthCodeGiven", 1 );
176: local #0
177: "#AuthCodeGiven"
178: 1L
179: Func(2,9): SetObjProperty
180: #
return 1;
181: 1L
182: return
183: goto197
SendSysMessage( mobile, "It is not the Authorization code.", 3, 33 );
184: local #0
185: "It is not the Authorization code."
186: 3L
187: 33L
188: Func(2,1): SendSysMessage
189: #
NotifyStaffOnline( mobile, "has provided a wrong authorization code." );
190: local #0
191: "has provided a wrong authorization code."
192: makelocal
193: jmp userfunc @200
194: #
return 0;
195: 0L
196: return
197: leave block(1)
198: 0L
199: return
c:/ZH099/scripts/include/security.inc, Line 40
function NotifyStaffOnline( object, text )
200: pop param 'text'
201: pop param 'object'
var name := object.name;
202: decl local #2
203: local #1
204: get member id 'name' (3)
205: :=
206: #
if( !name )
207: local #2
208: if true goto 216
name := object.desc;
209: local #1
210: get member id 'desc' (19)
211: local2 := 
if( !name )
212: local #2
213: if true goto 216
name := object;
214: local #1
215: local2 := 
foreach character in EnumerateOnlineCharacters()
216: Func(2,10): EnumerateOnlineCharacters
217: initforeach @252
if( GetObjProperty( character, "Notify" ))
218: local #3
219: "Notify"
220: Func(2,6): GetObjProperty
221: if false goto 249
if( object.cmdlevel <= character.cmdlevel || character.cmdlevel >= 4 )
222: local #1
223: get member id 'cmdlevel' (46)
224: local #3
225: get member id 'cmdlevel' (46)
226: <=
227: local #3
228: get member id 'cmdlevel' (46)
229: 4L
230: >=
231: ||
232: if false goto 249
SendSysMessage( character, "You receive a notification:", 3, 55 );
233: local #3
234: "You receive a notification:"
235: 3L
236: 55L
237: Func(2,1): SendSysMessage
238: #
SendSysMessage( character, name+" >>> "+text, 3, 55 );
239: local #3
240: local #2
241: " >>> "
242: +
243: local #0
244: +
245: 3L
246: 55L
247: Func(2,1): SendSysMessage
248: #
SleepMS(5);
249: 5L
250: Func(3,0): Sleepms
251: #
252: stepforeach @218
253: leave block(3)
if( object.serial )
254: local #1
255: get member id 'serial' (6)
256: if false goto 273
ReportText( name+"["+object.serial+"] >>> "+text, REPORT_SYSLOG );
257: local #2
258: "["
259: +
260: local #1
261: get member id 'serial' (6)
262: +
263: "] >>> "
264: +
265: local #0
266: +
267: 2L
268: 0L
269: makelocal
270: jmp userfunc @285
271: #
272: goto283
ReportText( name+" >>> "+text, REPORT_SYSLOG );
273: local #2
274: " >>> "
275: +
276: local #0
277: +
278: 2L
279: 0L
280: makelocal
281: jmp userfunc @285
282: #
return 1;
283: 1L
284: return
c:/ZH099/pkg/utils/security/include/report.inc, Line 22
function ReportText( report_text:="?", flags:=REPORT_DISABLE, text_color:=0 )
285: pop param 'text_color'
286: pop param 'flags'
287: pop param 'report_text'
if( !flags )
288: local #1
289: if true goto 293
return 0;
290: 0L
291: return
292: goto348
elseif( flags & REPORT_CONSOLE )
293: local #1
294: 1L
295: &
296: if false goto 303
Print( ""+report_text );
297: ""
298: local #2
299: +
300: Func(1,0): Print
301: #
302: goto348
elseif( flags & REPORT_SYSLOG )
303: local #1
304: 2L
305: &
306: if false goto 337
var script_name := CStr( GetProcess( GetPid() ).name ),
307: decl local #0
308: Func(3,4): GetPid
309: Func(3,3): GetProcess
310: get member id 'name' (3)
311: Func(0,1): CStr
312: :=
313: #
314: decl local #1
315: local #3
316: makelocal
317: jmp userfunc @553
318: :=
319: #
LogToFile( "::log/"+pkg_name+".log", "["+script_name+"]: "+report_text, LOG_DAT
320: "::log/"
321: local #4
322: +
323: ".log"
324: +
325: "["
326: local #3
327: +
328: "]: "
329: +
330: local #2
331: +
332: 1L
333: Func(6,0): LogToFile
334: #
335: leave block(2)
336: goto348
elseif( flags & REPORT_BROADCAST )
337: local #1
338: 4L
339: &
340: if false goto 348
Broadcast( ""+report_text, 3, text_color );
341: ""
342: local #2
343: +
344: 3L
345: local #0
346: Func(2,5): Broadcast
347: #
return 1;
348: 1L
349: return
c:/ZH099/pkg/utils/gumps/include/requestgump.inc, Line 39
function RequestGump(mobile, question, option := "", pre_val := "", cancel_btn:
350: pop param 'cancel_btn'
351: pop param 'pre_val'
352: pop param 'option'
353: pop param 'question'
354: pop param 'mobile'
if ( !pre_val || pre_val == error )
355: local #1
356: !
357: local #1
358: error
359: ==
360: ||
361: if false goto 364
pre_val := "";
362: ""
363: local1 := 
var r_gump := GFCreateGump(140, 100);
364: decl local #5
365: 140L
366: 100L
367: 0L
368: 0L
369: makelocal
370: jmp userfunc @775
371: :=
372: #
GFClosable(r_gump, 0);
373: local #5
374: 0L
375: makelocal
376: jmp userfunc @716
377: #
GFResizePic(r_gump, 0, 0, GFGetCfgConst("Defaults", "BackGround"), 400, 205);
378: local #5
379: 0L
380: 0L
381: "Defaults"
382: "BackGround"
383: makelocal
384: jmp userfunc @884
385: 400L
386: 205L
387: makelocal
388: jmp userfunc @946
389: #
GFResizePic(r_gump, 15, 15, GFGetCfgConst("Defaults", "ForeGround"), 370, 175);
390: local #5
391: 15L
392: 15L
393: "Defaults"
394: "ForeGround"
395: makelocal
396: jmp userfunc @884
397: 370L
398: 175L
399: makelocal
400: jmp userfunc @946
401: #
GFAddAlphaRegion( r_gump, 0, 0, 400, 205 );
402: local #5
403: 0L
404: 0L
405: 400L
406: 205L
407: makelocal
408: jmp userfunc @600
409: #
var y_pos := 20;
410: decl local #6
411: 20L
412: :=
413: #
foreach line in (GFWordWrap(question, 370))
414: local #3
415: 370L
416: makelocal
417: jmp userfunc @1174
418: initforeach @434
GFTextLine(r_gump, 20, y_pos, 1153, line);
419: local #5
420: 20L
421: local #6
422: 1153L
423: local #7
424: makelocal
425: jmp userfunc @1125
426: #
y_pos += 20;
427: local #6
428: 20L
429: +=
430: #
SleepMS(2);
431: 2L
432: Func(3,0): Sleepms
433: #
434: stepforeach @419
435: leave block(3)
y_pos := 75;
436: 75L
437: local6 := 
foreach line in (GFWordWrap(option, 370))
438: local #2
439: 370L
440: makelocal
441: jmp userfunc @1174
442: initforeach @458
GFTextLine(r_gump, 20, y_pos, 1153, line);
443: local #5
444: 20L
445: local #6
446: 1153L
447: local #7
448: makelocal
449: jmp userfunc @1125
450: #
y_pos += 20;
451: local #6
452: 20L
453: +=
454: #
SleepMS(2);
455: 2L
456: Func(3,0): Sleepms
457: #
458: stepforeach @443
459: leave block(3)
GFResizePic(r_gump, 20, 100, GFGetCfgConst("BackGrounds", "GOLDTRIM"), 360, 30)
460: local #5
461: 20L
462: 100L
463: "BackGrounds"
464: "GOLDTRIM"
465: makelocal
466: jmp userfunc @884
467: 360L
468: 30L
469: makelocal
470: jmp userfunc @946
471: #
var r_txt := GFTextEntry(r_gump, 30, 105, 335, 25, 1153, pre_val);
472: decl local #7
473: local #5
474: 30L
475: 105L
476: 335L
477: 25L
478: 1153L
479: local #1
480: 0L
481: makelocal
482: jmp userfunc @1041
483: :=
484: #
if ( cancel_btn )
485: local #0
486: if false goto 508
GFAddButton(r_gump, 90, 160, 2128, 2129, GF_CLOSE_BTN, 100);
487: local #5
488: 90L
489: 160L
490: 2128L
491: 2129L
492: 1L
493: 100L
494: makelocal
495: jmp userfunc @634
496: #
GFAddButton(r_gump, 240, 160, 2119, 2120, GF_CLOSE_BTN, 200);
497: local #5
498: 240L
499: 160L
500: 2119L
501: 2120L
502: 1L
503: 200L
504: makelocal
505: jmp userfunc @634
506: #
507: goto518
GFAddButton(r_gump, 180, 160, 2128, 2129, GF_CLOSE_BTN, 100);
508: local #5
509: 180L
510: 160L
511: 2128L
512: 2129L
513: 1L
514: 100L
515: makelocal
516: jmp userfunc @634
517: #
var input := GFSendGump(mobile, r_gump);
518: decl local #8
519: local #4
520: local #5
521: makelocal
522: jmp userfunc @1003
523: :=
524: #
var text_area := GFExtractData(input, r_txt);
525: decl local #9
526: local #8
527: local #7
528: makelocal
529: jmp userfunc @856
530: :=
531: #
if ( input[200] )
532: local #8
533: 200L
534: [] 1
535: if false goto 539
return error;
536: error
537: return
538: goto551
elseif ( !text_area || text_area == error )
539: local #9
540: !
541: local #9
542: error
543: ==
544: ||
545: if false goto 549
return 0;
546: 0L
547: return
548: goto551
return text_area;
549: local #9
550: return
551: 0L
552: return
c:/ZH099/pkg/utils/security/include/report.inc, Line 40
function GetPkgName( script_name )
553: pop param 'script_name'
var i;
554: decl local #1
555: #
for( i:=1; i<=len(script_name); i+=1 )
556: local #1
557: 1L
558: :=
559: #
560: local #1
561: local #0
562: Func(0,2): Len
563: <=
564: if false goto 584
if( !Check_ValidChar( script_name[i] ))
565: local #0
566: local #1
567: [] 1
568: 0L
569: makelocal
570: jmp userfunc @1313
571: if true goto 576
script_name[i] := " ";
572: local #0
573: local #1
574: " "
575: [] := (1) #
SleepMS(5);
576: 5L
577: Func(3,0): Sleepms
578: #
579: local #1
580: 1L
581: +=
582: #
583: goto560
foreach poss_pkg in ( SplitWords( script_name ))
584: local #0
585: " "
586: Func(0,5): SplitWords
587: initforeach @596
if( GetPackageByName( poss_pkg ))
588: local #2
589: Func(4,0): GetPackageByName
590: if false goto 593
return poss_pkg;
591: local #2
592: return
SleepMS(5);
593: 5L
594: Func(3,0): Sleepms
595: #
596: stepforeach @588
597: leave block(3)
return 0;
598: 0L
599: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 166
function GFAddAlphaRegion(byref gump, x, y, width, height)
600: pop param 'height'
601: pop param 'width'
602: pop param 'y'
603: pop param 'x'
604: pop param byref 'gump'
(gump.layout).Append("CheckerTrans "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
605: local #4
606: get member 'layout'
607: "CheckerTrans "
608: local #3
609: Func(0,0): CInt
610: Func(0,1): CStr
611: +
612: " "
613: +
614: local #2
615: Func(0,0): CInt
616: Func(0,1): CStr
617: +
618: " "
619: +
620: local #1
621: Func(0,0): CInt
622: Func(0,1): CStr
623: +
624: " "
625: +
626: local #0
627: Func(0,0): CInt
628: Func(0,1): CStr
629: +
630: Call Method id append (#52, 1 params)
631: #
return 1;
632: 1L
633: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 172
function GFAddButton(byref gump, x, y, off_id, on_id, btn_type:=GF_PAGE_BTN, bt
634: pop param 'btn_value'
635: pop param 'btn_type'
636: pop param 'on_id'
637: pop param 'off_id'
638: pop param 'y'
639: pop param 'x'
640: pop param byref 'gump'
var line := "Button "+CStr(x)+" "+CStr(y)+" "+CStr(off_id)+" "+CStr(on_id);
641: decl local #7
642: "Button "
643: local #5
644: Func(0,1): CStr
645: +
646: " "
647: +
648: local #4
649: Func(0,1): CStr
650: +
651: " "
652: +
653: local #3
654: Func(0,1): CStr
655: +
656: " "
657: +
658: local #2
659: Func(0,1): CStr
660: +
661: :=
662: #
btn_value := CInt(btn_value);
663: local #0
664: Func(0,0): CInt
665: local0 := 
if ( btn_value < 1 ) // Catch errors (0) and invalid (negative) values
666: local #0
667: 1L
668: <
669: if false goto 678
gump.data_id += 1;
670: local #6
671: get member 'data_id'
672: 1L
673: +=
674: #
btn_value := gump.data_id;
675: local #6
676: get member 'data_id'
677: local0 := 
if ( btn_type == GF_CLOSE_BTN )
678: local #1
679: 1L
680: ==
681: if false goto 690
line += " 1 0 "+CStr(btn_value);
682: local #7
683: " 1 0 "
684: local #0
685: Func(0,1): CStr
686: +
687: +=
688: #
689: goto709
elseif ( btn_type == GF_DUMMY_BTN )
690: local #1
691: 2L
692: ==
693: if false goto 702
line += " 0 0 "+CStr(btn_value);
694: local #7
695: " 0 0 "
696: local #0
697: Func(0,1): CStr
698: +
699: +=
700: #
701: goto709
line += " 0 "+CStr(btn_value);
702: local #7
703: " 0 "
704: local #0
705: Func(0,1): CStr
706: +
707: +=
708: #
(gump.layout).Append(line);
709: local #6
710: get member 'layout'
711: local #7
712: Call Method id append (#52, 1 params)
713: #
return (btn_value);
714: local #0
715: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 71
function GFClosable(byref gump, bool)
716: pop param 'bool'
717: pop param byref 'gump'
case ( bool )
718: local #0
719: casejmp
	0: @720
	1: @742
	default: @764
if ( gump.base.CloseLoc )
720: local #1
721: get member 'base'
722: get member 'CloseLoc'
723: if false goto 729
return XGFError("Gump already contains the 'NoClose' flag.");
724: "Gump already contains the 'NoClose' flag."
725: 0L
726: makelocal
727: jmp userfunc @1300
728: return
(gump.layout).Append("NoClose");
729: local #1
730: get member 'layout'
731: "NoClose"
732: Call Method id append (#52, 1 params)
733: #
gump.base.CloseLoc := (gump.layout).Size();
734: local #1
735: get member 'base'
736: local #1
737: get member 'layout'
738: Call Method id size (#48, 0 params)
739: set member 'CloseLoc' #
break;
740: goto741
741: goto773
if ( !gump.base.CloseLoc )
742: local #1
743: get member 'base'
744: get member 'CloseLoc'
745: if true goto 751
return XGFError("Gump is already closable.");
746: "Gump is already closable."
747: 0L
748: makelocal
749: jmp userfunc @1300
750: return
(gump.layout).Erase(gump.base.CloseLoc);
751: local #1
752: get member 'layout'
753: local #1
754: get member 'base'
755: get member 'CloseLoc'
756: Call Method id erase (#49, 1 params)
757: #
gump.base.CloseLoc := 0;
758: local #1
759: get member 'base'
760: 0L
761: set member 'CloseLoc' #
break;
762: goto763
763: goto773
return XGFError("gumps::Closable: Invalid bool value '"+bool+"'");
764: "gumps::Closable: Invalid bool value '"
765: local #0
766: +
767: "'"
768: +
769: 0L
770: makelocal
771: jmp userfunc @1300
772: return
return 1;
773: 1L
774: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 40
function GFCreateGump(x:=0, y:=0, width:=0, height:=0)
775: pop param 'height'
776: pop param 'width'
777: pop param 'y'
778: pop param 'x'
var gump := struct;
779: decl local #4
780: struct
781: :=
782: #
gump.+base := struct;
783: local #4
784: "base"
785: .+
786: struct
787: := #
gump.base.+x := CInt(x);
788: local #4
789: get member 'base'
790: "x"
791: .+
792: local #3
793: Func(0,0): CInt
794: := #
gump.base.+y := CInt(y);
795: local #4
796: get member 'base'
797: "y"
798: .+
799: local #2
800: Func(0,0): CInt
801: := #
gump.base.+width := CInt(width);
802: local #4
803: get member 'base'
804: "width"
805: .+
806: local #1
807: Func(0,0): CInt
808: := #
gump.base.+height := CInt(height);
809: local #4
810: get member 'base'
811: "height"
812: .+
813: local #0
814: Func(0,0): CInt
815: := #
gump.base.+MoveLoc := 0;	// Movable flag location
816: local #4
817: get member 'base'
818: "MoveLoc"
819: .+
820: 0L
821: := #
gump.base.+CloseLoc := 0;	// NoClose flag location
822: local #4
823: get member 'base'
824: "CloseLoc"
825: .+
826: 0L
827: := #
gump.base.+DisposeLoc := 0;	// NoDispose flag location
828: local #4
829: get member 'base'
830: "DisposeLoc"
831: .+
832: 0L
833: := #
gump.+layout	:= array;	// Main layout array for entire gump
834: local #4
835: "layout"
836: .+
837: array
838: := #
gump.+data	:= array;	// Storage array for static-text and
839: local #4
840: "data"
841: .+
842: array
843: := #
gump.+data_id	:= 1;
844: local #4
845: "data_id"
846: .+
847: 1L
848: := #
gump.+cur_page := 0;
849: local #4
850: "cur_page"
851: .+
852: 0L
853: := #
return(gump);
854: local #4
855: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 56
function GFExtractData(input, data_id)
856: pop param 'data_id'
857: pop param 'input'
var key_string := CStr(data_id)+": ";
858: decl local #2
859: local #0
860: Func(0,1): CStr
861: ": "
862: +
863: :=
864: #
var data_string := input[data_id];
865: decl local #3
866: local #1
867: local #0
868: [] 1
869: :=
870: #
var ret_val := data_string[Len(key_string)+1,Len(data_string)];
871: decl local #4
872: local #3
873: local #2
874: Func(0,2): Len
875: 1L
876: +
877: local #3
878: Func(0,2): Len
879: [,]
880: :=
881: #
return ret_val;
882: local #4
883: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 37
function GFGetCfgConst(elem_name, prop_name)
884: pop param 'prop_name'
885: pop param 'elem_name'
var cfg := ReadConfigFile(":gumps:GumpInfo");
886: decl local #2
887: ":gumps:GumpInfo"
888: Func(5,0): ReadConfigFile
889: :=
890: #
if ( cfg.errortext )
891: local #2
892: get member 'errortext'
893: if false goto 902
return XGFError("GFGetCfgConst():: Unable to open GumpInfo.cfg -> "+cfg.errorte
894: "GFGetCfgConst():: Unable to open GumpInfo.cfg -> "
895: local #2
896: get member 'errortext'
897: +
898: 0L
899: makelocal
900: jmp userfunc @1300
901: return
var elem := cfg[elem_name];
902: decl local #3
903: local #2
904: local #1
905: [] 1
906: :=
907: #
if ( elem.errortext )
908: local #3
909: get member 'errortext'
910: if false goto 923
return XGFError("GFGetCfgConst():: Unable to find GumpInfo.cfg["+elem_name+"] -
911: "GFGetCfgConst():: Unable to find GumpInfo.cfg["
912: local #1
913: +
914: "] ->"
915: +
916: local #3
917: get member 'errortext'
918: +
919: 0L
920: makelocal
921: jmp userfunc @1300
922: return
var value := GetConfigInt(elem, prop_name);
923: decl local #4
924: local #3
925: local #0
926: Func(5,1): GetConfigInt
927: :=
928: #
if ( !value )
929: local #4
930: if true goto 944
return XGFError("GFGetCfgConst():: Unable to find property ["+prop_name+"] in e
931: "GFGetCfgConst():: Unable to find property ["
932: local #0
933: +
934: "] in elem ["
935: +
936: local #1
937: +
938: "]"
939: +
940: 0L
941: makelocal
942: jmp userfunc @1300
943: return
return value;
944: local #4
945: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 151
function GFResizePic(byref gump, x, y, gump_id, width, height)
946: pop param 'height'
947: pop param 'width'
948: pop param 'gump_id'
949: pop param 'y'
950: pop param 'x'
951: pop param byref 'gump'
width := CInt(width);
952: local #1
953: Func(0,0): CInt
954: local1 := 
height := CInt(height);
955: local #0
956: Func(0,0): CInt
957: local0 := 
if ( !width )
958: local #1
959: if true goto 964
width := gump.base.width;
960: local #5
961: get member 'base'
962: get member 'width'
963: local1 := 
if ( !height )
964: local #0
965: if true goto 970
height := gump.base.width;
966: local #5
967: get member 'base'
968: get member 'width'
969: local0 := 
(gump.layout).Append("ResizePic "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
970: local #5
971: get member 'layout'
972: "ResizePic "
973: local #4
974: Func(0,0): CInt
975: Func(0,1): CStr
976: +
977: " "
978: +
979: local #3
980: Func(0,0): CInt
981: Func(0,1): CStr
982: +
983: " "
984: +
985: local #2
986: Func(0,0): CInt
987: Func(0,1): CStr
988: +
989: " "
990: +
991: local #1
992: Func(0,1): CStr
993: +
994: " "
995: +
996: local #0
997: Func(0,1): CStr
998: +
999: Call Method id append (#52, 1 params)
1000: #
return 1;
1001: 1L
1002: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 314
function GFSendGump(mobile, byref gump)
1003: pop param byref 'gump'
1004: pop param 'mobile'
var ret_val := SendDialogGump(mobile, gump.layout, gump.data, gump.base.x, gump
1005: decl local #2
1006: local #1
1007: local #0
1008: get member 'layout'
1009: local #0
1010: get member 'data'
1011: local #0
1012: get member 'base'
1013: get member id 'x' (0)
1014: local #0
1015: get member 'base'
1016: get member id 'y' (1)
1017: 0L
1018: Func(2,0): SendDialogGump
1019: :=
1020: #
if ( ret_val.errortext )
1021: local #2
1022: get member 'errortext'
1023: if false goto 1039
SendSysMessage(mobile, "Error - Unable to display gump.");
1024: local #1
1025: "Error - Unable to display gump."
1026: 3L
1027: 1000L
1028: Func(2,1): SendSysMessage
1029: #
SendSysMessage(mobile, "Error text is ->"+ret_val.errortext);
1030: local #1
1031: "Error text is ->"
1032: local #2
1033: get member 'errortext'
1034: +
1035: 3L
1036: 1000L
1037: Func(2,1): SendSysMessage
1038: #
return ret_val;
1039: local #2
1040: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 296
function GFTextEntry(byref gump, x, y, width, height, txt_color, ini_text:="", 
1041: pop param 'txt_id'
1042: pop param 'ini_text'
1043: pop param 'txt_color'
1044: pop param 'height'
1045: pop param 'width'
1046: pop param 'y'
1047: pop param 'x'
1048: pop param byref 'gump'
gump.data.Append(""+CStr(ini_text));
1049: local #7
1050: get member 'data'
1051: ""
1052: local #1
1053: Func(0,1): CStr
1054: +
1055: Call Method id append (#52, 1 params)
1056: #
var index := gump.data.Size()-1;
1057: decl local #8
1058: local #7
1059: get member 'data'
1060: Call Method id size (#48, 0 params)
1061: 1L
1062: -
1063: :=
1064: #
txt_id := CInt(txt_id);
1065: local #0
1066: Func(0,0): CInt
1067: local0 := 
if ( txt_id < 1 ) // Catch errors (0) and invalid (negative) values
1068: local #0
1069: 1L
1070: <
1071: if false goto 1080
gump.data_id += 1;
1072: local #7
1073: get member 'data_id'
1074: 1L
1075: +=
1076: #
txt_id := gump.data_id;
1077: local #7
1078: get member 'data_id'
1079: local0 := 
(gump.layout).Append("TextEntry "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1080: local #7
1081: get member 'layout'
1082: "TextEntry "
1083: local #6
1084: Func(0,0): CInt
1085: Func(0,1): CStr
1086: +
1087: " "
1088: +
1089: local #5
1090: Func(0,0): CInt
1091: Func(0,1): CStr
1092: +
1093: " "
1094: +
1095: local #4
1096: Func(0,0): CInt
1097: Func(0,1): CStr
1098: +
1099: " "
1100: +
1101: local #3
1102: Func(0,0): CInt
1103: Func(0,1): CStr
1104: +
1105: " "
1106: +
1107: local #2
1108: Func(0,0): CInt
1109: Func(0,1): CStr
1110: +
1111: " "
1112: +
1113: local #0
1114: Func(0,1): CStr
1115: +
1116: " "
1117: +
1118: local #8
1119: Func(0,1): CStr
1120: +
1121: Call Method id append (#52, 1 params)
1122: #
return (txt_id);
1123: local #0
1124: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 263
function GFTextLine(byref gump, x, y, hue:=0, text:="")
1125: pop param 'text'
1126: pop param 'hue'
1127: pop param 'y'
1128: pop param 'x'
1129: pop param byref 'gump'
gump.data.Append(""+CStr(text));
1130: local #4
1131: get member 'data'
1132: ""
1133: local #0
1134: Func(0,1): CStr
1135: +
1136: Call Method id append (#52, 1 params)
1137: #
var index := gump.data.Size()-1;
1138: decl local #5
1139: local #4
1140: get member 'data'
1141: Call Method id size (#48, 0 params)
1142: 1L
1143: -
1144: :=
1145: #
(gump.layout).Append("Text "+CStr(CInt(x))+" "+CStr(CInt(y))+" "
1146: local #4
1147: get member 'layout'
1148: "Text "
1149: local #3
1150: Func(0,0): CInt
1151: Func(0,1): CStr
1152: +
1153: " "
1154: +
1155: local #2
1156: Func(0,0): CInt
1157: Func(0,1): CStr
1158: +
1159: " "
1160: +
1161: local #1
1162: Func(0,0): CInt
1163: Func(0,1): CStr
1164: +
1165: " "
1166: +
1167: local #5
1168: Func(0,1): CStr
1169: +
1170: Call Method id append (#52, 1 params)
1171: #
return (index);
1172: local #5
1173: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 165
function GFWordWrap(text, pixels)
1174: pop param 'pixels'
1175: pop param 'text'
var wrap_lines := array{};
1176: decl local #2
1177: array
1178: :=
1179: #
var word_list := SplitWords(text);
1180: decl local #3
1181: local #1
1182: " "
1183: Func(0,5): SplitWords
1184: :=
1185: #
var space_size := GFTextWidth(" ");
1186: decl local #4
1187: " "
1188: makelocal
1189: jmp userfunc @1502
1190: :=
1191: #
var cur_line := "";
1192: decl local #5
1193: ""
1194: :=
1195: #
var cur_length := 0;
1196: decl local #6
1197: 0L
1198: :=
1199: #
var start_new := 0;
1200: decl local #7
1201: 0L
1202: :=
1203: #
foreach word in ( word_list )
1204: local #3
1205: initforeach @1273
var word_width := GFTextWidth(word);
1206: decl local #0
1207: local #8
1208: makelocal
1209: jmp userfunc @1502
1210: :=
1211: #
if ( word == "[P]" )
1212: local #8
1213: "[P]"
1214: ==
1215: if false goto 1223
word := "";
1216: ""
1217: local8 := 
word_width := 0;
1218: 0L
1219: local11 := 
start_new := 1;
1220: 1L
1221: local7 := 
1222: goto1243
elseif ( (word_width+cur_length) > pixels )
1223: local #11
1224: local #6
1225: +
1226: local #0
1227: >
1228: if false goto 1243
start_new := 1;
1229: 1L
1230: local7 := 
if ( cur_line[Len(cur_line)] == " " )
1231: local #5
1232: local #5
1233: Func(0,2): Len
1234: [] 1
1235: " "
1236: ==
1237: if false goto 1243
cur_line[Len(cur_line)] := "";
1238: local #5
1239: local #5
1240: Func(0,2): Len
1241: ""
1242: [] := (1) #
if ( start_new )
1243: local #7
1244: if false goto 1255
start_new := 0;
1245: 0L
1246: local7 := 
wrap_lines.Append(cur_line);
1247: local #2
1248: local #5
1249: Call Method id append (#52, 1 params)
1250: #
cur_line := "";
1251: ""
1252: local5 := 
cur_length := 0;
1253: 0L
1254: local6 := 
if ( word )
1255: local #8
1256: if false goto 1269
cur_line += word+" ";
1257: local #5
1258: local #8
1259: " "
1260: +
1261: +=
1262: #
cur_length += word_width+space_size;
1263: local #6
1264: local #11
1265: local #4
1266: +
1267: +=
1268: #
SleepMS(2);
1269: 2L
1270: Func(3,0): Sleepms
1271: #
1272: leave block(1)
1273: stepforeach @1206
1274: leave block(3)
if ( wrap_lines[wrap_lines.Size()] != cur_line )
1275: local #2
1276: local #2
1277: Call Method id size (#48, 0 params)
1278: [] 1
1279: local #5
1280: <>
1281: if false goto 1298
if ( cur_line[Len(cur_line)] == " " )
1282: local #5
1283: local #5
1284: Func(0,2): Len
1285: [] 1
1286: " "
1287: ==
1288: if false goto 1294
cur_line[Len(cur_line)] := "";
1289: local #5
1290: local #5
1291: Func(0,2): Len
1292: ""
1293: [] := (1) #
wrap_lines.Append(cur_line);
1294: local #2
1295: local #5
1296: Call Method id append (#52, 1 params)
1297: #
return wrap_lines;
1298: local #2
1299: return
c:/ZH099/pkg/utils/gumps/include/gumps.inc, Line 335
function XGFError(text, log:=0)
1300: pop param 'log'
1301: pop param 'text'
if ( log )
1302: local #0
1303: if false goto 1309
SysLog("Gump Error:: "+text);
1304: "Gump Error:: "
1305: local #1
1306: +
1307: Func(3,1): SysLog
1308: #
return error{"errortext":=text};
1309: error
1310: local #1
1311: addmember-assign(errortext)
1312: return
c:/ZH099/scripts/include/string.inc, Line 147
function Check_ValidChar( text, allow_space:=0 )
1313: pop param 'allow_space'
1314: pop param 'text'
var valid_char := array{ "a", "b", "c", "d", "e", "f", "g",
1315: decl local #2
1316: array
1317: "a"
1318: init{}
1319: "b"
1320: init{}
1321: "c"
1322: init{}
1323: "d"
1324: init{}
1325: "e"
1326: init{}
1327: "f"
1328: init{}
1329: "g"
1330: init{}
1331: "h"
1332: init{}
1333: "i"
1334: init{}
1335: "j"
1336: init{}
1337: "k"
1338: init{}
1339: "l"
1340: init{}
1341: "m"
1342: init{}
1343: "n"
1344: init{}
1345: "o"
1346: init{}
1347: "p"
1348: init{}
1349: "q"
1350: init{}
1351: "r"
1352: init{}
1353: "s"
1354: init{}
1355: "t"
1356: init{}
1357: "u"
1358: init{}
1359: "v"
1360: init{}
1361: "w"
1362: init{}
1363: "x"
1364: init{}
1365: "y"
1366: init{}
1367: "z"
1368: init{}
1369: "A"
1370: init{}
1371: "B"
1372: init{}
1373: "C"
1374: init{}
1375: "D"
1376: init{}
1377: "E"
1378: init{}
1379: "F"
1380: init{}
1381: "G"
1382: init{}
1383: "H"
1384: init{}
1385: "I"
1386: init{}
1387: "P"
1388: init{}
1389: "O"
1390: init{}
1391: "N"
1392: init{}
1393: "M"
1394: init{}
1395: "L"
1396: init{}
1397: "K"
1398: init{}
1399: "J"
1400: init{}
1401: "Q"
1402: init{}
1403: "R"
1404: init{}
1405: "S"
1406: init{}
1407: "T"
1408: init{}
1409: "U"
1410: init{}
1411: "V"
1412: init{}
1413: "W"
1414: init{}
1415: "X"
1416: init{}
1417: "Y"
1418: init{}
1419: "Z"
1420: init{}
1421: "1"
1422: init{}
1423: "2"
1424: init{}
1425: "3"
1426: init{}
1427: "4"
1428: init{}
1429: "5"
1430: init{}
1431: "6"
1432: init{}
1433: "7"
1434: init{}
1435: "8"
1436: init{}
1437: "9"
1438: init{}
1439: "0"
1440: init{}
1441: :=
1442: #
var len_text := Len( text );
1443: decl local #3
1444: local #1
1445: Func(0,2): Len
1446: :=
1447: #
var i;
1448: decl local #4
1449: #
for( i:=1; i<=len_text; i+=1 )
1450: local #4
1451: 1L
1452: :=
1453: #
1454: local #4
1455: local #3
1456: <=
1457: if false goto 1500
SleepMS(5);
1458: 5L
1459: Func(3,0): Sleepms
1460: #
var letter := CStr( text[i] );
1461: decl local #0
1462: local #1
1463: local #4
1464: [] 1
1465: Func(0,1): CStr
1466: :=
1467: #
if( letter in valid_char )
1468: local #5
1469: local #2
1470: in
1471: if false goto 1475
continue;
1472: leave block(1)
1473: goto1495
1474: goto1492
elseif( allow_space && ( text[i] == " " || CAsc( text[i] ) == 0 ))
1475: local #0
1476: local #1
1477: local #4
1478: [] 1
1479: " "
1480: ==
1481: local #1
1482: local #4
1483: [] 1
1484: Func(0,7): CAsc
1485: 0L
1486: ==
1487: ||
1488: &&
1489: if false goto 1492
continue;
1490: leave block(1)
1491: goto1495
return 0;
1492: 0L
1493: return
1494: leave block(1)
1495: local #4
1496: 1L
1497: +=
1498: #
1499: goto1454
return 1;
1500: 1L
1501: return
c:/ZH099/pkg/utils/gumps/include/gumps_ex.inc, Line 124
function GFTextWidth(gump_text)
1502: pop param 'gump_text'
var gft_length := struct;
1503: decl local #1
1504: struct
1505: :=
1506: #
gft_length.+charsf :=
1507: local #1
1508: "charsf"
1509: .+
1510: "||||||||||||||`',.;:::::::::!!!!!!!!!!!!!!il1[]]]]]]]]]"bcejot”(){}===adfpqrszI„~~~~ghnuvy<>-----xJ578$?++++++ kCE2369^/*****mwABDFOPŽ™40%%GLNQSZ@#######HRT&__________KšUYYYYYYYYYYYXXXXXXXXXXXXXXVVVVVVVVVVVVVVMMMMMMMMMMMMMMWWWWWWWWWWWWWW"
1511: := #
gft_length.+width := array
1512: local #1
1513: "width"
1514: .+
1515: array
1516: 2L
1517: init{}
1518: 3L
1519: init{}
1520: 4L
1521: init{}
1522: 5L
1523: init{}
1524: 6L
1525: init{}
1526: 7L
1527: init{}
1528: 8L
1529: init{}
1530: 9L
1531: init{}
1532: 10L
1533: init{}
1534: 11L
1535: init{}
1536: 12L
1537: init{}
1538: 13L
1539: init{}
1540: 14L
1541: init{}
1542: 15L
1543: init{}
1544: 16L
1545: init{}
1546: 18L
1547: init{}
1548: 21L
1549: init{}
1550: := #
var points:=0;
1551: decl local #2
1552: 0L
1553: :=
1554: #
var j := Len(gump_text);
1555: decl local #3
1556: local #0
1557: Func(0,2): Len
1558: :=
1559: #
for ( j; j>0; j-=1 )
1560: local #3
1561: #
1562: local #3
1563: 0L
1564: >
1565: if false goto 1610
var i := Find(gft_length.charsf, gump_text[j], 1) - 1;
1566: decl local #0
1567: local #1
1568: get member 'charsf'
1569: local #0
1570: local #3
1571: [] 1
1572: 1L
1573: Func(0,4): Find
1574: 1L
1575: -
1576: :=
1577: #
if ( i>=0 )
1578: local #4
1579: 0L
1580: >=
1581: if false goto 1595
points += gft_length.width[CInt(i/14)+1];
1582: local #2
1583: local #1
1584: get member 'width'
1585: local #4
1586: 14L
1587: /
1588: Func(0,0): CInt
1589: 1L
1590: +
1591: [] 1
1592: +=
1593: #
1594: goto1604
print("XGFTextWidth: Unknown Character = '"+gump_text[j]+"'");
1595: "XGFTextWidth: Unknown Character = '"
1596: local #0
1597: local #3
1598: [] 1
1599: +
1600: "'"
1601: +
1602: Func(1,0): Print
1603: #
1604: leave block(1)
1605: local #3
1606: 1L
1607: -=
1608: #
1609: goto1562
return (points);
1610: local #2
1611: return
